(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function Pr(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function Gt(s){const e=s.toLowerCase();return e.includes("twitter.com")||e.includes("x.com")?"Twitter":e.includes("youtube.com")||e.includes("youtu.be")?"YouTube":e.includes("instagram.com")?"Instagram":e.includes("linkedin.com")?"LinkedIn":e.includes("pinterest.com")?"Pinterest":e.includes("tiktok.com")||e.includes("vm.tiktok.com")?"TikTok":"Website"}function ge(s){return s?s.split(",").map(e=>e.trim()).filter(e=>e.length>0):[]}function je(s){const e=document.getElementById("tagFilter");if(!e)return;const t=e.value;for(;e.options.length>1;)e.remove(1);if(s&&s.length>0){const r=[...s].sort();r.forEach(n=>{if(n&&n.trim()){const i=document.createElement("option");i.value=n,i.textContent=n,e.appendChild(i)}}),r.includes(t)&&(e.value=t)}}function Lr(s,e){const t=Ir(s);if(!t){$r(e,"Invalid Instagram URL",s);return}const r=document.createElement("div");r.className="instagram-embed-container",r.innerHTML=`
    <blockquote 
      class="instagram-media" 
      data-instgrm-captioned 
      data-instgrm-permalink="https://www.instagram.com/p/${t}/" 
      data-instgrm-version="14">
      <a href="https://www.instagram.com/p/${t}/">View this post on Instagram</a>
    </blockquote>
  `,e.appendChild(r),Ar()}function Ir(s){const e=/instagram\.com\/(?:p|reel)\/([A-Za-z0-9_-]+)/i,t=s.match(e);return t?t[1]:""}function $r(s,e,t=null){s.innerHTML="";const r=document.createElement("div");if(r.className="p-4 bg-red-50 text-red-700 text-center",t){const n=document.createElement("a");n.href=t,n.target="_blank",n.rel="noopener noreferrer",n.className="underline hover:text-red-800",n.textContent=e+" - Open original",r.appendChild(n)}else r.textContent=e;s.appendChild(r)}function Ar(){if(window.instgrm){window.instgrm.Embeds&&window.instgrm.Embeds.process&&window.instgrm.Embeds.process();return}if(!document.querySelector('script[src*="//www.instagram.com/embed.js"]')){const s=document.createElement("script");s.src="//www.instagram.com/embed.js",s.async=!0,s.defer=!0,document.body.appendChild(s),s.onload=()=>{window.instgrm&&window.instgrm.Embeds&&window.instgrm.Embeds.process&&window.instgrm.Embeds.process()}}}const Or="https://link-preview-worker.dunyayavas.workers.dev";async function Vt(s){try{if(s.includes("linkedin.com")||s.includes("pinterest.com")){const e=`${Or}?url=${encodeURIComponent(s)}`,t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch metadata: ${t.status}`);const r=await t.json();return!r.title||r.error?(console.warn("Falling back to generated metadata due to worker error:",r.error||"Missing title"),kt(s)):(delete r.caption,r.realCaption=null,r)}else return{title:"Web Page",description:"No metadata available for this URL",image:null,url:s,siteName:new URL(s).hostname}}catch(e){return console.error("Error fetching metadata:",e),s.includes("linkedin.com")?kt(s):s.includes("pinterest.com")?{title:"Pinterest",description:"View this content on Pinterest",image:"https://s.pinimg.com/webapp/favicon-56d11a4a.png",url:s,siteName:"Pinterest",realCaption:null}:{title:"Web Page",description:"Error fetching metadata",image:null,url:s,siteName:new URL(s).hostname}}}function kt(s){const e=s.toLowerCase(),t={url:s,siteName:"LinkedIn"};let r="unknown";if(e.includes("/posts/")?r="post":e.includes("/pulse/")?r="article":e.includes("/in/")?r="profile":e.includes("/company/")&&(r="company"),t.image="https://cdn-icons-png.flaticon.com/512/174/174857.png",t.caption=jr(r),t.realCaption=null,r==="profile"){const n=/linkedin\.com\/in\/([^\/\?#]+)/i,i=s.match(n);if(i&&i[1]){const o=i[1].replace(/-/g," ");t.title=`${o} | LinkedIn`,t.description=`View ${o}'s profile on LinkedIn, the world's largest professional community.`,t.image="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"}}else if(r==="company"){const n=/linkedin\.com\/company\/([^\/\?#]+)/i,i=s.match(n);if(i&&i[1]){const o=i[1].replace(/-/g," ");t.title=`${o} | LinkedIn`,t.description=`Learn about ${o}, including available jobs, company insights, and more.`,t.image="https://cdn-icons-png.flaticon.com/512/2910/2910791.png"}}else if(r==="post"){const n=/linkedin\.com\/posts\/([^\/\?#]+)/i,i=s.match(n);if(i&&i[1]){const o=i[1].replace(/-/g," ");t.title=`LinkedIn Post by ${o}`,t.description=`Check out this post on LinkedIn by ${o}.`,t.image="https://cdn-icons-png.flaticon.com/512/5968/5968884.png"}}else if(r==="article"){const n=/linkedin\.com\/pulse\/([^\/\?#]+)(?:-([^\/\?#]+))?/i,i=s.match(n);if(i){const o=i[1]?i[1].replace(/-/g," "):"Article",c=i[2]?i[2].replace(/-/g," "):"";t.title=o.charAt(0).toUpperCase()+o.slice(1),t.description=c?`Article by ${c} on LinkedIn`:"Read this article on LinkedIn",t.image="https://cdn-icons-png.flaticon.com/512/2258/2258853.png"}}else t.title="LinkedIn",t.description="View this content on LinkedIn, the world's largest professional network.";return t}function jr(s){const e={profile:"I am excited to share that I have joined a new company as a Senior Developer. Looking forward to this new journey! #NewBeginnings #CareerGrowth",company:"We are thrilled to announce our latest product launch! After months of hard work, our team has created something truly innovative. Check out the link to learn more. #ProductLaunch #Innovation",post:"Just finished an amazing project with my team. It is incredible what we can achieve when we collaborate effectively. #Teamwork #ProjectSuccess",article:"In my latest article, I discuss the future of remote work and how companies can adapt to this new normal. Read more to discover key strategies for success. #RemoteWork #FutureOfWork",unknown:"Sharing some thoughts on LinkedIn about professional development and career growth. What strategies have worked for you? #ProfessionalDevelopment"};return e[s]||e.unknown}function Rr(s,e){const t=document.createElement("div");t.className="bg-gray-100 animate-pulse p-4 h-64 flex items-center justify-center",t.innerHTML='<p class="text-gray-500">Loading Pinterest content...</p>',e.appendChild(t);const r=s.includes("/pin/"),n=s.includes("/board/")||/pinterest\.com\/([^\/]+)\/([^\/]+)\/?$/.test(s)&&!s.includes("/pin/");if(!r&&!n){He(e,"Invalid Pinterest URL",s);return}let i="",o={username:"",boardName:""};if(r){if(i=Br(s),!i){He(e,"Invalid Pinterest pin URL",s);return}}else if(n&&(o=Nr(s),!o.username||!o.boardName)){He(e,"Invalid Pinterest board URL",s);return}e.querySelectorAll(".pinterest-official-embed, .pinterest-fallback-container").forEach(d=>d.remove());const a=document.createElement("div");if(a.className="pinterest-official-embed",a.style.display="block",r){const d=document.createElement("a");d.href=s,d.setAttribute("data-pin-do","embedPin"),d.setAttribute("data-pin-width","large"),a.appendChild(d)}else if(n){const d=document.createElement("a");d.href=s,d.setAttribute("data-pin-do","embedBoard"),d.setAttribute("data-pin-board-width","180"),d.setAttribute("data-pin-scale-height","400"),d.setAttribute("data-pin-scale-width","60"),d.setAttribute("data-pin-columns","3"),a.appendChild(d)}e.appendChild(a);const l=document.createElement("div");l.className="pinterest-fallback-container",l.style.display="none",e.appendChild(l),Dr(),setTimeout(()=>{a.querySelector("iframe, span[data-pin-href]")?(l.style.display="none",a.style.display="block"):(console.log("Pinterest official embed failed to load, using fallback"),a.style.display="none",l.style.display="block",Vt(s).then(u=>{Mr(s,l,u,r)}).catch(u=>{console.error("Error fetching Pinterest metadata:",u),Ur(s,l,r,i,o)}))},3e3),t&&t.parentNode&&t.remove()}function Ur(s,e,t,r,n){const i=document.createElement("div");i.className="pinterest-preview-card bg-white border border-gray-200 rounded-lg overflow-hidden";const o=document.createElement("div");o.className="flex items-center p-3 bg-red-50 border-b border-gray-200",o.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 mr-2 text-red-600">
      <path fill="currentColor" d="M12 0a12 12 0 0 0-4.37 23.17c-.1-.94-.2-2.4.04-3.44.2-.84 1.3-5.34 1.3-5.34s-.33-.67-.33-1.66c0-1.56.9-2.73 2.02-2.73.96 0 1.42.72 1.42 1.58 0 .96-.61 2.4-.93 3.74-.26 1.1.56 2.01 1.65 2.01 1.97 0 3.5-2.08 3.5-5.09 0-2.66-1.9-4.52-4.62-4.52-3.16 0-5.01 2.36-5.01 4.8 0 .95.37 1.96.82 2.52.1.11.1.2.08.31-.1.37-.3 1.16-.34 1.32-.05.21-.18.26-.4.16-1.5-.7-2.42-2.89-2.42-4.65 0-3.77 2.74-7.25 7.9-7.25 4.14 0 7.36 2.95 7.36 6.9 0 4.11-2.59 7.43-6.18 7.43-1.21 0-2.35-.63-2.74-1.37l-.74 2.84c-.27 1.04-1 2.35-1.49 3.14A12 12 0 1 0 12 0z"/>
    </svg>
    <span class="font-semibold text-gray-800">${t?"Pinterest Pin":"Pinterest Board"}</span>
  `;const c=document.createElement("div");c.className="w-full aspect-square bg-gray-100 flex items-center justify-center",c.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
    </svg>
  `;const a=document.createElement("div");a.className="p-4";const l=document.createElement("p");if(l.className="text-sm text-gray-600 mb-4",t)if(l.textContent="View this Pinterest pin to discover creative ideas and inspiration.",r){const h=document.createElement("p");h.className="text-xs text-gray-500 mt-2",h.textContent=`Pin ID: ${r}`,a.appendChild(l),a.appendChild(h)}else a.appendChild(l);else if(l.textContent="Explore this Pinterest board to discover a collection of related pins and ideas.",a.appendChild(l),n.username&&n.boardName){const h=document.createElement("p");h.className="text-xs text-gray-500 mt-2",h.textContent=`Board by ${n.username}: ${n.boardName.replace(/-/g," ")}`,a.appendChild(h)}const d=document.createElement("div");d.className="mt-2 text-xs text-gray-500 truncate",d.textContent=s,a.appendChild(d);const u=document.createElement("a");u.href=s,u.target="_blank",u.rel="noopener noreferrer",u.className="block w-full py-2 px-4 bg-red-600 hover:bg-red-700 text-white text-center rounded-b-lg transition-colors mt-4",u.textContent=t?"View Pin on Pinterest":"View Board on Pinterest",a.appendChild(u),i.appendChild(o),i.appendChild(c),i.appendChild(a),e.appendChild(i)}function Br(s){const e=/pinterest\.com\/pin\/([0-9]+)/i,t=s.match(e);return t?t[1]:""}function Nr(s){let e="",t="";const r=/pinterest\.com\/([^\/]+)\/board\/([^\/]+)/i,n=s.match(r);if(n)e=n[1],t=n[2];else{const i=/pinterest\.com\/([^\/]+)\/([^\/]+)\/?$/i,o=s.match(i);o&&!s.includes("/pin/")&&(e=o[1],t=o[2])}return{username:e,boardName:t}}function Dr(){if(window.PinUtils&&window.PinUtils.build){console.log("Pinterest widgets already loaded"),window.PinUtils.build(),setTimeout(qe,500);return}if(document.getElementById("pinterest-widget-script")){console.log("Pinterest script is loading...");return}console.log("Loading Pinterest widget script");const s=document.createElement("script");s.id="pinterest-widget-script",s.async=!0,s.defer=!0,s.src="https://assets.pinterest.com/js/pinit.js",s.onload=function(){if(console.log("Pinterest widget script loaded"),window.PinUtils&&window.PinUtils.build){console.log("Building Pinterest widgets"),window.PinUtils.build(),setTimeout(qe,500);let e=0;const t=setInterval(()=>{if(e>=10){clearInterval(t);return}window.PinUtils&&window.PinUtils.build&&(console.log("Rebuilding Pinterest widgets (delayed)"),window.PinUtils.build(),qe()),e++},500)}},document.body.appendChild(s)}function qe(){console.log("Adjusting Pinterest embeds to fit properly"),document.querySelectorAll(".pinterest-official-embed").forEach(e=>{e.style.textAlign="center",e.style.width="100%",e.style.maxWidth="100%",e.style.margin="0 auto",e.querySelectorAll("iframe").forEach(i=>{i.width<300&&(i.style.minWidth="300px"),i.style.maxWidth="100%"}),e.querySelectorAll('[data-pin-do="embedPin"]').forEach(i=>{i.style.margin="0 auto",i.style.display="block"}),e.querySelectorAll('[data-pin-do="embedBoard"]').forEach(i=>{i.style.width="100%",i.style.maxWidth="100%",i.hasAttribute("data-pin-columns")||i.setAttribute("data-pin-columns","1"),i.parentNode&&(i.parentNode.style.width="100%"),e.querySelectorAll(".pinterest-board-widget").forEach(c=>{c.style.maxWidth="100%",c.style.width="100%"})})})}function Mr(s,e,t,r){const n=document.createElement("div");n.className="pinterest-preview-card bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm";let i="";t.image&&(i+=`
      <div class="pinterest-preview-image-container w-full aspect-square bg-gray-100 overflow-hidden">
        <img src="${t.image}" alt="${t.title||"Pinterest"}" class="w-full h-full object-cover">
      </div>
    `),i+=`
    <div class="flex items-center p-3 ${t.image?"border-t border-gray-200":"bg-red-50 border-b border-gray-200"}">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 mr-2 text-red-600 flex-shrink-0">
        <path fill="currentColor" d="M12 0a12 12 0 0 0-4.37 23.17c-.1-.94-.2-2.4.04-3.44.2-.84 1.3-5.34 1.3-5.34s-.33-.67-.33-1.66c0-1.56.9-2.73 2.02-2.73.96 0 1.42.72 1.42 1.58 0 .96-.61 2.4-.93 3.74-.26 1.1.56 2.01 1.65 2.01 1.97 0 3.5-2.08 3.5-5.09 0-2.66-1.9-4.52-4.62-4.52-3.16 0-5.01 2.36-5.01 4.8 0 .95.37 1.96.82 2.52.1.11.1.2.08.31-.1.37-.3 1.16-.34 1.32-.05.21-.18.26-.4.16-1.5-.7-2.42-2.89-2.42-4.65 0-3.77 2.74-7.25 7.9-7.25 4.14 0 7.36 2.95 7.36 6.9 0 4.11-2.59 7.43-6.18 7.43-1.21 0-2.35-.63-2.74-1.37l-.74 2.84c-.27 1.04-1 2.35-1.49 3.14A12 12 0 1 0 12 0z"/>
      </svg>
      <span class="font-semibold text-gray-800 text-sm">${t.siteName||"Pinterest"}</span>
    </div>
  `,i+=`
    <div class="p-4">
      <h3 class="font-bold text-gray-900 mb-1 text-base leading-tight">${t.title||(r?"Pinterest Pin":"Pinterest Board")}</h3>
      <p class="text-sm text-gray-600 mb-2 line-clamp-2">${t.description||"View this content on Pinterest"}</p>
      <p class="text-xs text-gray-500 truncate">${s}</p>
    </div>
  `,i+=`
    <a href="${s}" target="_blank" rel="noopener noreferrer" 
       class="block w-full py-2 px-4 bg-red-600 hover:bg-red-700 text-white text-center text-sm font-medium transition-colors">
      Open in Pinterest
    </a>
  `,n.innerHTML=i,e.appendChild(n)}function He(s,e,t=null){s.innerHTML="";const r=document.createElement("div");if(r.className="p-4 bg-red-50 text-red-700 text-center",t){const n=document.createElement("a");n.href=t,n.target="_blank",n.rel="noopener noreferrer",n.className="underline hover:text-red-800",n.textContent=e+" - Open original",r.appendChild(n)}else r.textContent=e;s.appendChild(r)}function Fr(s,e){const t=document.createElement("div");t.className="bg-gray-100 animate-pulse p-4 h-32 flex items-center justify-center",t.innerHTML='<p class="text-gray-500">Loading LinkedIn content...</p>',e.appendChild(t),Vt(s).then(r=>{const n=document.createElement("div");n.className="linkedin-preview bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm";let i="";r.image&&(i+=`
        <div class="linkedin-preview-image-container w-full aspect-video bg-gray-100 overflow-hidden">
          <img src="${r.image}" alt="${r.title}" class="w-full h-full object-cover">
        </div>
      `),i+=`
      <div class="linkedin-preview-content p-4">
        <div class="flex items-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 mr-2 text-blue-700 flex-shrink-0">
            <path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path>
          </svg>
          <span class="font-semibold text-gray-800 text-sm">${r.siteName}</span>
        </div>
        <h3 class="font-bold text-gray-900 mb-1 text-base leading-tight">${r.title}</h3>
        
        <!-- We're not showing any captions for LinkedIn posts to avoid mock content -->
        <!-- If we want to show captions in the future, we'll need to extract them from the actual LinkedIn posts -->
        
        <p class="text-sm text-gray-600 mb-2 line-clamp-2">${r.description}</p>
        <p class="text-xs text-gray-500 truncate">${s}</p>
      </div>
    `,i+=`
      <a href="${s}" target="_blank" rel="noopener noreferrer" 
         class="block w-full py-2 px-4 bg-blue-700 hover:bg-blue-800 text-white text-center text-sm font-medium transition-colors">
        Open in LinkedIn
      </a>
    `,n.innerHTML=i,t.remove(),e.appendChild(n)}).catch(r=>{console.error("Error fetching LinkedIn metadata:",r);const n=document.createElement("div");n.className="linkedin-preview bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm",n.innerHTML=`
      <div class="linkedin-preview-content p-4">
        <div class="flex items-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 mr-2 text-blue-700 flex-shrink-0">
            <path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path>
          </svg>
          <span class="font-semibold text-gray-800 text-sm">LinkedIn</span>
        </div>
        <h3 class="font-bold text-gray-900 mb-1 text-base leading-tight">LinkedIn Content</h3>
        <p class="text-sm text-gray-600 mb-2">View this content on LinkedIn, the world's largest professional network.</p>
        <p class="text-xs text-gray-500 truncate">${s}</p>
      </div>
      <a href="${s}" target="_blank" rel="noopener noreferrer" 
         class="block w-full py-2 px-4 bg-blue-700 hover:bg-blue-800 text-white text-center text-sm font-medium transition-colors">
        Open in LinkedIn
      </a>
    `,t.remove(),e.appendChild(n)})}function qr(s,e){const t=Hr(s);if(!t){zr(e,"Invalid TikTok URL",s);return}const r=document.createElement("div");r.className="tiktok-embed-container",r.innerHTML=`
    <blockquote class="tiktok-embed" cite="${s}" 
      data-video-id="${t}" 
      style="max-width: 605px; min-width: 325px;">
      <section>
        <a target="_blank" href="https://www.tiktok.com/@tiktok">@tiktok</a>
      </section>
    </blockquote>
  `,e.appendChild(r),Jr()}function Hr(s){let e=/tiktok\.com\/@[\w.-]+\/video\/(\d+)/i,t=s.match(e);return t?t[1]:(e=/vm\.tiktok\.com\/[\w]+\/?/i,t=s.match(e),t?"shorturl":"")}function zr(s,e,t){s.innerHTML=`
    <div class="bg-red-50 border border-red-200 text-red-800 rounded-lg p-4">
      <p class="font-medium">${e}</p>
      <p class="text-sm mt-2 break-all">${t}</p>
    </div>
  `}function Jr(){if(window.tiktokEmbedsLoaded){window.tiktokProcessEmbed&&window.tiktokProcessEmbed();return}if(!document.querySelector('script[src*="//www.tiktok.com/embed.js"]')){const s=document.createElement("script");s.src="https://www.tiktok.com/embed.js",s.async=!0,s.defer=!0,document.body.appendChild(s),window.tiktokEmbedsLoaded=!0,s.onload=()=>{window.tiktokProcessEmbed=()=>{console.log("TikTok embed script loaded")},window.tiktokProcessEmbed()}}}function Wr(s,e){try{const r=new URL(s).hostname,n=r.replace(/^www\./,""),i=document.createElement("div");i.className="website-preview rounded-lg overflow-hidden border border-gray-200";const c=`
      <div class="website-preview-content">
        <div class="website-preview-header p-4 pb-2 flex items-center">
          <img src="${`https://www.google.com/s2/favicons?domain=${n}&sz=128`}" class="w-6 h-6 mr-2 rounded-sm" onerror="this.style.display='none'">
          <span class="text-sm text-gray-600 truncate">${r}</span>
        </div>
        <div class="website-preview-text p-4 pt-0">
          <h3 class="text-lg font-semibold mb-2 line-clamp-2">${Vr(s,n)}</h3>
          <p class="text-sm text-gray-600 mb-2 line-clamp-3">${Kr(s)}</p>
        </div>
        <div class="website-preview-image bg-gray-100 flex items-center justify-center" style="height: 140px;">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
          </svg>
        </div>
      </div>
      <a href="${s}" target="_blank" rel="noopener noreferrer" class="block w-full text-center text-sm text-blue-600 hover:text-blue-800 py-2 border-t border-gray-200">
        Visit Website
      </a>
    `;i.innerHTML=c,e.appendChild(i),Gr(s,i)}catch(t){console.error("Error creating website preview:",t),Yr(e,"Could not create website preview",s)}}function Gr(s,e){const t=`https://image.thum.io/get/width/800/crop/600/noanimate/${s}`,r=e.querySelector(".website-preview-image");if(r){const n=document.createElement("img");n.className="w-full h-full object-cover",n.alt="Website preview",n.onload=function(){r.innerHTML="",r.appendChild(n)},n.onerror=function(){},n.src=t}}function Vr(s,e){const r=new URL(s).pathname.split("/").filter(n=>n.length>0);if(r.length>0){let n=r[r.length-1];if(n=n.replace(/\.(html|php|asp|jsp)$/,""),n=n.replace(/[-_]/g," "),n=n.split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "),n.length>3)return n}return e.charAt(0).toUpperCase()+e.slice(1)}function Kr(s){const e=new URL(s);if(e.hostname.includes("github.com")){const t=e.pathname.split("/").filter(r=>r.length>0);return t.length>=2?`GitHub repository by ${t[0]}`:"GitHub - Where the world builds software"}return e.hostname.includes("medium.com")?"Article on Medium - Where good ideas find you":e.hostname.includes("wikipedia.org")?"Wikipedia article - The Free Encyclopedia":`Web page on ${e.hostname.replace(/^www\./,"")}`}function Yr(s,e,t){s.innerHTML=`
    <div class="bg-red-50 border border-red-200 text-red-800 rounded-lg p-4">
      <p class="font-medium">${e}</p>
      <p class="text-sm mt-2 break-all">${t}</p>
    </div>
  `}function Qr(s,e){const t=document.createElement("div");t.className="bg-gray-100 animate-pulse p-4 h-48 flex items-center justify-center",t.innerHTML='<p class="text-gray-500">Loading tweet...</p>',e.appendChild(t);const r=ns(s);if(!r){Ze(e,"Invalid Twitter URL",s);return}const n=document.createElement("div");n.className="twitter-embed-container",e.appendChild(n);const i=()=>{window.twttr&&window.twttr.widgets?window.twttr.widgets.createTweet(r,n,{theme:"light",dnt:!0,align:"center"}).then(o=>{t.remove()}).catch(o=>{console.error("Error creating Twitter embed:",o),Ze(e,"Could not load tweet",s)}):setTimeout(i,1e3)};i()}function Xr(s,e){const t=is(s);if(!t){Ze(e,"Invalid YouTube URL");return}const r=document.createElement("div");r.className="bg-gray-100 animate-pulse p-4 h-48 flex items-center justify-center",r.innerHTML='<p class="text-gray-500">Loading YouTube video...</p>',e.appendChild(r);const n=document.createElement("div");n.className="youtube-embed-container";const i=document.createElement("iframe");i.src=`https://www.youtube.com/embed/${t}?origin=${encodeURIComponent(window.location.origin)}&enablejsapi=1`,i.title="YouTube video player",i.setAttribute("frameborder","0"),i.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),i.setAttribute("allowfullscreen",""),i.setAttribute("loading","lazy"),i.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),i.addEventListener("load",()=>{r&&r.parentNode&&r.remove()}),n.appendChild(i),e.appendChild(n)}function Zr(s,e){return Lr(s,e)}function es(s,e){return Rr(s,e)}function ts(s,e){return Fr(s,e)}function rs(s,e){qr(s,e)}function ss(s,e){return Wr(s,e)}function Ze(s,e,t=null){s.innerHTML="";const r=document.createElement("div");if(r.className="p-4 bg-red-50 text-red-700 text-center",t){const n=document.createElement("a");n.href=t,n.target="_blank",n.rel="noopener noreferrer",n.className="underline hover:text-red-800",n.textContent=e+" - Open original",r.appendChild(n)}else r.textContent=e;s.appendChild(r)}function ns(s){const e=/(?:twitter|x)\.com\/(?:#!\/)?(?:\w+)\/status(?:es)?\/(\d+)/i,t=s.match(e);if(t&&t[1])return t[1];const r=/(?:twitter|x)\.com\/(?:i\/web|intent)\/status\/(\d+)/i,n=s.match(r);return n?n[1]:""}function is(s){const e=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,t=s.match(e);return t?t[1]:""}function Kt(s,e=!1,t=!1){const r=document.createElement("span");r.className="tag",r.dataset.tag=s,e&&(r.classList.add("cursor-pointer","hover:bg-blue-200"),r.addEventListener("click",i=>{if(i.target.tagName==="BUTTON")return;const o=r.dataset.tag;if(document.getElementById("tagFilterContainer")){const c=new CustomEvent("addTagFilter",{detail:{tag:o}});document.dispatchEvent(c)}else{const c=document.getElementById("tagFilter");if(c){let a=!1;for(let l=0;l<c.options.length;l++)if(c.options[l].value===o){a=!0;break}if(!a){const l=document.createElement("option");l.value=o,l.textContent=o,c.appendChild(l)}c.value=o,c.dispatchEvent(new Event("change"))}}}));const n=document.createElement("span");if(n.textContent=s,r.appendChild(n),t){const i=document.createElement("button");i.className="ml-1 text-blue-800 hover:text-red-500 focus:outline-none",i.innerHTML="&times;",i.setAttribute("aria-label",`Remove ${s} tag`),i.addEventListener("click",o=>{o.stopPropagation(),o.preventDefault();const c=new CustomEvent("tagDelete",{bubbles:!0,cancelable:!0,detail:{tag:s}});r.dispatchEvent(c)}),r.appendChild(i)}return r}function os(s,e,t=null){if(e.innerHTML="",!s||s.length===0){const r=document.createElement("span");r.className="text-gray-400 text-sm italic",r.textContent="No tags",e.appendChild(r);return}s.forEach(r=>{const n=Kt(r,!0,!!t);t&&n.addEventListener("tagDelete",i=>{t(i.detail.tag)}),e.appendChild(n)})}function ze(s,e,t){if(e.innerHTML="",!s||s.length===0)return;const r=document.createElement("p");r.className="text-sm text-gray-500 mb-2",r.textContent="Suggested tags:",e.appendChild(r);const n=document.createElement("div");n.className="flex flex-wrap gap-1",s.forEach(i=>{const o=Kt(i,!1,!1);o.classList.add("cursor-pointer","hover:bg-blue-200"),o.addEventListener("click",()=>{t(i)}),n.appendChild(o)}),e.appendChild(n)}function V(s){const e=new Set;return s.forEach(t=>{t.tags&&Array.isArray(t.tags)&&t.tags.forEach(r=>{e.add(r)})}),Array.from(e).sort()}const te="boardie_posts",et="boardie_tags";function F(){try{const s=localStorage.getItem(te),e=s?JSON.parse(s):[];return re(e),je(V(e)),e}catch(s){return console.error("Error loading posts:",s),s instanceof SyntaxError&&(console.log("Attempting to recover from corrupted storage"),localStorage.removeItem(te)),[]}}function ke(s){try{localStorage.setItem(te,JSON.stringify(s))}catch(e){console.error("Error saving posts:",e)}}function Yt(){try{const s=localStorage.getItem(et);return s?JSON.parse(s):[]}catch(s){return console.error("Error loading tags:",s),s instanceof SyntaxError&&(console.log("Attempting to recover from corrupted tags storage"),localStorage.removeItem(et)),[]}}function as(s){try{localStorage.setItem(et,JSON.stringify(s))}catch(e){console.error("Error saving tags:",e)}}function cs(s,e=[]){let t=[];try{const i=localStorage.getItem(te);t=i?JSON.parse(i):[]}catch(i){console.error("Error loading existing posts:",i),t=[]}const r=Gt(s),n={id:Pr(),url:s,platform:r,tags:e,dateAdded:new Date().toISOString()};t.push(n),ke(t),re(t),je(V(t)),document.getElementById("noPostsMessage").classList.add("hidden")}function ls(s){const t=F().filter(r=>r.id!==s);ke(t),re(t)}function ds(s){let e=[];try{const t=localStorage.getItem(te);e=t?JSON.parse(t):[]}catch(t){return console.error("Error loading post by ID:",t),null}return e.find(t=>t.id===s)||null}function us(s,e,t){let r=[];try{const i=localStorage.getItem(te);r=i?JSON.parse(i):[]}catch(i){console.error("Error loading posts for update:",i);return}const n=r.findIndex(i=>i.id===s);if(n!==-1){const i=Gt(e);r[n]={...r[n],url:e,platform:i,tags:t,updatedAt:new Date().toISOString()},ke(r),re(r),je(V(r))}}function re(s){const e=document.getElementById("postsGrid"),t=document.getElementById("postTemplate");e.innerHTML="";const r=[...s].sort((i,o)=>new Date(o.dateAdded)-new Date(i.dateAdded)),n=r.map(i=>{const o=document.importNode(t.content,!0).firstElementChild;o.dataset.id=i.id,o.dataset.platform=i.platform,o.dataset.url=i.url,o.classList.add("opacity-0");const c=o.querySelector(".post-embed"),a=i.platform==="twitter"?"500px":i.platform==="instagram"?"600px":"300px";c.innerHTML=`
      <div class="embed-placeholder bg-gray-100 animate-pulse flex items-center justify-center" 
           style="height: ${a}">
        <p class="text-gray-500">Loading ${i.platform} post...</p>
      </div>
    `;const l=o.querySelector(".post-tags");return os(i.tags,l,d=>{fs(i.id,d)}),{element:o,post:i}});n.forEach(({element:i})=>{e.appendChild(i)}),n.forEach(({element:i,post:o},c)=>{setTimeout(()=>{const a=i.querySelector(".post-embed");hs(o.url,o.platform,a);const l=()=>{const d=a.querySelector(".embed-placeholder");d&&d.remove(),i.classList.remove("opacity-0"),i.classList.add("opacity-100")};setTimeout(()=>{const d=a.querySelectorAll("iframe"),u=a.querySelectorAll("img");d.length===0&&u.length===0?l():(d.forEach(h=>{var f;h.complete||((f=h.contentDocument)==null?void 0:f.readyState)==="complete"?l():h.addEventListener("load",l,{once:!0})}),u.forEach(h=>{h.complete?l():h.addEventListener("load",l,{once:!0})}),setTimeout(l,3e3))},100)},c*100)}),r.length===0?Qt():document.getElementById("noPostsMessage").classList.add("hidden")}function hs(s,e,t){switch(e.toLowerCase()){case"twitter":case"x":Qr(s,t);break;case"youtube":Xr(s,t);break;case"instagram":Zr(s,t);break;case"pinterest":es(s,t);break;case"linkedin":ts(s,t);break;case"tiktok":rs(s,t);break;default:ss(s,t)}}function Et(){const s=[];return document.getElementById("tagFilterContainer").querySelectorAll(".tag").forEach(r=>{s.push(r.dataset.tag)}),s}function Je(s=[]){let e=[];try{const r=localStorage.getItem(te);e=r?JSON.parse(r):[]}catch(r){console.error("Error loading posts for filtering:",r),e=[]}const t=document.getElementById("clearTagFilters");if(s.length>0?t.classList.remove("hidden"):t.classList.add("hidden"),s.length===0)re(e);else{const r=e.filter(n=>n.tags?s.every(i=>n.tags.includes(i)):!1);re(r)}}function fs(s,e){const t=F(),r=t.findIndex(n=>n.id===s);r!==-1&&(t[r].tags=t[r].tags.filter(n=>n!==e),ke(t),re(t),je(V(t)))}function Qt(){document.getElementById("noPostsMessage").classList.remove("hidden")}const tt="boardie_posts";function gs(){try{const s=localStorage.getItem(tt),e=s?JSON.parse(s):[];if(!e||e.length===0){alert("No posts to export");return}const t={version:"0.1.0",timestamp:new Date().toISOString(),count:e.length,posts:e},r=JSON.stringify(t,null,2),n=new Blob([r],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");return o.href=i,o.download=`boardie-export-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i),!0}catch(s){return console.error("Error exporting posts:",s),alert("Failed to export posts: "+s.message),!1}}function ms(s){return new Promise((e,t)=>{const r=new FileReader;r.onload=n=>{try{const i=JSON.parse(n.target.result);if(!i.posts||!Array.isArray(i.posts)){t(new Error("Invalid import file format"));return}const o=JSON.parse(localStorage.getItem(tt)||"[]"),c=new Set(o.map(d=>d.id)),a=i.posts.filter(d=>!c.has(d.id)),l=[...o,...a];localStorage.setItem(tt,JSON.stringify(l)),e({success:!0,totalImported:i.posts.length,newPostsAdded:a.length,duplicatesSkipped:i.posts.length-a.length})}catch(i){console.error("Error importing posts:",i),t(i)}},r.onerror=n=>{t(n)},r.readAsText(s)})}const ps="modulepreload",ws=function(s){return"/boardie02/"+s},xt={},de=function(e,t,r){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=ws(i),i in xt)return;xt[i]=!0;const o=i.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(!!r)for(let d=n.length-1;d>=0;d--){const u=n[d];if(u.href===i&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":ps,o||(l.as="script",l.crossOrigin=""),l.href=i,document.head.appendChild(l),o)return new Promise((d,u)=>{l.addEventListener("load",d),l.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},ys=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>de(()=>Promise.resolve().then(()=>he),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class ht extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class vs extends ht{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class bs extends ht{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class _s extends ht{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var rt;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(rt||(rt={}));var ks=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{l(r.next(d))}catch(u){o(u)}}function a(d){try{l(r.throw(d))}catch(u){o(u)}}function l(d){d.done?i(d.value):n(d.value).then(c,a)}l((r=r.apply(s,e||[])).next())})};class Es{constructor(e,{headers:t={},customFetch:r,region:n=rt.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=ys(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return ks(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let c={},{region:a}=t;a||(a=this.region),a&&a!=="any"&&(c["x-region"]=a);let l;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(c["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(c["Content-Type"]="application/json",l=JSON.stringify(o)));const d=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:l}).catch(g=>{throw new vs(g)}),u=d.headers.get("x-relay-error");if(u&&u==="true")throw new bs(d);if(!d.ok)throw new _s(d);let h=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return h==="application/json"?f=yield d.json():h==="application/octet-stream"?f=yield d.blob():h==="text/event-stream"?f=d:h==="multipart/form-data"?f=yield d.formData():f=yield d.text(),{data:f,error:null}}catch(n){return{data:null,error:n}}})}}var N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mo(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function xs(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var n=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return s[r]}})}),t}var R={},ft={},Re={},Ee={},Ue={},Be={},Ts=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ue=Ts();const Ss=ue.fetch,Xt=ue.fetch.bind(ue),Zt=ue.Headers,Cs=ue.Request,Ps=ue.Response,he=Object.freeze(Object.defineProperty({__proto__:null,Headers:Zt,Request:Cs,Response:Ps,default:Xt,fetch:Ss},Symbol.toStringTag,{value:"Module"})),Ls=xs(he);var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});let Is=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Ne.default=Is;var er=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Be,"__esModule",{value:!0});const $s=er(Ls),As=er(Ne);let Os=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=$s.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,c,a;let l=null,d=null,u=null,h=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){const T=await i.text();T===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=T:d=JSON.parse(T))}const y=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),w=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");y&&w&&w.length>1&&(u=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(l={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,u=null,h=406,f="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const y=await i.text();try{l=JSON.parse(y),Array.isArray(l)&&i.status===404&&(d=[],l=null,h=200,f="OK")}catch{i.status===404&&y===""?(h=204,f="No Content"):l={message:y}}if(l&&this.isMaybeSingle&&(!((a=l==null?void 0:l.details)===null||a===void 0)&&a.includes("0 rows"))&&(l=null,h=200,f="OK"),l&&this.shouldThrowOnError)throw new As.default(l)}return{error:l,data:d,count:u,status:h,statusText:f}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,c,a;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(c=i==null?void 0:i.stack)!==null&&c!==void 0?c:""}`,hint:"",code:`${(a=i==null?void 0:i.code)!==null&&a!==void 0?a:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Be.default=Os;var js=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ue,"__esModule",{value:!0});const Rs=js(Be);let Us=class extends Rs.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",c=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${c?`${c},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var c;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(c=this.headers.Accept)!==null&&c!==void 0?c:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ue.default=Us;var Bs=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ee,"__esModule",{value:!0});const Ns=Bs(Ue);let Ds=class extends Ns.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Ee.default=Ds;var Ms=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Re,"__esModule",{value:!0});const me=Ms(Ee);let Fs=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=t,this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new me.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((c,a)=>c.concat(Object.keys(a)),[]);if(o.length>0){const c=[...new Set(o)].map(a=>`"${a}"`);this.url.searchParams.set("columns",c.join(","))}}return new me.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){const o="POST",c=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&c.push(this.headers.Prefer),n&&c.push(`count=${n}`),i||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(e)){const a=e.reduce((l,d)=>l.concat(Object.keys(d)),[]);if(a.length>0){const l=[...new Set(a)].map(d=>`"${d}"`);this.url.searchParams.set("columns",l.join(","))}}return new me.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new me.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new me.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Re.default=Fs;var De={},Me={};Object.defineProperty(Me,"__esModule",{value:!0});Me.version=void 0;Me.version="0.0.0-automated";Object.defineProperty(De,"__esModule",{value:!0});De.DEFAULT_HEADERS=void 0;const qs=Me;De.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${qs.version}`};var tr=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ft,"__esModule",{value:!0});const Hs=tr(Re),zs=tr(Ee),Js=De;let Ws=class rr{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},Js.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Hs.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new rr(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:i}={}){let o;const c=new URL(`${this.url}/rpc/${e}`);let a;r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([d,u])=>u!==void 0).map(([d,u])=>[d,Array.isArray(u)?`{${u.join(",")}}`:`${u}`]).forEach(([d,u])=>{c.searchParams.append(d,u)})):(o="POST",a=t);const l=Object.assign({},this.headers);return i&&(l.Prefer=`count=${i}`),new zs.default({method:o,url:c,headers:l,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};ft.default=Ws;var fe=N&&N.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(R,"__esModule",{value:!0});R.PostgrestError=R.PostgrestBuilder=R.PostgrestTransformBuilder=R.PostgrestFilterBuilder=R.PostgrestQueryBuilder=R.PostgrestClient=void 0;const sr=fe(ft);R.PostgrestClient=sr.default;const nr=fe(Re);R.PostgrestQueryBuilder=nr.default;const ir=fe(Ee);R.PostgrestFilterBuilder=ir.default;const or=fe(Ue);R.PostgrestTransformBuilder=or.default;const ar=fe(Be);R.PostgrestBuilder=ar.default;const cr=fe(Ne);R.PostgrestError=cr.default;var Gs=R.default={PostgrestClient:sr.default,PostgrestQueryBuilder:nr.default,PostgrestFilterBuilder:ir.default,PostgrestTransformBuilder:or.default,PostgrestBuilder:ar.default,PostgrestError:cr.default};const{PostgrestClient:Vs,PostgrestQueryBuilder:_o,PostgrestFilterBuilder:ko,PostgrestTransformBuilder:Eo,PostgrestBuilder:xo,PostgrestError:To}=Gs,Ks="2.11.2",Ys={"X-Client-Info":`realtime-js/${Ks}`},Qs="1.0.0",lr=1e4,Xs=1e3;var le;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(le||(le={}));var U;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(U||(U={}));var D;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(D||(D={}));var st;(function(s){s.websocket="websocket"})(st||(st={}));var ee;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(ee||(ee={}));class Zs{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const c=r.decode(e.slice(o,o+n));o=o+n;const a=r.decode(e.slice(o,o+i));o=o+i;const l=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:c,event:a,payload:l}}}class dr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var E;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(E||(E={}));const Tt=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=en(o,s,e,n),i),{})},en=(s,e,t,r)=>{const n=e.find(c=>c.name===s),i=n==null?void 0:n.type,o=t[s];return i&&!r.includes(i)?ur(i,o):nt(o)},ur=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return nn(e,t)}switch(s){case E.bool:return tn(e);case E.float4:case E.float8:case E.int2:case E.int4:case E.int8:case E.numeric:case E.oid:return rn(e);case E.json:case E.jsonb:return sn(e);case E.timestamp:return on(e);case E.abstime:case E.date:case E.daterange:case E.int4range:case E.int8range:case E.money:case E.reltime:case E.text:case E.time:case E.timestamptz:case E.timetz:case E.tsrange:case E.tstzrange:return nt(e);default:return nt(e)}},nt=s=>s,tn=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},rn=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},sn=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},nn=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let i;const o=s.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(c=>ur(e,c))}return s},on=s=>typeof s=="string"?s.replace(" ","T"):s,hr=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class We{constructor(e,t,r={},n=lr){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var St;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(St||(St={}));class we{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:o,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=we.syncState(this.state,n,i,o),this.pendingDiffs.forEach(a=>{this.state=we.syncDiff(this.state,a,i,o)}),this.pendingDiffs=[],c()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=we.syncDiff(this.state,n,i,o),c())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const i=this.cloneDeep(e),o=this.transformState(t),c={},a={};return this.map(i,(l,d)=>{o[l]||(a[l]=d)}),this.map(o,(l,d)=>{const u=i[l];if(u){const h=d.map(w=>w.presence_ref),f=u.map(w=>w.presence_ref),g=d.filter(w=>f.indexOf(w.presence_ref)<0),y=u.filter(w=>h.indexOf(w.presence_ref)<0);g.length>0&&(c[l]=g),y.length>0&&(a[l]=y)}else c[l]=d}),this.syncDiff(i,{joins:c,leaves:a},r,n)}static syncDiff(e,t,r,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(c,a)=>{var l;const d=(l=e[c])!==null&&l!==void 0?l:[];if(e[c]=this.cloneDeep(a),d.length>0){const u=e[c].map(f=>f.presence_ref),h=d.filter(f=>u.indexOf(f.presence_ref)<0);e[c].unshift(...h)}r(c,d,a)}),this.map(o,(c,a)=>{let l=e[c];if(!l)return;const d=a.map(u=>u.presence_ref);l=l.filter(u=>d.indexOf(u.presence_ref)<0),e[c]=l,n(c,l,a),l.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ct;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Ct||(Ct={}));var Pt;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Pt||(Pt={}));var q;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(q||(q={}));class gt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=U.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new We(this,D.join,this.params,this.timeout),this.rejoinTimer=new dr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=U.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=U.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=U.errored,this.rejoinTimer.scheduleTimeout())}),this._on(D.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new we(this),this.broadcastEndpointURL=hr(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:c}}=this.params;this._onError(d=>e==null?void 0:e(q.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(q.CLOSED));const a={},l={broadcast:i,presence:o,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(d=>d.filter))!==null&&n!==void 0?n:[],private:c};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var u;if(this.socket.setAuth(),d===void 0){e==null||e(q.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,f=(u=h==null?void 0:h.length)!==null&&u!==void 0?u:0,g=[];for(let y=0;y<f;y++){const w=h[y],{filter:{event:T,schema:A,table:I,filter:S}}=w,L=d&&d[y];if(L&&L.event===T&&L.schema===A&&L.table===I&&L.filter===S)g.push(Object.assign(Object.assign({},w),{id:L.id}));else{this.unsubscribe(),e==null||e(q.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(q.SUBSCRIBED);return}}).receive("error",d=>{e==null||e(q.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(q.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=l.body)===null||n===void 0?void 0:n.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,c,a;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((a=(c=(o=this.params)===null||o===void 0?void 0:o.config)===null||c===void 0?void 0:c.broadcast)===null||a===void 0)&&a.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=U.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(D.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const n=new We(this,D.leave,{},e);n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new We(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;const o=e.toLocaleLowerCase(),{close:c,error:a,leave:l,join:d}=D;if(r&&[c,a,l,d].indexOf(o)>=0&&r!==this._joinRef())return;let h=this._onMessage(o,t,r);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var g,y,w;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((w=(y=f.filter)===null||y===void 0?void 0:y.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(f=>f.callback(h,r)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var g,y,w,T,A,I;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const S=f.id,L=(g=f.filter)===null||g===void 0?void 0:g.event;return S&&((y=t.ids)===null||y===void 0?void 0:y.includes(S))&&(L==="*"||(L==null?void 0:L.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const S=(A=(T=f==null?void 0:f.filter)===null||T===void 0?void 0:T.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return S==="*"||S===((I=t==null?void 0:t.event)===null||I===void 0?void 0:I.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const g=h.data,{schema:y,table:w,commit_timestamp:T,type:A,errors:I}=g;h=Object.assign(Object.assign({},{schema:y,table:w,commit_timestamp:T,eventType:A,new:{},old:{},errors:I}),this._getPayloadRecords(g))}f.callback(h,r)})}_isClosed(){return this.state===U.closed}_isJoined(){return this.state===U.joined}_isJoining(){return this.state===U.joining}_isLeaving(){return this.state===U.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&gt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(D.close,{},e)}_onError(e){this._on(D.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=U.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Tt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Tt(e.columns,e.old_record)),t}}const an=()=>{},cn=typeof WebSocket<"u",ln=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class dn{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Ys,this.params={},this.timeout=lr,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=an,this.conn=null,this.sendBuffer=[],this.serializer=new Zs,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...c)=>de(()=>Promise.resolve().then(()=>he),void 0).then(({default:a})=>a(...c)):o=fetch,(...c)=>o(...c)},this.endPoint=`${e}/${st.websocket}`,this.httpEndpoint=hr(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new dr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(cn){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new un(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),de(()=>import("./browser-715af577.js").then(e=>e.b),[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Qs}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case le.connecting:return ee.Connecting;case le.open:return ee.Open;case le.closing:return ee.Closing;default:return ee.Closed}}isConnected(){return this.connectionState()===ee.Open}channel(e,t={config:{}}){const r=new gt(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:n,ref:i}=e,o=()=>{this.encode(e,c=>{var a;(a=this.conn)===null||a===void 0||a.send(c)})};this.log("push",`${t} ${r} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(D.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Xs,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${n} ${o&&"("+o+")"||""}`,i),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(c=>c(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(D.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([ln],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class un{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=le.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class mt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function P(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class hn extends mt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class it extends mt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var fn=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{l(r.next(d))}catch(u){o(u)}}function a(d){try{l(r.throw(d))}catch(u){o(u)}}function l(d){d.done?i(d.value):n(d.value).then(c,a)}l((r=r.apply(s,e||[])).next())})};const fr=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>de(()=>Promise.resolve().then(()=>he),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},gn=()=>fn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield de(()=>Promise.resolve().then(()=>he),void 0)).Response:Response}),ot=s=>{if(Array.isArray(s))return s.map(t=>ot(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=ot(r)}),e};var ne=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{l(r.next(d))}catch(u){o(u)}}function a(d){try{l(r.throw(d))}catch(u){o(u)}}function l(d){d.done?i(d.value):n(d.value).then(c,a)}l((r=r.apply(s,e||[])).next())})};const Ge=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),mn=(s,e,t)=>ne(void 0,void 0,void 0,function*(){const r=yield gn();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(n=>{e(new hn(Ge(n),s.status||500))}).catch(n=>{e(new it(Ge(n),n))}):e(new it(Ge(s),s))}),pn=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),t))};function xe(s,e,t,r,n,i){return ne(this,void 0,void 0,function*(){return new Promise((o,c)=>{s(t,pn(e,r,n,i)).then(a=>{if(!a.ok)throw a;return r!=null&&r.noResolveJson?a:a.json()}).then(a=>o(a)).catch(a=>mn(a,c,r))})})}function $e(s,e,t,r){return ne(this,void 0,void 0,function*(){return xe(s,"GET",e,t,r)})}function W(s,e,t,r,n){return ne(this,void 0,void 0,function*(){return xe(s,"POST",e,r,n,t)})}function wn(s,e,t,r,n){return ne(this,void 0,void 0,function*(){return xe(s,"PUT",e,r,n,t)})}function yn(s,e,t,r){return ne(this,void 0,void 0,function*(){return xe(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function gr(s,e,t,r,n){return ne(this,void 0,void 0,function*(){return xe(s,"DELETE",e,r,n,t)})}var j=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{l(r.next(d))}catch(u){o(u)}}function a(d){try{l(r.throw(d))}catch(u){o(u)}}function l(d){d.done?i(d.value):n(d.value).then(c,a)}l((r=r.apply(s,e||[])).next())})};const vn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Lt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class bn{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=fr(n)}uploadOrUpdate(e,t,r,n){return j(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Lt),n);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const a=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),a&&i.append("metadata",this.encodeMetadata(a)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),a&&i.append("metadata",this.encodeMetadata(a))):(i=r,c["cache-control"]=`max-age=${o.cacheControl}`,c["content-type"]=o.contentType,a&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),n!=null&&n.headers&&(c=Object.assign(Object.assign({},c),n.headers));const l=this._removeEmptyFolders(t),d=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:i,headers:c},o!=null&&o.duplex?{duplex:o.duplex}:{})),h=yield u.json();return u.ok?{data:{path:l,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(i){if(P(i))return{data:null,error:i};throw i}})}upload(e,t,r){return j(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return j(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),c=new URL(this.url+`/object/upload/sign/${o}`);c.searchParams.set("token",t);try{let a;const l=Object.assign({upsert:Lt.upsert},n),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",l.cacheControl),a.append("",r)):typeof FormData<"u"&&r instanceof FormData?(a=r,a.append("cacheControl",l.cacheControl)):(a=r,d["cache-control"]=`max-age=${l.cacheControl}`,d["content-type"]=l.contentType);const u=yield this.fetch(c.toString(),{method:"PUT",body:a,headers:d}),h=yield u.json();return u.ok?{data:{path:i,fullPath:h.Key},error:null}:{data:null,error:h}}catch(a){if(P(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return j(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield W(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+i.url),c=o.searchParams.get("token");if(!c)throw new mt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:c},error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}update(e,t,r){return j(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return j(this,void 0,void 0,function*(){try{return{data:yield W(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(P(n))return{data:null,error:n};throw n}})}copy(e,t,r){return j(this,void 0,void 0,function*(){try{return{data:{path:(yield W(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(P(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return j(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield W(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(P(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return j(this,void 0,void 0,function*(){try{const n=yield W(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(P(n))return{data:null,error:n};throw n}})}download(e,t){return j(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield $e(this.fetch,`${this.url}/${n}/${c}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(P(c))return{data:null,error:c};throw c}})}info(e){return j(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield $e(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ot(r),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}exists(e){return j(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield yn(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(P(r)&&r instanceof it){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const c=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});a!==""&&n.push(a);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${r}${l}`)}}}remove(e){return j(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}list(e,t,r){return j(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},vn),t),{prefix:e||""});return{data:yield W(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(P(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const _n="2.7.1",kn={"X-Client-Info":`storage-js/${_n}`};var ie=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{l(r.next(d))}catch(u){o(u)}}function a(d){try{l(r.throw(d))}catch(u){o(u)}}function l(d){d.done?i(d.value):n(d.value).then(c,a)}l((r=r.apply(s,e||[])).next())})};class En{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},kn),t),this.fetch=fr(r)}listBuckets(){return ie(this,void 0,void 0,function*(){try{return{data:yield $e(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(P(e))return{data:null,error:e};throw e}})}getBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield $e(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ie(this,void 0,void 0,function*(){try{return{data:yield W(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ie(this,void 0,void 0,function*(){try{return{data:yield wn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield W(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}}class xn extends En{constructor(e,t={},r){super(e,t,r)}from(e){return new bn(this.url,this.headers,e,this.fetch)}}const Tn="2.49.4";let pe="";typeof Deno<"u"?pe="deno":typeof document<"u"?pe="web":typeof navigator<"u"&&navigator.product==="ReactNative"?pe="react-native":pe="node";const Sn={"X-Client-Info":`supabase-js-${pe}/${Tn}`},Cn={headers:Sn},Pn={schema:"public"},Ln={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},In={};var $n=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{l(r.next(d))}catch(u){o(u)}}function a(d){try{l(r.throw(d))}catch(u){o(u)}}function l(d){d.done?i(d.value):n(d.value).then(c,a)}l((r=r.apply(s,e||[])).next())})};const An=s=>{let e;return s?e=s:typeof fetch>"u"?e=Xt:e=fetch,(...t)=>e(...t)},On=()=>typeof Headers>"u"?Zt:Headers,jn=(s,e,t)=>{const r=An(t),n=On();return(i,o)=>$n(void 0,void 0,void 0,function*(){var c;const a=(c=yield e())!==null&&c!==void 0?c:s;let l=new n(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",s),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),r(i,Object.assign(Object.assign({},o),{headers:l}))})};var Rn=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{l(r.next(d))}catch(u){o(u)}}function a(d){try{l(r.throw(d))}catch(u){o(u)}}function l(d){d.done?i(d.value):n(d.value).then(c,a)}l((r=r.apply(s,e||[])).next())})};function Un(s){return s.replace(/\/$/,"")}function Bn(s,e){const{db:t,auth:r,realtime:n,global:i}=s,{db:o,auth:c,realtime:a,global:l}=e,d={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},c),r),realtime:Object.assign(Object.assign({},a),n),global:Object.assign(Object.assign({},l),i),accessToken:()=>Rn(this,void 0,void 0,function*(){return""})};return s.accessToken?d.accessToken=s.accessToken:delete d.accessToken,d}const mr="2.69.1",ce=30*1e3,at=3,Ve=at*ce,Nn="http://localhost:9999",Dn="supabase.auth.token",Mn={"X-Client-Info":`gotrue-js/${mr}`},ct="X-Supabase-Api-Version",pr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Fn=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,qn=6e5;class pt extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function p(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Hn extends pt{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function zn(s){return p(s)&&s.name==="AuthApiError"}class wr extends pt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Q extends pt{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class z extends Q{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Jn(s){return p(s)&&s.name==="AuthSessionMissingError"}class Ke extends Q{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Se extends Q{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ce extends Q{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Wn(s){return p(s)&&s.name==="AuthImplicitGrantRedirectError"}class It extends Q{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class lt extends Q{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ye(s){return p(s)&&s.name==="AuthRetryableFetchError"}class $t extends Q{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class ye extends Q{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const At="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ot=` 	
\r=`.split(""),Gn=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<Ot.length;e+=1)s[Ot[e].charCodeAt(0)]=-2;for(let e=0;e<At.length;e+=1)s[At[e].charCodeAt(0)]=e;return s})();function yr(s,e,t){const r=Gn[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function jt(s){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{Yn(o,r,t)};for(let o=0;o<s.length;o+=1)yr(s.charCodeAt(o),n,i);return e.join("")}function Vn(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Kn(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Vn(r,e)}}function Yn(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if(!(s>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Qn(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)yr(s.charCodeAt(n),t,r);return new Uint8Array(e)}function Xn(s){const e=[];return Kn(s,t=>e.push(t)),new Uint8Array(e)}function Zn(s){return Math.round(Date.now()/1e3)+s}function ei(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const M=()=>typeof window<"u"&&typeof document<"u",X={tested:!1,writable:!1},ve=()=>{if(!M())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(X.tested)return X.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),X.tested=!0,X.writable=!0}catch{X.tested=!0,X.writable=!1}return X.writable};function ti(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const vr=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>de(()=>Promise.resolve().then(()=>he),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ri=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",br=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},Pe=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Le=async(s,e)=>{await s.removeItem(e)};class Fe{constructor(){this.promise=new Fe.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Fe.promiseConstructor=Promise;function Qe(s){const e=s.split(".");if(e.length!==3)throw new ye("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Fn.test(e[r]))throw new ye("JWT not in base64url format");return{header:JSON.parse(jt(e[0])),payload:JSON.parse(jt(e[1])),signature:Qn(e[2]),raw:{header:e[0],payload:e[1]}}}async function si(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function ni(s,e){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await s(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function ii(s){return("0"+s.toString(16)).substr(-2)}function oi(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,ii).join("")}async function ai(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function ci(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await ai(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function oe(s,e,t=!1){const r=oi();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await br(s,`${e}-code-verifier`,n);const i=await ci(r);return[i,r===i?"plain":"s256"]}const li=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function di(s){const e=s.headers.get(ct);if(!e||!e.match(li))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function ui(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function hi(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var fi=globalThis&&globalThis.__rest||function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};const Z=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),gi=[502,503,504];async function Rt(s){var e;if(!ri(s))throw new lt(Z(s),0);if(gi.includes(s.status))throw new lt(Z(s),s.status);let t;try{t=await s.json()}catch(i){throw new wr(Z(i),i)}let r;const n=di(s);if(n&&n.getTime()>=pr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new $t(Z(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new z}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new $t(Z(t),s.status,t.weak_password.reasons);throw new Hn(Z(t),s.status||500,r)}const mi=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function v(s,e,t,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[ct]||(i[ct]=pr["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const c=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",a=await pi(s,e,t+c,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(a):{data:Object.assign({},a),error:null}}async function pi(s,e,t,r,n,i){const o=mi(e,r,n,i);let c;try{c=await s(t,Object.assign({},o))}catch(a){throw console.error(a),new lt(Z(a),0)}if(c.ok||await Rt(c),r!=null&&r.noResolveJson)return c;try{return await c.json()}catch(a){await Rt(a)}}function J(s){var e;let t=null;bi(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Zn(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function Ut(s){const e=J(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function G(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function wi(s){return{data:s,error:null}}function yi(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i}=s,o=fi(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i},a=Object.assign({},o);return{data:{properties:c,user:a},error:null}}function vi(s){return s}function bi(s){return s.access_token&&s.refresh_token&&s.expires_in}var _i=globalThis&&globalThis.__rest||function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};class ki{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=vr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await v(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(p(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await v(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:G})}catch(r){if(p(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=_i(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await v(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:yi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(p(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await v(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:G})}catch(t){if(p(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,i,o,c,a;try{const l={nextPage:null,lastPage:0,total:0},d=await v(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:vi});if(d.error)throw d.error;const u=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(a=(c=d.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&a!==void 0?a:[];return f.length>0&&(f.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(g.split(";")[1].split("=")[1]);l[`${w}Page`]=y}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(p(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await v(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:G})}catch(t){if(p(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await v(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:G})}catch(r){if(p(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await v(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:G})}catch(r){if(p(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await v(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(p(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await v(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(p(t))return{data:null,error:t};throw t}}}const Ei={getItem:s=>ve()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{ve()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{ve()&&globalThis.localStorage.removeItem(s)}};function Bt(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function xi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ae={debug:!!(globalThis&&ve()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class _r extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ti extends _r{}async function Si(s,e,t){ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ae.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw ae.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new Ti(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(ae.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}xi();const Ci={url:Nn,storageKey:Dn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Mn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Nt(s,e,t){return await t()}class be{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=be.nextInstanceID,be.nextInstanceID+=1,this.instanceID>0&&M()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Ci),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new ki({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=vr(n.fetch),this.lock=n.lock||Nt,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:M()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Si:this.lock=Nt,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:ve()?this.storage=Ei:(this.memoryStorage={},this.storage=Bt(this.memoryStorage)):(this.memoryStorage={},this.storage=Bt(this.memoryStorage)),M()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${mr}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=ti(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),M()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Wn(i)){const a=(e=i.details)===null||e===void 0?void 0:e.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:c}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",c),await this._saveSession(o),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return p(t)?{error:t}:{error:new wr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:J}),{data:o,error:c}=i;if(c||!o)return{data:{user:null,session:null},error:c};const a=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(p(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,n;try{let i;if("email"in e){const{email:d,password:u,options:h}=e;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await oe(this.storage,this.storageKey)),i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:u,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:g},xform:J})}else if("phone"in e){const{phone:d,password:u,options:h}=e;i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(n=h==null?void 0:h.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:J})}else throw new Se("You must provide either an email or phone number and a password");const{data:o,error:c}=i;if(c||!o)return{data:{user:null,session:null},error:c};const a=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(p(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:c}=e;t=await v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Ut})}else if("phone"in e){const{phone:i,password:o,options:c}=e;t=await v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Ut})}else throw new Se("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ke}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(p(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Pe(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:i,error:o}=await v(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:J});if(await Le(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ke}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(p(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:i,nonce:o}=e,c=await v(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:J}),{data:a,error:l}=c;return l?{data:{user:null,session:null},error:l}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new Ke}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l})}catch(t){if(p(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,i,o;try{if("email"in e){const{email:c,options:a}=e;let l=null,d=null;this.flowType==="pkce"&&([l,d]=await oe(this.storage,this.storageKey));const{error:u}=await v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=a==null?void 0:a.data)!==null&&t!==void 0?t:{},create_user:(r=a==null?void 0:a.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},code_challenge:l,code_challenge_method:d},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:c,options:a}=e,{data:l,error:d}=await v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(n=a==null?void 0:a.data)!==null&&n!==void 0?n:{},create_user:(i=a==null?void 0:a.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},channel:(o=a==null?void 0:a.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:d}}throw new Se("You must provide either an email or phone number.")}catch(c){if(p(c))return{data:{user:null,session:null},error:c};throw c}}async verifyOtp(e){var t,r;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:c}=await v(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:J});if(c)throw c;if(!o)throw new Error("An error occurred on token verification.");const a=o.session,l=o.user;return a!=null&&a.access_token&&(await this._saveSession(a),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(p(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await oe(this.storage,this.storageKey)),await v(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:wi})}catch(i){if(p(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new z;const{error:n}=await v(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(p(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:o}=await v(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:o,error:c}=await v(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:c}}throw new Se("You must provide either an email or phone number and a type")}catch(t){if(p(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Pe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Ve:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(a,l,d)=>(!o&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,l,d))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:G}):await this._useSession(async t=>{var r,n,i;const{data:o,error:c}=t;if(c)throw c;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new z}:await v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:G})})}catch(t){if(p(t))return Jn(t)&&(await this._removeSession(),await Le(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new z;const o=n.session;let c=null,a=null;this.flowType==="pkce"&&e.email!=null&&([c,a]=await oe(this.storage,this.storageKey));const{data:l,error:d}=await v(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:a}),jwt:o.access_token,xform:G});if(d)throw d;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(p(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new z;const t=Date.now()/1e3;let r=t,n=!0,i=null;const{payload:o}=Qe(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{session:c,error:a}=await this._callRefreshToken(e.refresh_token);if(a)return{data:{user:null,session:null},error:a};if(!c)return{data:{user:null,session:null},error:null};i=c}else{const{data:c,error:a}=await this._getUser(e.access_token);if(a)throw a;i={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(p(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:c}=t;if(c)throw c;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new z;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(p(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!M())throw new Ce("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ce(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new It("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ce("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new It("No code detected.");const{data:A,error:I}=await this._exchangeCodeForSession(e.code);if(I)throw I;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:A.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:c,expires_at:a,token_type:l}=e;if(!i||!c||!o||!l)throw new Ce("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(c);let h=d+u;a&&(h=parseInt(a));const f=h-d;f*1e3<=ce&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const g=h-u;d-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,h,d):d-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,h,d);const{data:y,error:w}=await this._getUser(i);if(w)throw w;const T={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:u,expires_at:h,refresh_token:o,token_type:l,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:T,redirectType:e.type},error:null}}catch(r){if(p(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Pe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{error:i};const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:c}=await this.admin.signOut(o,e);if(c&&!(zn(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(await this._removeSession(),await Le(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=ei(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await oe(this.storage,this.storageKey,!0));try{return await v(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(p(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(p(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async i=>{var o,c,a,l,d;const{data:u,error:h}=i;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:!0});return await v(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return M()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(p(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)throw o;return await v(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(p(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ni(async n=>(n>0&&await si(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await v(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:J})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Ye(i)&&Date.now()+o-r<ce})}catch(r){if(this._debug(t,"error",r),p(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),M()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Pe(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Ve;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Ve}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),Ye(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new z;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Fe;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new z;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const c={session:i.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(i){if(this._debug(n,"error",i),p(i)){const o={session:null,error:i};return Ye(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(a){i.push(a)}});if(await Promise.all(o),i.length>0){for(let c=0;c<i.length;c+=1)console.error(i[c]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await br(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Le(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&M()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ce);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/ce);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${ce}ms, refresh threshold is ${at} ticks`),n<=at&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof _r)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!M()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await oe(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(c.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await v(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(p(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=await v(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((n=a==null?void 0:a.totp)===null||n===void 0)&&n.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(p(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:c}=await v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:c})})}catch(t){if(p(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(p(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Qe(n.access_token);let c=null;o.aal&&(c=o.aal);let a=c;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(a="aal2");const d=o.amr||[];return{data:{currentLevel:c,nextLevel:a,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+qn>Date.now()))return r;const{data:n,error:i}=await v(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new ye("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),r=n.keys.find(o=>o.kid===e),!r)throw new ye("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:f,error:g}=await this.getSession();if(g||!f.session)return{data:null,error:g};r=f.session.access_token}const{header:n,payload:i,signature:o,raw:{header:c,payload:a}}=Qe(r);if(ui(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:i,header:n,signature:o},error:null}}const l=hi(n.alg),d=await this.fetchJwk(n.kid,t),u=await crypto.subtle.importKey("jwk",d,l,!0,["verify"]);if(!await crypto.subtle.verify(l,u,o,Xn(`${c}.${a}`)))throw new ye("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(r){if(p(r))return{data:null,error:r};throw r}}}be.nextInstanceID=0;const Pi=be;class Li extends Pi{constructor(e){super(e)}}var Ii=globalThis&&globalThis.__awaiter||function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{l(r.next(d))}catch(u){o(u)}}function a(d){try{l(r.throw(d))}catch(u){o(u)}}function l(d){d.done?i(d.value):n(d.value).then(c,a)}l((r=r.apply(s,e||[])).next())})};class $i{constructor(e,t,r){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=Un(e);this.realtimeUrl=`${c}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${c}/auth/v1`,this.storageUrl=`${c}/storage/v1`,this.functionsUrl=`${c}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:Pn,realtime:In,auth:Object.assign(Object.assign({},Ln),{storageKey:a}),global:Cn},d=Bn(r??{},l);this.storageKey=(n=d.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(u,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=jn(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Vs(`${c}/rest/v1`,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new Es(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new xn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ii(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:i,flowType:o,lock:c,debug:a},l,d){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Li({url:this.authUrl,headers:Object.assign(Object.assign({},u),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:o,lock:c,debug:a,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new dn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ai=(s,e,t)=>new $i(s,e,t),Oi="https://fvbafecdoqslcvmyxqjf.supabase.co",ji="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2YmFmZWNkb3FzbGN2bXl4cWpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5NDg3MjYsImV4cCI6MjA1OTUyNDcyNn0.TfhLP9BBhokuAPVaxFQy4dg-MvZlsJDquVFPF-OWjOM",b=Ai(Oi,ji);async function dt(){const{data:{user:s}}=await b.auth.getUser();return s}async function Ri(s,e){const{data:t,error:r}=await b.auth.signUp({email:s,password:e});if(r)throw r;return t}async function Ui(s,e){const{data:t,error:r}=await b.auth.signInWithPassword({email:s,password:e});if(r)throw r;return t}async function Bi(){const{error:s}=await b.auth.signOut();if(s)throw s}function Ni(s){const{data:e}=b.auth.onAuthStateChange((t,r)=>{s(t,r)});return e.subscription.unsubscribe}async function Dt(){try{console.log("Initializing database...");const{error:s}=await b.from("profiles").select("id").limit(1),{error:e}=await b.from("posts").select("id").limit(1),{error:t}=await b.from("tags").select("id").limit(1),{error:r}=await b.from("post_tags").select("post_id").limit(1);return s&&console.warn("Profiles table check:",s.message),e&&console.warn("Posts table check:",e.message),t&&console.warn("Tags table check:",t.message),r&&console.warn("Post_tags table check:",r.message),{profilesExists:!s,postsExists:!e,tagsExists:!t,postTagsExists:!r}}catch(s){throw console.error("Error initializing database:",s),s}}async function wt(){try{const{data:{user:s}}=await b.auth.getUser();if(!s)throw new Error("No user logged in");const{data:e,error:t}=await b.from("posts").select(`
        *,
        tags:post_tags(
          tag:tags(*)
        )
      `).eq("user_id",s.id).order("created_at",{ascending:!1});if(t)throw t;return e.map(r=>({...r,tags:r.tags.map(n=>n.tag)}))}catch(s){throw console.error("Error getting posts:",s),s}}async function Di(s){try{const{data:{user:e}}=await b.auth.getUser();if(!e)throw new Error("No user logged in");const{data:t,error:r}=await b.from("posts").select(`
        *,
        tags:post_tags(
          tag:tags(*)
        )
      `).eq("id",s).eq("user_id",e.id).single();if(r)throw r;return{...t,tags:t.tags.map(n=>n.tag)}}catch(e){throw console.error("Error getting post:",e),e}}async function Mi(s){try{const{data:{user:e}}=await b.auth.getUser();if(!e)throw new Error("No user logged in");const{data:t,error:r}=await b.from("posts").insert([{user_id:e.id,url:s.url,platform:s.platform,title:s.title||null,description:s.description||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select();if(r)throw r;const n=t[0];return s.tags&&s.tags.length>0&&await Er(n.id,s.tags),n}catch(e){throw console.error("Error creating post:",e),e}}async function kr(s,e){try{const{data:{user:t}}=await b.auth.getUser();if(!t)throw new Error("No user logged in");const r={};e.url!==void 0&&(r.url=e.url),e.platform!==void 0&&(r.platform=e.platform),e.title!==void 0&&(r.title=e.title),e.description!==void 0&&(r.description=e.description),r.updated_at=new Date().toISOString();const{data:n,error:i}=await b.from("posts").update(r).eq("id",s).eq("user_id",t.id).select();if(i)throw i;if(e.tags){console.log("Updating tags for post:",s,"Tags:",e.tags);const{error:o}=await b.from("post_tags").delete().eq("post_id",s);if(o)throw console.error("Error deleting existing post tags:",o),o;e.tags.length>0&&await Er(s,e.tags)}return n[0]}catch(t){throw console.error("Error updating post:",t),t}}async function yt(){try{const{data:{user:s}}=await b.auth.getUser();if(!s)throw new Error("No user logged in");const{data:e,error:t}=await b.from("tags").select("*").eq("user_id",s.id).order("name");if(t)throw t;return e}catch(s){throw console.error("Error getting tags:",s),s}}async function vt(s){try{const{data:{user:e}}=await b.auth.getUser();if(!e)throw new Error("No user logged in");const{data:t,error:r}=await b.from("tags").insert([{user_id:e.id,name:s.name,color:s.color||null}]).select();if(r)throw r;return t[0]}catch(e){throw console.error("Error creating tag:",e),e}}async function Fi(s,e){try{const{data:{user:t}}=await b.auth.getUser();if(!t)throw new Error("No user logged in");const{data:r,error:n}=await b.from("tags").update(e).eq("id",s).eq("user_id",t.id).select();if(n)throw n;return r[0]}catch(t){throw console.error("Error updating tag:",t),t}}async function Er(s,e){try{const{data:{user:t}}=await b.auth.getUser();if(!t)throw new Error("No user logged in");console.log("Adding tags to post:",s,"Tags:",e);const r=e.filter(l=>l!=null);if(r.length===0){console.log("No valid tags to add");return}const i=(await Promise.all(r.map(async l=>{if(typeof l=="string")return console.log("Using tag ID directly:",l),l;if(typeof l=="object"&&l.id)return console.log("Using tag object ID:",l.id),l.id;if(typeof l=="object"&&l.name){console.log("Creating or finding tag by name:",l.name);const{data:d,error:u}=await b.from("tags").select("id").eq("name",l.name).eq("user_id",t.id);if(u)throw console.error("Error finding existing tag:",u),u;if(d&&d.length>0)return console.log("Found existing tag:",d[0].id),d[0].id;console.log("Creating new tag:",l.name);const{data:h,error:f}=await b.from("tags").insert([{user_id:t.id,name:l.name,color:l.color||"#cccccc"}]).select();if(f)throw console.error("Error creating new tag:",f),f;if(!h||h.length===0)throw console.error("No tag was created"),new Error("Failed to create tag");return console.log("Created new tag with ID:",h[0].id),h[0].id}return console.error("Invalid tag format:",l),null}))).filter(l=>l!==null);if(i.length===0){console.log("No valid tag IDs to add");return}console.log("Valid tag IDs to add:",i);const o=i.map(l=>({post_id:s,tag_id:l}));console.log("Creating post_tags entries:",o);const{data:c,error:a}=await b.from("post_tags").insert(o).select();if(a)throw console.error("Error inserting post_tags:",a),a;console.log("Successfully added tags to post:",c)}catch(t){throw console.error("Error adding tags to post:",t),t}}let K=!1,Mt=null;async function Ft(){try{console.log("Initializing sync service...");const{data:{user:s}}=await b.auth.getUser();if(!s){console.log("No user logged in, skipping sync initialization");return}qi(),await Ae(),setInterval(()=>{K||Ae()},5*60*1e3),console.log("Sync service initialized")}catch(s){console.error("Error initializing sync service:",s)}}function qi(){b.channel("public:posts").on("postgres_changes",{event:"*",schema:"public",table:"posts"},Hi).subscribe(),b.channel("public:tags").on("postgres_changes",{event:"*",schema:"public",table:"tags"},zi).subscribe(),b.channel("public:post_tags").on("postgres_changes",{event:"*",schema:"public",table:"post_tags"},Ji).subscribe(),console.log("Realtime subscriptions set up")}async function Hi(s){console.log("Posts change detected:",s),!K&&await bt()}async function zi(s){console.log("Tags change detected:",s),!K&&await xr()}async function Ji(s){console.log("Post tags change detected:",s),!K&&await bt()}async function Ae(){try{const{data:{user:s}}=await b.auth.getUser();if(!s){console.log("No user logged in, skipping sync");return}console.log("Starting data sync...","User ID:",s.id),K=!0,console.log("Syncing local data to cloud...");const e=F();console.log("Local posts to sync:",e.length),await Wi(),console.log("Syncing cloud data to local..."),await Yi();const t=await wt();console.log("Cloud posts after sync:",t.length);const r=document.createElement("div");r.className="fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-md z-50 bg-green-500 text-white",r.textContent=`Sync completed: ${t.length} posts synced`,document.body.appendChild(r),setTimeout(()=>{r.parentNode&&document.body.removeChild(r)},3e3),Mt=new Date,console.log("Data sync completed at",Mt)}catch(s){console.error("Error syncing data:",s);const e=document.createElement("div");e.className="fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-md z-50 bg-red-500 text-white",e.textContent=`Sync failed: ${s.message}`,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},5e3)}finally{K=!1}}async function Wi(){try{console.log("Syncing local data to cloud...");const s=await F(),e=await Yt();await Gi(e),await Vi(s),console.log("Local to cloud sync completed")}catch(s){throw console.error("Error syncing local to cloud:",s),s}}async function Gi(s){try{const t=(await yt()).reduce((r,n)=>(n&&n.name&&(r[n.name.toLowerCase()]=n),r),{});for(const r of s){const n=r&&r.name?r.name.toLowerCase():"";if(t[n]){const i=t[n];r.color!==i.color&&await Fi(i.id,{color:r.color})}else await vt({name:r.name,color:r.color})}}catch(e){throw console.error("Error syncing tags to cloud:",e),e}}async function Vi(s){try{const t=(await wt()).reduce((i,o)=>(i[o.url]=o,i),{}),n=(await yt()).reduce((i,o)=>(o&&o.name&&(i[o.name.toLowerCase()]=o),i),{});for(const i of s||[])if(t[i.url]){const o=t[i.url];((i.title||null)!==(o.title||null)||(i.description||null)!==(o.description||null)||(i.platform||"")!==(o.platform||""))&&await kr(o.id,{title:i.title,description:i.description,platform:i.platform}),await Ki(o.id,i.tags,n)}else{const o=(i.tags||[]).filter(a=>a&&a.name&&!n[a.name.toLowerCase()]).map(async a=>{try{const l=await vt({name:a.name,color:a.color||"#cccccc"});return l&&l.id&&(n[a.name.toLowerCase()]=l),l}catch(l){return console.error("Error creating tag:",l),null}});await Promise.all(o);const c=(i.tags||[]).map(a=>{if(!a||!a.name)return null;const l=n[a.name.toLowerCase()];return l&&l.id?l.id:null}).filter(a=>a!==null);i&&i.url?await Mi({url:i.url,platform:i.platform||"",title:i.title||null,description:i.description||null,tags:c||[]}):console.warn("Skipping post with missing URL:",i)}}catch(e){throw console.error("Error syncing posts to cloud:",e),e}}async function Ki(s,e,t){try{const n=(await Di(s)).tags||[],i=new Set(e.filter(l=>l&&l.name).map(l=>l.name.toLowerCase())),o=new Set(n.filter(l=>l&&l.name).map(l=>l.name.toLowerCase())),c=e.filter(l=>l&&l.name&&!o.has(l.name.toLowerCase())),a=n.filter(l=>l&&l.name&&!i.has(l.name.toLowerCase()));if(c.length>0||a.length>0){const l=c.map(async u=>{try{if(!u||!u.name)return null;if(t[u.name.toLowerCase()])return t[u.name.toLowerCase()];const h=await vt({name:u.name,color:u.color||"#cccccc"});return h&&h.id&&(t[u.name.toLowerCase()]=h),h}catch(h){return console.error("Error creating tag during syncPostTags:",h),null}});await Promise.all(l);const d=e.map(u=>{if(!u||!u.name)return null;const h=t[u.name.toLowerCase()];return h&&h.id?h.id:null}).filter(u=>u!==null);await kr(s,{tags:d})}}catch(r){throw console.error("Error syncing post tags:",r),r}}async function Yi(){try{console.log("Syncing cloud data to local..."),await xr(),await bt(),console.log("Cloud to local sync completed")}catch(s){throw console.error("Error syncing cloud to local:",s),s}}async function xr(){try{const s=await yt(),e=await Yt(),t=e.reduce((n,i)=>(i&&i.name&&(n[i.name.toLowerCase()]=i),n),{}),r=[...e];for(const n of s){const i=n&&n.name?n.name.toLowerCase():"";if(t[i]){const o=t[i],c=r.findIndex(a=>a&&a.name&&a.name.toLowerCase()===i);o.color!==n.color?r[c]={...o,color:n.color,id:n.id}:r[c].id=n.id}else r.push({name:n.name,color:n.color,id:n.id})}await as(r)}catch(s){throw console.error("Error syncing tags from cloud:",s),s}}async function bt(){try{const s=await wt(),e=await F(),t=e.reduce((n,i)=>(n[i.url]=i,n),{}),r=[...e];for(const n of s)if(t[n.url]){const i=t[n.url],o=r.findIndex(a=>a.url===n.url);i.title!==n.title||i.description!==n.description||i.platform!==n.platform||!Qi(i.tags,n.tags)?r[o]={...i,title:n.title,description:n.description,platform:n.platform,tags:n.tags.map(a=>({name:a.name,color:a.color,id:a.id})),id:n.id}:r[o].id=n.id}else r.push({url:n.url,platform:n.platform,title:n.title,description:n.description,tags:n.tags.map(i=>({name:i.name,color:i.color,id:i.id})),id:n.id,createdAt:new Date(n.created_at).getTime()});await ke(r),window.dispatchEvent(new CustomEvent("postsUpdated"))}catch(s){throw console.error("Error syncing posts from cloud:",s),s}}function Qi(s,e){if(!s||!e||s.length!==e.length)return!1;const t=new Set(s.filter(n=>n&&n.name).map(n=>n.name.toLowerCase())),r=new Set(e.filter(n=>n&&n.name).map(n=>n.name.toLowerCase()));for(const n of t)if(!r.has(n))return!1;for(const n of r)if(!t.has(n))return!1;return!0}function qt(){return K}async function Ht(){if(K){console.log("Sync already in progress, skipping");return}return Ae()}function Xi(){const s=document.getElementById("addLinkBtn"),e=document.getElementById("addLinkModal"),t=document.getElementById("closeModalBtn"),r=document.getElementById("cancelAddLink"),n=document.getElementById("linkForm"),i=document.getElementById("editLinkModal"),o=document.getElementById("closeEditModalBtn"),c=document.getElementById("cancelEditLink"),a=document.getElementById("deletePostBtn"),l=document.getElementById("editLinkForm");document.getElementById("tagFilter");const d=document.getElementById("menuBtn"),u=document.getElementById("menuDropdown"),h=document.getElementById("exportBtn"),f=document.getElementById("importFile"),g=document.getElementById("syncDataBtn"),y=document.getElementById("emptyStateAddBtn");s.addEventListener("click",()=>{e.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),document.getElementById("linkUrl").focus();const m=F(),_=V(m),x=document.getElementById("tagSuggestions");ze(_,x,C=>{const k=document.getElementById("linkTags"),O=ge(k.value);if(!O.includes(C)){const B=O.length>0?", ":"";k.value+=B+C}})}),t.addEventListener("click",()=>{w()}),e.addEventListener("click",m=>{m.target===e&&w()}),r.addEventListener("click",()=>{w()});function w(){e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),n.reset(),document.getElementById("tagSuggestions").innerHTML=""}function T(){i.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),l.reset(),document.getElementById("editTagSuggestions").innerHTML=""}function A(){const m=F(),_=V(m),x=document.getElementById("availableTagsContainer");x.innerHTML="",_.forEach(C=>{const k=document.createElement("span");k.className="tag cursor-pointer hover:bg-blue-200",k.dataset.tag=C,k.textContent=C,k.addEventListener("click",()=>{I(C)}),x.appendChild(k)})}function I(m){const _=document.getElementById("tagFilterContainer"),x=document.getElementById("availableTagsContainer");if(_.querySelector(`.tag[data-tag="${m}"]`))return;const k=document.createElement("span");k.className="tag bg-blue-100 text-blue-800 cursor-pointer",k.dataset.tag=m,k.textContent=m,k.addEventListener("click",()=>{S(m)}),_.appendChild(k);const O=x.querySelector(`.tag[data-tag="${m}"]`);O&&O.classList.add("hidden");const B=Et();Je(B)}function S(m){const _=document.getElementById("tagFilterContainer"),x=document.getElementById("availableTagsContainer"),C=_.querySelector(`.tag[data-tag="${m}"]`);C&&C.remove();const k=x.querySelector(`.tag[data-tag="${m}"]`);k&&k.classList.remove("hidden");const O=Et();Je(O)}function L(){const m=document.getElementById("tagFilterContainer"),_=document.getElementById("availableTagsContainer");m.innerHTML="",_.querySelectorAll(".tag").forEach(C=>{C.classList.remove("hidden")}),Je([])}n.addEventListener("submit",async m=>{m.preventDefault();const _=document.getElementById("linkUrl").value.trim(),x=document.getElementById("linkTags").value.trim(),C=ge(x);if(_){const k=n.querySelector('button[type="submit"]'),O=k.textContent;k.innerHTML='<span class="inline-block animate-spin mr-2">↻</span> Saving...',k.disabled=!0;try{if(await cs(_,C),await dt())try{qt()||await Ht()}catch(Te){console.error("Error syncing after adding post:",Te)}w()}catch(B){console.error("Error adding post:",B),alert(`Error adding post: ${B.message}`)}finally{k.innerHTML=O,k.disabled=!1}}}),A(),document.getElementById("clearTagFilters").addEventListener("click",()=>{L()}),document.addEventListener("addTagFilter",m=>{m.detail&&m.detail.tag&&I(m.detail.tag)}),document.getElementById("postsGrid").addEventListener("click",m=>{if(m.target.closest(".edit-post")){const _=m.target.closest(".post-card");_&&_.dataset.id&&Sr(_.dataset.id)}});function Sr(m){const _=ds(m);if(!_)return;document.getElementById("editPostId").value=_.id,document.getElementById("editLinkUrl").value=_.url,document.getElementById("editLinkTags").value=_.tags.join(", "),document.getElementById("editLinkModal").classList.remove("hidden"),document.body.classList.add("overflow-hidden"),document.getElementById("editLinkUrl").focus();const C=F(),k=V(C),O=document.getElementById("editTagSuggestions");ze(k,O,B=>{const Te=document.getElementById("editLinkTags"),_t=ge(Te.value);if(!_t.includes(B)){const Cr=_t.length>0?", ":"";Te.value+=Cr+B}})}o.addEventListener("click",()=>{T()}),i.addEventListener("click",m=>{m.target===i&&T()}),c.addEventListener("click",()=>{T()}),a.addEventListener("click",()=>{const m=document.getElementById("editPostId").value;m&&confirm("Are you sure you want to delete this post?")&&(ls(m),T())}),l.addEventListener("submit",m=>{m.preventDefault();const _=document.getElementById("editPostId").value,x=document.getElementById("editLinkUrl").value.trim(),C=document.getElementById("editLinkTags").value.trim(),k=ge(C);_&&x&&(us(_,x,k),T())}),d.addEventListener("click",()=>{u.classList.toggle("hidden")}),document.addEventListener("click",m=>{!d.contains(m.target)&&!u.contains(m.target)&&u.classList.add("hidden")}),h.addEventListener("click",()=>{u.classList.add("hidden"),gs()}),f.addEventListener("change",m=>{if(m.target.files.length>0){const _=m.target.files[0];ms(_).then(x=>{alert(`Import successful! Added ${x.newPostsAdded} new posts. Skipped ${x.duplicatesSkipped} duplicates.`),window.location.reload()}).catch(x=>{alert("Import failed: "+x.message)}).finally(()=>{m.target.value=""})}}),g.addEventListener("click",async()=>{if(u.classList.add("hidden"),!await dt()){alert("You need to log in to sync your data with the cloud.");return}if(qt()){alert("Sync is already in progress. Please wait.");return}const _=g.textContent;g.innerHTML='<span class="inline-block animate-spin mr-2">↻</span> Syncing...',g.disabled=!0;try{await Ht(),alert("Data sync completed successfully!"),window.location.reload()}catch(x){console.error("Sync error:",x),alert(`Sync failed: ${x.message}`)}finally{g.innerHTML=_,g.disabled=!1}}),y&&y.addEventListener("click",()=>{e.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),document.getElementById("linkUrl").focus();const m=F(),_=V(m),x=document.getElementById("tagSuggestions");ze(_,x,C=>{const k=document.getElementById("linkTags"),O=ge(k.value);if(!O.includes(C)){const B=O.length>0?", ":"";k.value+=B+C}})})}let se=null,H=!1,Y=null,Ie=[];async function Zi(){try{H=!0,$(),se=await dt(),Ni((s,e)=>{var t;switch(se=(e==null?void 0:e.user)||null,s){case"SIGNED_IN":console.log("User signed in:",(t=e==null?void 0:e.user)==null?void 0:t.email);break;case"SIGNED_OUT":console.log("User signed out");break;case"USER_UPDATED":console.log("User updated");break;case"PASSWORD_RECOVERY":console.log("Password recovery requested");break;default:break}$()})}catch(s){console.error("Error initializing auth:",s),Y=s.message}finally{H=!1,$()}}async function eo(s,e){try{H=!0,Y=null,$();const{user:t,session:r}=await Ui(s,e);return se=t,$(),{user:t,session:r}}catch(t){throw console.error("Error signing in:",t),Y=t.message,$(),t}finally{H=!1,$()}}async function to(s,e){try{H=!0,Y=null,$();const{user:t,session:r}=await Ri(s,e);return t&&(se=t),$(),{user:t,session:r}}catch(t){throw console.error("Error signing up:",t),Y=t.message,$(),t}finally{H=!1,$()}}async function ro(){try{H=!0,Y=null,$(),await Bi(),se=null,$()}catch(s){throw console.error("Error signing out:",s),Y=s.message,$(),s}finally{H=!1,$()}}function _e(){return{user:se,loading:H,error:Y,isAuthenticated:!!se}}function Tr(s){if(typeof s!="function")throw new Error("Auth listener must be a function");return Ie.push(s),s(_e()),()=>{Ie=Ie.filter(e=>e!==s)}}function $(){const s=_e();Ie.forEach(e=>{try{e(s)}catch(t){console.error("Error in auth listener:",t)}})}function so(){const s=document.createElement("div");s.className="auth-form-container bg-white p-6 rounded-lg shadow-md max-w-md mx-auto";const e=document.createElement("form");e.className="space-y-4",e.id="loginForm";const t=document.createElement("h2");t.className="text-2xl font-bold text-center text-gray-800 mb-6",t.textContent="Log in to Boardie";const r=document.createElement("div"),n=document.createElement("label");n.htmlFor="email",n.className="block text-sm font-medium text-gray-700 mb-1",n.textContent="Email";const i=document.createElement("input");i.type="email",i.id="email",i.name="email",i.required=!0,i.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",i.placeholder="you@example.com",r.appendChild(n),r.appendChild(i);const o=document.createElement("div"),c=document.createElement("label");c.htmlFor="password",c.className="block text-sm font-medium text-gray-700 mb-1",c.textContent="Password";const a=document.createElement("input");a.type="password",a.id="password",a.name="password",a.required=!0,a.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",a.placeholder="••••••••",o.appendChild(c),o.appendChild(a);const l=document.createElement("button");l.type="submit",l.className="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200",l.textContent="Sign in";const d=document.createElement("div");d.className="text-red-600 text-sm hidden",d.id="loginError";const u=document.createElement("div");return u.className="text-center mt-4 text-sm",u.innerHTML=`Don't have an account? <a href="#" id="showRegisterForm" class="text-blue-600 hover:text-blue-800">Sign up</a>`,e.appendChild(t),e.appendChild(r),e.appendChild(o),e.appendChild(d),e.appendChild(l),e.appendChild(u),s.appendChild(e),e.addEventListener("submit",async h=>{h.preventDefault();const f=i.value,g=a.value;d.textContent="",d.classList.add("hidden"),l.disabled=!0,l.innerHTML='<span class="inline-block animate-spin mr-2">↻</span> Signing in...';try{await eo(f,g)}catch(y){d.textContent=y.message||"Failed to sign in. Please check your credentials.",d.classList.remove("hidden"),l.disabled=!1,l.textContent="Sign in"}}),s}function zt(){const s=document.createElement("div");s.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",s.id="authModal";const e=document.createElement("div");e.className="relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4";const t=document.createElement("button");t.className="absolute top-4 right-4 text-gray-400 hover:text-gray-600",t.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  `,t.addEventListener("click",()=>{document.body.removeChild(s)});const r=so();e.appendChild(t),e.appendChild(r),s.appendChild(e),document.body.appendChild(s),setTimeout(()=>{document.getElementById("email").focus()},100)}function no(){const s=document.createElement("div");s.className="auth-form-container bg-white p-6 rounded-lg shadow-md max-w-md mx-auto";const e=document.createElement("form");e.className="space-y-4",e.id="registerForm";const t=document.createElement("h2");t.className="text-2xl font-bold text-center text-gray-800 mb-6",t.textContent="Create your account";const r=document.createElement("div"),n=document.createElement("label");n.htmlFor="registerEmail",n.className="block text-sm font-medium text-gray-700 mb-1",n.textContent="Email";const i=document.createElement("input");i.type="email",i.id="registerEmail",i.name="email",i.required=!0,i.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",i.placeholder="you@example.com",r.appendChild(n),r.appendChild(i);const o=document.createElement("div"),c=document.createElement("label");c.htmlFor="registerPassword",c.className="block text-sm font-medium text-gray-700 mb-1",c.textContent="Password";const a=document.createElement("input");a.type="password",a.id="registerPassword",a.name="password",a.required=!0,a.minLength=8,a.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",a.placeholder="Minimum 8 characters",o.appendChild(c),o.appendChild(a);const l=document.createElement("div"),d=document.createElement("label");d.htmlFor="confirmPassword",d.className="block text-sm font-medium text-gray-700 mb-1",d.textContent="Confirm Password";const u=document.createElement("input");u.type="password",u.id="confirmPassword",u.name="confirmPassword",u.required=!0,u.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",u.placeholder="Confirm your password",l.appendChild(d),l.appendChild(u);const h=document.createElement("button");h.type="submit",h.className="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200",h.textContent="Create Account";const f=document.createElement("div");f.className="text-red-600 text-sm hidden",f.id="registerError";const g=document.createElement("div");g.className="text-center mt-4 text-sm",g.innerHTML='Already have an account? <a href="#" id="showLoginForm" class="text-blue-600 hover:text-blue-800">Sign in</a>';const y=document.createElement("p");return y.className="text-xs text-gray-500 mt-4 text-center",y.innerHTML='By creating an account, you agree to our <a href="#" class="text-blue-600 hover:underline">Terms of Service</a> and <a href="#" class="text-blue-600 hover:underline">Privacy Policy</a>.',e.appendChild(t),e.appendChild(r),e.appendChild(o),e.appendChild(l),e.appendChild(f),e.appendChild(h),e.appendChild(g),e.appendChild(y),s.appendChild(e),e.addEventListener("submit",async w=>{w.preventDefault();const T=i.value,A=a.value,I=u.value;if(f.textContent="",f.classList.add("hidden"),A!==I){f.textContent="Passwords do not match.",f.classList.remove("hidden");return}h.disabled=!0,h.innerHTML='<span class="inline-block animate-spin mr-2">↻</span> Creating account...';try{await to(T,A);const S=document.createElement("div");S.className="fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-md z-50 bg-green-500 text-white",S.textContent="Account created successfully!",document.body.appendChild(S);const L=document.getElementById("authModal");L&&document.body.removeChild(L),setTimeout(()=>{S.parentNode&&document.body.removeChild(S)},3e3)}catch(S){f.textContent=S.message||"Failed to create account. Please try again.",f.classList.remove("hidden"),h.disabled=!1,h.textContent="Create Account"}}),s}function Jt(){const s=document.createElement("div");s.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",s.id="authModal";const e=document.createElement("div");e.className="relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4";const t=document.createElement("button");t.className="absolute top-4 right-4 text-gray-400 hover:text-gray-600",t.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  `,t.addEventListener("click",()=>{document.body.removeChild(s)});const r=no();e.appendChild(t),e.appendChild(r),s.appendChild(e),document.body.appendChild(s),setTimeout(()=>{document.getElementById("registerEmail").focus()},100)}let Oe=null;function io(){try{Oe=_e().user,ut(),Tr(e=>{Oe=e.user,ut()}),oo()}catch(s){console.error("Error initializing auth UI:",s)}}function oo(){document.addEventListener("click",s=>{if((s.target.id==="loginButton"||s.target.closest("#loginButton"))&&zt(),(s.target.id==="registerButton"||s.target.closest("#registerButton"))&&Jt(),(s.target.id==="logoutButton"||s.target.closest("#logoutButton"))&&ao(),s.target.id==="userMenuButton"||s.target.closest("#userMenuButton")){const e=document.getElementById("userMenu");e&&e.classList.toggle("hidden")}if(!s.target.closest("#userMenuButton")&&!s.target.closest("#userMenu")){const e=document.getElementById("userMenu");e&&!e.classList.contains("hidden")&&e.classList.add("hidden")}if(s.target.id==="showLoginForm"){s.preventDefault();const e=document.getElementById("authModal");e&&document.body.removeChild(e),zt()}if(s.target.id==="showRegisterForm"){s.preventDefault();const e=document.getElementById("authModal");e&&document.body.removeChild(e),Jt()}})}async function ao(){try{await ro(),Wt("You have been logged out successfully")}catch(s){console.error("Error logging out:",s),Wt("Failed to log out. Please try again.","error")}}function ut(){const s=document.getElementById("authButtons");if(!s){co();return}Oe?s.innerHTML=lo(Oe):s.innerHTML=uo()}function co(){const s=document.querySelector("header");if(s){const e=document.createElement("div");e.id="authButtons",e.className="ml-auto flex items-center",s.appendChild(e),ut()}}function lo(s){return`
    <div class="flex items-center">
      <span class="text-sm text-gray-700 mr-3 hidden sm:inline">
        ${s.email||"User"}
      </span>
      <div class="relative">
        <button
          id="userMenuButton"
          class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 transition-colors"
          aria-expanded="false"
        >
          <span class="sr-only">User menu</span>
          <span class="text-sm font-medium">${ho(s)}</span>
        </button>
        <div
          id="userMenu"
          class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden"
        >
          <a
            href="#profile"
            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
          >
            Your Profile
          </a>
          <a
            href="#settings"
            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
          >
            Settings
          </a>
          <button
            id="logoutButton"
            class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
          >
            Sign out
          </button>
        </div>
      </div>
    </div>
  `}function uo(){return`
    <div class="flex items-center space-x-2">
      <button
        id="loginButton"
        class="px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800"
      >
        Log in
      </button>
      <button
        id="registerButton"
        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700"
      >
        Sign up
      </button>
    </div>
  `}function ho(s){if(!s)return"?";if(s.user_metadata&&s.user_metadata.full_name){const e=s.user_metadata.full_name.split(" ");return e.length>=2?`${e[0][0]}${e[e.length-1][0]}`.toUpperCase():e[0][0].toUpperCase()}return s.email?s.email[0].toUpperCase():"?"}function Wt(s,e="success"){const t=document.createElement("div");t.className=`fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-md z-50 ${e==="error"?"bg-red-500 text-white":"bg-green-500 text-white"}`,t.textContent=s,document.body.appendChild(t),setTimeout(()=>{t.classList.add("opacity-0","transition-opacity","duration-500"),setTimeout(()=>{t.parentNode&&document.body.removeChild(t)},500)},3e3)}let Xe=!1;async function fo(){if(!Xe)try{console.log("Initializing auth module..."),await Zi(),io();const{user:s}=_e();s&&(console.log("User is logged in, initializing database and sync"),await Dt(),await Ft()),Tr(async e=>{console.log("Auth state changed:",e.isAuthenticated?"authenticated":"unauthenticated"),e.isAuthenticated&&e.user?(!Xe||!_e().user)&&(console.log("User signed in"),await Dt(),await Ft(),await Ae()):e.isAuthenticated||console.log("User signed out")}),Xe=!0,console.log("Auth module initialized")}catch(s){console.error("Error initializing auth module:",s)}}function go(){if(window.twttr){console.log("Twitter widgets already loaded");return}window.twttr=function(s,e,t){var r,n=s.getElementsByTagName(e)[0],i=window.twttr||{};return s.getElementById(t)||(r=s.createElement(e),r.id=t,r.src="https://platform.twitter.com/widgets.js",n.parentNode.insertBefore(r,n),i._e=[],i.ready=function(o){i._e.push(o)}),i}(document,"script","twitter-wjs"),window.twttr.ready(function(){console.log("Twitter widgets loaded and ready")})}document.addEventListener("DOMContentLoaded",async()=>{console.log("Boardie application initialized"),go();try{await fo(),console.log("Authentication initialized")}catch(e){console.error("Error initializing authentication:",e)}Xi(),F().length===0&&Qt()});export{mo as g};
