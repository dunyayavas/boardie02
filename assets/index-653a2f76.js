(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();function Rs(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function Xt(r){const e=r.toLowerCase();return e.includes("twitter.com")||e.includes("x.com")?"Twitter":e.includes("youtube.com")||e.includes("youtu.be")?"YouTube":e.includes("instagram.com")?"Instagram":e.includes("linkedin.com")?"LinkedIn":e.includes("pinterest.com")?"Pinterest":e.includes("tiktok.com")||e.includes("vm.tiktok.com")?"TikTok":"Website"}function me(r){return r?r.split(",").map(e=>e.trim()).filter(e=>e.length>0):[]}function Re(r){const e=document.getElementById("tagFilter");if(!e)return;const t=e.value;for(;e.options.length>1;)e.remove(1);if(r&&r.length>0){[...r].sort((n,i)=>{const l=typeof n=="object"&&n!==null&&n.name?n.name.toLowerCase():String(n).toLowerCase(),a=typeof i=="object"&&i!==null&&i.name?i.name.toLowerCase():String(i).toLowerCase();return l.localeCompare(a)}).forEach(n=>{let i,l;if(typeof n=="object"&&n!==null&&n.name)i=n.name,l=JSON.stringify(n);else if(n&&String(n).trim())i=String(n),l=i;else return;const a=document.createElement("option");a.value=l,a.textContent=i,a.dataset.tagName=i,e.appendChild(a)});let o=!1;for(let n=0;n<e.options.length;n++)if(e.options[n].dataset.tagName===t){e.selectedIndex=n,o=!0;break}o||(e.selectedIndex=0)}}function Ns(r,e){const t=Us(r);if(!t){Bs(e,"Invalid Instagram URL",r);return}const s=document.createElement("div");s.className="instagram-embed-container",s.innerHTML=`
    <blockquote 
      class="instagram-media" 
      data-instgrm-captioned 
      data-instgrm-permalink="https://www.instagram.com/p/${t}/" 
      data-instgrm-version="14">
      <a href="https://www.instagram.com/p/${t}/">View this post on Instagram</a>
    </blockquote>
  `,e.appendChild(s),Ds()}function Us(r){const e=/instagram\.com\/(?:p|reel)\/([A-Za-z0-9_-]+)/i,t=r.match(e);return t?t[1]:""}function Bs(r,e,t=null){r.innerHTML="";const s=document.createElement("div");if(s.className="p-4 bg-red-50 text-red-700 text-center",t){const o=document.createElement("a");o.href=t,o.target="_blank",o.rel="noopener noreferrer",o.className="underline hover:text-red-800",o.textContent=e+" - Open original",s.appendChild(o)}else s.textContent=e;r.appendChild(s)}function Ds(){if(window.instgrm){window.instgrm.Embeds&&window.instgrm.Embeds.process&&window.instgrm.Embeds.process();return}if(!document.querySelector('script[src*="//www.instagram.com/embed.js"]')){const r=document.createElement("script");r.src="//www.instagram.com/embed.js",r.async=!0,r.defer=!0,document.body.appendChild(r),r.onload=()=>{window.instgrm&&window.instgrm.Embeds&&window.instgrm.Embeds.process&&window.instgrm.Embeds.process()}}}const Ms="https://link-preview-worker.dunyayavas.workers.dev";async function Zt(r){try{if(r.includes("linkedin.com")||r.includes("pinterest.com")){const e=`${Ms}?url=${encodeURIComponent(r)}`,t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch metadata: ${t.status}`);const s=await t.json();return!s.title||s.error?(console.warn("Falling back to generated metadata due to worker error:",s.error||"Missing title"),Tt(r)):(delete s.caption,s.realCaption=null,s)}else return{title:"Web Page",description:"No metadata available for this URL",image:null,url:r,siteName:new URL(r).hostname}}catch(e){return console.error("Error fetching metadata:",e),r.includes("linkedin.com")?Tt(r):r.includes("pinterest.com")?{title:"Pinterest",description:"View this content on Pinterest",image:"https://s.pinimg.com/webapp/favicon-56d11a4a.png",url:r,siteName:"Pinterest",realCaption:null}:{title:"Web Page",description:"Error fetching metadata",image:null,url:r,siteName:new URL(r).hostname}}}function Tt(r){const e=r.toLowerCase(),t={url:r,siteName:"LinkedIn"};let s="unknown";if(e.includes("/posts/")?s="post":e.includes("/pulse/")?s="article":e.includes("/in/")?s="profile":e.includes("/company/")&&(s="company"),t.image="https://cdn-icons-png.flaticon.com/512/174/174857.png",t.caption=Fs(s),t.realCaption=null,s==="profile"){const o=/linkedin\.com\/in\/([^\/\?#]+)/i,n=r.match(o);if(n&&n[1]){const i=n[1].replace(/-/g," ");t.title=`${i} | LinkedIn`,t.description=`View ${i}'s profile on LinkedIn, the world's largest professional community.`,t.image="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"}}else if(s==="company"){const o=/linkedin\.com\/company\/([^\/\?#]+)/i,n=r.match(o);if(n&&n[1]){const i=n[1].replace(/-/g," ");t.title=`${i} | LinkedIn`,t.description=`Learn about ${i}, including available jobs, company insights, and more.`,t.image="https://cdn-icons-png.flaticon.com/512/2910/2910791.png"}}else if(s==="post"){const o=/linkedin\.com\/posts\/([^\/\?#]+)/i,n=r.match(o);if(n&&n[1]){const i=n[1].replace(/-/g," ");t.title=`LinkedIn Post by ${i}`,t.description=`Check out this post on LinkedIn by ${i}.`,t.image="https://cdn-icons-png.flaticon.com/512/5968/5968884.png"}}else if(s==="article"){const o=/linkedin\.com\/pulse\/([^\/\?#]+)(?:-([^\/\?#]+))?/i,n=r.match(o);if(n){const i=n[1]?n[1].replace(/-/g," "):"Article",l=n[2]?n[2].replace(/-/g," "):"";t.title=i.charAt(0).toUpperCase()+i.slice(1),t.description=l?`Article by ${l} on LinkedIn`:"Read this article on LinkedIn",t.image="https://cdn-icons-png.flaticon.com/512/2258/2258853.png"}}else t.title="LinkedIn",t.description="View this content on LinkedIn, the world's largest professional network.";return t}function Fs(r){const e={profile:"I am excited to share that I have joined a new company as a Senior Developer. Looking forward to this new journey! #NewBeginnings #CareerGrowth",company:"We are thrilled to announce our latest product launch! After months of hard work, our team has created something truly innovative. Check out the link to learn more. #ProductLaunch #Innovation",post:"Just finished an amazing project with my team. It is incredible what we can achieve when we collaborate effectively. #Teamwork #ProjectSuccess",article:"In my latest article, I discuss the future of remote work and how companies can adapt to this new normal. Read more to discover key strategies for success. #RemoteWork #FutureOfWork",unknown:"Sharing some thoughts on LinkedIn about professional development and career growth. What strategies have worked for you? #ProfessionalDevelopment"};return e[r]||e.unknown}function qs(r,e){const t=document.createElement("div");t.className="bg-gray-100 animate-pulse p-4 h-64 flex items-center justify-center",t.innerHTML='<p class="text-gray-500">Loading Pinterest content...</p>',e.appendChild(t);const s=r.includes("/pin/"),o=r.includes("/board/")||/pinterest\.com\/([^\/]+)\/([^\/]+)\/?$/.test(r)&&!r.includes("/pin/");if(!s&&!o){ze(e,"Invalid Pinterest URL",r);return}let n="",i={username:"",boardName:""};if(s){if(n=Hs(r),!n){ze(e,"Invalid Pinterest pin URL",r);return}}else if(o&&(i=zs(r),!i.username||!i.boardName)){ze(e,"Invalid Pinterest board URL",r);return}e.querySelectorAll(".pinterest-official-embed, .pinterest-fallback-container").forEach(d=>d.remove());const a=document.createElement("div");if(a.className="pinterest-official-embed",a.style.display="block",s){const d=document.createElement("a");d.href=r,d.setAttribute("data-pin-do","embedPin"),d.setAttribute("data-pin-width","large"),a.appendChild(d)}else if(o){const d=document.createElement("a");d.href=r,d.setAttribute("data-pin-do","embedBoard"),d.setAttribute("data-pin-board-width","180"),d.setAttribute("data-pin-scale-height","400"),d.setAttribute("data-pin-scale-width","60"),d.setAttribute("data-pin-columns","3"),a.appendChild(d)}e.appendChild(a);const c=document.createElement("div");c.className="pinterest-fallback-container",c.style.display="none",e.appendChild(c),Ws(),setTimeout(()=>{a.querySelector("iframe, span[data-pin-href]")?(c.style.display="none",a.style.display="block"):(console.log("Pinterest official embed failed to load, using fallback"),a.style.display="none",c.style.display="block",Zt(r).then(u=>{Gs(r,c,u,s)}).catch(u=>{console.error("Error fetching Pinterest metadata:",u),Js(r,c,s,n,i)}))},3e3),t&&t.parentNode&&t.remove()}function Js(r,e,t,s,o){const n=document.createElement("div");n.className="pinterest-preview-card bg-white border border-gray-200 rounded-lg overflow-hidden";const i=document.createElement("div");i.className="flex items-center p-3 bg-red-50 border-b border-gray-200",i.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6 mr-2 text-red-600">
      <path fill="currentColor" d="M12 0a12 12 0 0 0-4.37 23.17c-.1-.94-.2-2.4.04-3.44.2-.84 1.3-5.34 1.3-5.34s-.33-.67-.33-1.66c0-1.56.9-2.73 2.02-2.73.96 0 1.42.72 1.42 1.58 0 .96-.61 2.4-.93 3.74-.26 1.1.56 2.01 1.65 2.01 1.97 0 3.5-2.08 3.5-5.09 0-2.66-1.9-4.52-4.62-4.52-3.16 0-5.01 2.36-5.01 4.8 0 .95.37 1.96.82 2.52.1.11.1.2.08.31-.1.37-.3 1.16-.34 1.32-.05.21-.18.26-.4.16-1.5-.7-2.42-2.89-2.42-4.65 0-3.77 2.74-7.25 7.9-7.25 4.14 0 7.36 2.95 7.36 6.9 0 4.11-2.59 7.43-6.18 7.43-1.21 0-2.35-.63-2.74-1.37l-.74 2.84c-.27 1.04-1 2.35-1.49 3.14A12 12 0 1 0 12 0z"/>
    </svg>
    <span class="font-semibold text-gray-800">${t?"Pinterest Pin":"Pinterest Board"}</span>
  `;const l=document.createElement("div");l.className="w-full aspect-square bg-gray-100 flex items-center justify-center",l.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
    </svg>
  `;const a=document.createElement("div");a.className="p-4";const c=document.createElement("p");if(c.className="text-sm text-gray-600 mb-4",t)if(c.textContent="View this Pinterest pin to discover creative ideas and inspiration.",s){const h=document.createElement("p");h.className="text-xs text-gray-500 mt-2",h.textContent=`Pin ID: ${s}`,a.appendChild(c),a.appendChild(h)}else a.appendChild(c);else if(c.textContent="Explore this Pinterest board to discover a collection of related pins and ideas.",a.appendChild(c),o.username&&o.boardName){const h=document.createElement("p");h.className="text-xs text-gray-500 mt-2",h.textContent=`Board by ${o.username}: ${o.boardName.replace(/-/g," ")}`,a.appendChild(h)}const d=document.createElement("div");d.className="mt-2 text-xs text-gray-500 truncate",d.textContent=r,a.appendChild(d);const u=document.createElement("a");u.href=r,u.target="_blank",u.rel="noopener noreferrer",u.className="block w-full py-2 px-4 bg-red-600 hover:bg-red-700 text-white text-center rounded-b-lg transition-colors mt-4",u.textContent=t?"View Pin on Pinterest":"View Board on Pinterest",a.appendChild(u),n.appendChild(i),n.appendChild(l),n.appendChild(a),e.appendChild(n)}function Hs(r){const e=/pinterest\.com\/pin\/([0-9]+)/i,t=r.match(e);return t?t[1]:""}function zs(r){let e="",t="";const s=/pinterest\.com\/([^\/]+)\/board\/([^\/]+)/i,o=r.match(s);if(o)e=o[1],t=o[2];else{const n=/pinterest\.com\/([^\/]+)\/([^\/]+)\/?$/i,i=r.match(n);i&&!r.includes("/pin/")&&(e=i[1],t=i[2])}return{username:e,boardName:t}}function Ws(){if(window.PinUtils&&window.PinUtils.build){console.log("Pinterest widgets already loaded"),window.PinUtils.build(),setTimeout(He,500);return}if(document.getElementById("pinterest-widget-script")){console.log("Pinterest script is loading...");return}console.log("Loading Pinterest widget script");const r=document.createElement("script");r.id="pinterest-widget-script",r.async=!0,r.defer=!0,r.src="https://assets.pinterest.com/js/pinit.js",r.onload=function(){if(console.log("Pinterest widget script loaded"),window.PinUtils&&window.PinUtils.build){console.log("Building Pinterest widgets"),window.PinUtils.build(),setTimeout(He,500);let e=0;const t=setInterval(()=>{if(e>=10){clearInterval(t);return}window.PinUtils&&window.PinUtils.build&&(console.log("Rebuilding Pinterest widgets (delayed)"),window.PinUtils.build(),He()),e++},500)}},document.body.appendChild(r)}function He(){console.log("Adjusting Pinterest embeds to fit properly"),document.querySelectorAll(".pinterest-official-embed").forEach(e=>{e.style.textAlign="center",e.style.width="100%",e.style.maxWidth="100%",e.style.margin="0 auto",e.querySelectorAll("iframe").forEach(n=>{n.width<300&&(n.style.minWidth="300px"),n.style.maxWidth="100%"}),e.querySelectorAll('[data-pin-do="embedPin"]').forEach(n=>{n.style.margin="0 auto",n.style.display="block"}),e.querySelectorAll('[data-pin-do="embedBoard"]').forEach(n=>{n.style.width="100%",n.style.maxWidth="100%",n.hasAttribute("data-pin-columns")||n.setAttribute("data-pin-columns","1"),n.parentNode&&(n.parentNode.style.width="100%"),e.querySelectorAll(".pinterest-board-widget").forEach(l=>{l.style.maxWidth="100%",l.style.width="100%"})})})}function Gs(r,e,t,s){const o=document.createElement("div");o.className="pinterest-preview-card bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm";let n="";t.image&&(n+=`
      <div class="pinterest-preview-image-container w-full aspect-square bg-gray-100 overflow-hidden">
        <img src="${t.image}" alt="${t.title||"Pinterest"}" class="w-full h-full object-cover">
      </div>
    `),n+=`
    <div class="flex items-center p-3 ${t.image?"border-t border-gray-200":"bg-red-50 border-b border-gray-200"}">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 mr-2 text-red-600 flex-shrink-0">
        <path fill="currentColor" d="M12 0a12 12 0 0 0-4.37 23.17c-.1-.94-.2-2.4.04-3.44.2-.84 1.3-5.34 1.3-5.34s-.33-.67-.33-1.66c0-1.56.9-2.73 2.02-2.73.96 0 1.42.72 1.42 1.58 0 .96-.61 2.4-.93 3.74-.26 1.1.56 2.01 1.65 2.01 1.97 0 3.5-2.08 3.5-5.09 0-2.66-1.9-4.52-4.62-4.52-3.16 0-5.01 2.36-5.01 4.8 0 .95.37 1.96.82 2.52.1.11.1.2.08.31-.1.37-.3 1.16-.34 1.32-.05.21-.18.26-.4.16-1.5-.7-2.42-2.89-2.42-4.65 0-3.77 2.74-7.25 7.9-7.25 4.14 0 7.36 2.95 7.36 6.9 0 4.11-2.59 7.43-6.18 7.43-1.21 0-2.35-.63-2.74-1.37l-.74 2.84c-.27 1.04-1 2.35-1.49 3.14A12 12 0 1 0 12 0z"/>
      </svg>
      <span class="font-semibold text-gray-800 text-sm">${t.siteName||"Pinterest"}</span>
    </div>
  `,n+=`
    <div class="p-4">
      <h3 class="font-bold text-gray-900 mb-1 text-base leading-tight">${t.title||(s?"Pinterest Pin":"Pinterest Board")}</h3>
      <p class="text-sm text-gray-600 mb-2 line-clamp-2">${t.description||"View this content on Pinterest"}</p>
      <p class="text-xs text-gray-500 truncate">${r}</p>
    </div>
  `,n+=`
    <a href="${r}" target="_blank" rel="noopener noreferrer" 
       class="block w-full py-2 px-4 bg-red-600 hover:bg-red-700 text-white text-center text-sm font-medium transition-colors">
      Open in Pinterest
    </a>
  `,o.innerHTML=n,e.appendChild(o)}function ze(r,e,t=null){r.innerHTML="";const s=document.createElement("div");if(s.className="p-4 bg-red-50 text-red-700 text-center",t){const o=document.createElement("a");o.href=t,o.target="_blank",o.rel="noopener noreferrer",o.className="underline hover:text-red-800",o.textContent=e+" - Open original",s.appendChild(o)}else s.textContent=e;r.appendChild(s)}function Vs(r,e){const t=document.createElement("div");t.className="bg-gray-100 animate-pulse p-4 h-32 flex items-center justify-center",t.innerHTML='<p class="text-gray-500">Loading LinkedIn content...</p>',e.appendChild(t),Zt(r).then(s=>{const o=document.createElement("div");o.className="linkedin-preview bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm";let n="";s.image&&(n+=`
        <div class="linkedin-preview-image-container w-full aspect-video bg-gray-100 overflow-hidden">
          <img src="${s.image}" alt="${s.title}" class="w-full h-full object-cover">
        </div>
      `),n+=`
      <div class="linkedin-preview-content p-4">
        <div class="flex items-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 mr-2 text-blue-700 flex-shrink-0">
            <path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path>
          </svg>
          <span class="font-semibold text-gray-800 text-sm">${s.siteName}</span>
        </div>
        <h3 class="font-bold text-gray-900 mb-1 text-base leading-tight">${s.title}</h3>
        
        <!-- We're not showing any captions for LinkedIn posts to avoid mock content -->
        <!-- If we want to show captions in the future, we'll need to extract them from the actual LinkedIn posts -->
        
        <p class="text-sm text-gray-600 mb-2 line-clamp-2">${s.description}</p>
        <p class="text-xs text-gray-500 truncate">${r}</p>
      </div>
    `,n+=`
      <a href="${r}" target="_blank" rel="noopener noreferrer" 
         class="block w-full py-2 px-4 bg-blue-700 hover:bg-blue-800 text-white text-center text-sm font-medium transition-colors">
        Open in LinkedIn
      </a>
    `,o.innerHTML=n,t.remove(),e.appendChild(o)}).catch(s=>{console.error("Error fetching LinkedIn metadata:",s);const o=document.createElement("div");o.className="linkedin-preview bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm",o.innerHTML=`
      <div class="linkedin-preview-content p-4">
        <div class="flex items-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 mr-2 text-blue-700 flex-shrink-0">
            <path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path>
          </svg>
          <span class="font-semibold text-gray-800 text-sm">LinkedIn</span>
        </div>
        <h3 class="font-bold text-gray-900 mb-1 text-base leading-tight">LinkedIn Content</h3>
        <p class="text-sm text-gray-600 mb-2">View this content on LinkedIn, the world's largest professional network.</p>
        <p class="text-xs text-gray-500 truncate">${r}</p>
      </div>
      <a href="${r}" target="_blank" rel="noopener noreferrer" 
         class="block w-full py-2 px-4 bg-blue-700 hover:bg-blue-800 text-white text-center text-sm font-medium transition-colors">
        Open in LinkedIn
      </a>
    `,t.remove(),e.appendChild(o)})}function Ks(r,e){const t=Ys(r);if(!t){Qs(e,"Invalid TikTok URL",r);return}const s=document.createElement("div");s.className="tiktok-embed-container",s.innerHTML=`
    <blockquote class="tiktok-embed" cite="${r}" 
      data-video-id="${t}" 
      style="max-width: 605px; min-width: 325px;">
      <section>
        <a target="_blank" href="https://www.tiktok.com/@tiktok">@tiktok</a>
      </section>
    </blockquote>
  `,e.appendChild(s),Xs()}function Ys(r){let e=/tiktok\.com\/@[\w.-]+\/video\/(\d+)/i,t=r.match(e);return t?t[1]:(e=/vm\.tiktok\.com\/[\w]+\/?/i,t=r.match(e),t?"shorturl":"")}function Qs(r,e,t){r.innerHTML=`
    <div class="bg-red-50 border border-red-200 text-red-800 rounded-lg p-4">
      <p class="font-medium">${e}</p>
      <p class="text-sm mt-2 break-all">${t}</p>
    </div>
  `}function Xs(){if(window.tiktokEmbedsLoaded){window.tiktokProcessEmbed&&window.tiktokProcessEmbed();return}if(!document.querySelector('script[src*="//www.tiktok.com/embed.js"]')){const r=document.createElement("script");r.src="https://www.tiktok.com/embed.js",r.async=!0,r.defer=!0,document.body.appendChild(r),window.tiktokEmbedsLoaded=!0,r.onload=()=>{window.tiktokProcessEmbed=()=>{console.log("TikTok embed script loaded")},window.tiktokProcessEmbed()}}}function Zs(r,e){try{const s=new URL(r).hostname,o=s.replace(/^www\./,""),n=document.createElement("div");n.className="website-preview rounded-lg overflow-hidden border border-gray-200";const l=`
      <div class="website-preview-content">
        <div class="website-preview-header p-4 pb-2 flex items-center">
          <img src="${`https://www.google.com/s2/favicons?domain=${o}&sz=128`}" class="w-6 h-6 mr-2 rounded-sm" onerror="this.style.display='none'">
          <span class="text-sm text-gray-600 truncate">${s}</span>
        </div>
        <div class="website-preview-text p-4 pt-0">
          <h3 class="text-lg font-semibold mb-2 line-clamp-2">${tr(r,o)}</h3>
          <p class="text-sm text-gray-600 mb-2 line-clamp-3">${sr(r)}</p>
        </div>
        <div class="website-preview-image bg-gray-100 flex items-center justify-center" style="height: 140px;">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
          </svg>
        </div>
      </div>
      <a href="${r}" target="_blank" rel="noopener noreferrer" class="block w-full text-center text-sm text-blue-600 hover:text-blue-800 py-2 border-t border-gray-200">
        Visit Website
      </a>
    `;n.innerHTML=l,e.appendChild(n),er(r,n)}catch(t){console.error("Error creating website preview:",t),rr(e,"Could not create website preview",r)}}function er(r,e){const t=`https://image.thum.io/get/width/800/crop/600/noanimate/${r}`,s=e.querySelector(".website-preview-image");if(s){const o=document.createElement("img");o.className="w-full h-full object-cover",o.alt="Website preview",o.onload=function(){s.innerHTML="",s.appendChild(o)},o.onerror=function(){},o.src=t}}function tr(r,e){const s=new URL(r).pathname.split("/").filter(o=>o.length>0);if(s.length>0){let o=s[s.length-1];if(o=o.replace(/\.(html|php|asp|jsp)$/,""),o=o.replace(/[-_]/g," "),o=o.split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),o.length>3)return o}return e.charAt(0).toUpperCase()+e.slice(1)}function sr(r){const e=new URL(r);if(e.hostname.includes("github.com")){const t=e.pathname.split("/").filter(s=>s.length>0);return t.length>=2?`GitHub repository by ${t[0]}`:"GitHub - Where the world builds software"}return e.hostname.includes("medium.com")?"Article on Medium - Where good ideas find you":e.hostname.includes("wikipedia.org")?"Wikipedia article - The Free Encyclopedia":`Web page on ${e.hostname.replace(/^www\./,"")}`}function rr(r,e,t){r.innerHTML=`
    <div class="bg-red-50 border border-red-200 text-red-800 rounded-lg p-4">
      <p class="font-medium">${e}</p>
      <p class="text-sm mt-2 break-all">${t}</p>
    </div>
  `}function nr(r,e){const t=document.createElement("div");t.className="bg-gray-100 animate-pulse p-4 h-48 flex items-center justify-center",t.innerHTML='<p class="text-gray-500">Loading tweet...</p>',e.appendChild(t);const s=ur(r);if(!s){tt(e,"Invalid Twitter URL",r);return}const o=document.createElement("div");o.className="twitter-embed-container",e.appendChild(o);const n=()=>{window.twttr&&window.twttr.widgets?window.twttr.widgets.createTweet(s,o,{theme:"light",dnt:!0,align:"center"}).then(i=>{t.remove()}).catch(i=>{console.error("Error creating Twitter embed:",i),tt(e,"Could not load tweet",r)}):setTimeout(n,1e3)};n()}function or(r,e){const t=hr(r);if(!t){tt(e,"Invalid YouTube URL");return}const s=document.createElement("div");s.className="bg-gray-100 animate-pulse p-4 h-48 flex items-center justify-center",s.innerHTML='<p class="text-gray-500">Loading YouTube video...</p>',e.appendChild(s);const o=document.createElement("div");o.className="youtube-embed-container";const n=document.createElement("iframe");n.src=`https://www.youtube.com/embed/${t}?origin=${encodeURIComponent(window.location.origin)}&enablejsapi=1`,n.title="YouTube video player",n.setAttribute("frameborder","0"),n.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),n.setAttribute("allowfullscreen",""),n.setAttribute("loading","lazy"),n.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),n.addEventListener("load",()=>{s&&s.parentNode&&s.remove()}),o.appendChild(n),e.appendChild(o)}function ir(r,e){return Ns(r,e)}function ar(r,e){return qs(r,e)}function lr(r,e){return Vs(r,e)}function cr(r,e){Ks(r,e)}function dr(r,e){return Zs(r,e)}function tt(r,e,t=null){r.innerHTML="";const s=document.createElement("div");if(s.className="p-4 bg-red-50 text-red-700 text-center",t){const o=document.createElement("a");o.href=t,o.target="_blank",o.rel="noopener noreferrer",o.className="underline hover:text-red-800",o.textContent=e+" - Open original",s.appendChild(o)}else s.textContent=e;r.appendChild(s)}function ur(r){const e=/(?:twitter|x)\.com\/(?:#!\/)?(?:\w+)\/status(?:es)?\/(\d+)/i,t=r.match(e);if(t&&t[1])return t[1];const s=/(?:twitter|x)\.com\/(?:i\/web|intent)\/status\/(\d+)/i,o=r.match(s);return o?o[1]:""}function hr(r){const e=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,t=r.match(e);return t?t[1]:""}function fr(r){if(!r||typeof r!="string")return!0;r=r.replace("#",""),r.length===3&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]);const e=parseInt(r.substr(0,2),16),t=parseInt(r.substr(2,2),16),s=parseInt(r.substr(4,2),16);return isNaN(e)||isNaN(t)||isNaN(s)?!0:(.299*e+.587*t+.114*s)/255>.5}function es(r,e=!1,t=!1){let s,o;typeof r=="object"&&r!==null&&r.name?(s=r.name,o=r.color||"#cccccc"):(s=String(r),o="#cccccc");const n=document.createElement("span");n.className="tag",n.dataset.tagName=s,o&&(n.style.backgroundColor=o+"80",n.style.borderColor=o,fr(o)?n.style.color="#333":n.style.color="white"),e&&(n.classList.add("cursor-pointer","hover:bg-blue-200"),n.addEventListener("click",l=>{if(l.target.tagName==="BUTTON")return;const a=n.dataset.tag;if(document.getElementById("tagFilterContainer")){const c=new CustomEvent("addTagFilter",{detail:{tag:a}});document.dispatchEvent(c)}else{const c=document.getElementById("tagFilter");if(c){let d=!1;for(let u=0;u<c.options.length;u++)if(c.options[u].value===a){d=!0;break}if(!d){const u=document.createElement("option");u.value=a,u.textContent=a,c.appendChild(u)}c.value=a,c.dispatchEvent(new Event("change"))}}}));const i=document.createElement("span");if(i.textContent=s,n.appendChild(i),t){const l=document.createElement("button");l.className="ml-1 text-blue-800 hover:text-red-500 focus:outline-none",l.innerHTML="&times;",l.setAttribute("aria-label",`Remove ${s} tag`),l.addEventListener("click",a=>{a.stopPropagation(),a.preventDefault();const c=new CustomEvent("tagDelete",{bubbles:!0,cancelable:!0,detail:{tag:s}});n.dispatchEvent(c)}),n.appendChild(l)}return n}function gr(r,e,t=null){if(e.innerHTML="",!r||r.length===0){const s=document.createElement("span");s.className="text-gray-400 text-sm italic",s.textContent="No tags",e.appendChild(s);return}r.forEach(s=>{const o=es(s,!0,!!t);t&&o.addEventListener("tagDelete",n=>{t(n.detail.tag)}),e.appendChild(o)})}function We(r,e,t){if(e.innerHTML="",!r||r.length===0)return;const s=document.createElement("p");s.className="text-sm text-gray-500 mb-2",s.textContent="Suggested tags:",e.appendChild(s);const o=document.createElement("div");o.className="flex flex-wrap gap-1",r.forEach(n=>{const i=es(n,!1,!1);i.classList.add("cursor-pointer","hover:bg-blue-200"),i.addEventListener("click",()=>{t(n)}),o.appendChild(i)}),e.appendChild(o)}function K(r){const e=new Map;return r.forEach(t=>{t.tags&&Array.isArray(t.tags)&&t.tags.forEach(s=>{typeof s=="object"&&s!==null&&s.name?e.set(s.name.toLowerCase(),s):typeof s=="string"&&(e.has(s.toLowerCase())||e.set(s.toLowerCase(),s))})}),Array.from(e.values()).sort((t,s)=>{const o=typeof t=="object"&&t!==null&&t.name?t.name.toLowerCase():String(t).toLowerCase(),n=typeof s=="object"&&s!==null&&s.name?s.name.toLowerCase():String(s).toLowerCase();return o.localeCompare(n)})}const se="boardie_posts",st="boardie_tags";function q(){try{const r=localStorage.getItem(se),e=r?JSON.parse(r):[];return re(e),Re(K(e)),e}catch(r){return console.error("Error loading posts:",r),r instanceof SyntaxError&&(console.log("Attempting to recover from corrupted storage"),localStorage.removeItem(se)),[]}}function ke(r){try{localStorage.setItem(se,JSON.stringify(r))}catch(e){console.error("Error saving posts:",e)}}function gt(){try{const r=localStorage.getItem(st);return r?JSON.parse(r):[]}catch(r){return console.error("Error loading tags:",r),r instanceof SyntaxError&&(console.log("Attempting to recover from corrupted tags storage"),localStorage.removeItem(st)),[]}}function mr(r){try{localStorage.setItem(st,JSON.stringify(r))}catch(e){console.error("Error saving tags:",e)}}function pr(r,e=[]){let t=[];try{const n=localStorage.getItem(se);t=n?JSON.parse(n):[]}catch(n){console.error("Error loading existing posts:",n),t=[]}const s=Xt(r),o={id:Rs(),url:r,platform:s,tags:e,dateAdded:new Date().toISOString()};t.push(o),ke(t),re(t),Re(K(t)),document.getElementById("noPostsMessage").classList.add("hidden")}function wr(r){const t=q().filter(s=>s.id!==r);ke(t),re(t)}function yr(r){let e=[];try{const t=localStorage.getItem(se);e=t?JSON.parse(t):[]}catch(t){return console.error("Error loading post by ID:",t),null}return e.find(t=>t.id===r)||null}function vr(r,e,t){let s=[];try{const n=localStorage.getItem(se);s=n?JSON.parse(n):[]}catch(n){console.error("Error loading posts for update:",n);return}const o=s.findIndex(n=>n.id===r);if(o!==-1){const n=Xt(e);s[o]={...s[o],url:e,platform:n,tags:t,updatedAt:new Date().toISOString()},ke(s),re(s),Re(K(s))}}function re(r){const e=document.getElementById("postsGrid"),t=document.getElementById("postTemplate");e.innerHTML="";const s=[...r].sort((n,i)=>new Date(i.dateAdded)-new Date(n.dateAdded)),o=s.map(n=>{const i=document.importNode(t.content,!0).firstElementChild;i.dataset.id=n.id,i.dataset.platform=n.platform,i.dataset.url=n.url,i.classList.add("opacity-0");const l=i.querySelector(".post-embed"),a=n.platform==="twitter"?"500px":n.platform==="instagram"?"600px":"300px";l.innerHTML=`
      <div class="embed-placeholder bg-gray-100 animate-pulse flex items-center justify-center" 
           style="height: ${a}">
        <p class="text-gray-500">Loading ${n.platform} post...</p>
      </div>
    `;const c=i.querySelector(".post-tags");return gr(n.tags,c,d=>{_r(n.id,d)}),{element:i,post:n}});o.forEach(({element:n})=>{e.appendChild(n)}),o.forEach(({element:n,post:i},l)=>{setTimeout(()=>{const a=n.querySelector(".post-embed");br(i.url,i.platform,a);const c=()=>{const d=a.querySelector(".embed-placeholder");d&&d.remove(),n.classList.remove("opacity-0"),n.classList.add("opacity-100")};setTimeout(()=>{const d=a.querySelectorAll("iframe"),u=a.querySelectorAll("img");d.length===0&&u.length===0?c():(d.forEach(h=>{var f;h.complete||((f=h.contentDocument)==null?void 0:f.readyState)==="complete"?c():h.addEventListener("load",c,{once:!0})}),u.forEach(h=>{h.complete?c():h.addEventListener("load",c,{once:!0})}),setTimeout(c,3e3))},100)},l*100)}),s.length===0?ts():document.getElementById("noPostsMessage").classList.add("hidden")}function br(r,e,t){switch(e.toLowerCase()){case"twitter":case"x":nr(r,t);break;case"youtube":or(r,t);break;case"instagram":ir(r,t);break;case"pinterest":ar(r,t);break;case"linkedin":lr(r,t);break;case"tiktok":cr(r,t);break;default:dr(r,t)}}function xt(){const r=[];return document.getElementById("tagFilterContainer").querySelectorAll(".tag").forEach(s=>{if(s.dataset.tagJson)try{const o=JSON.parse(s.dataset.tagJson);r.push(o)}catch{r.push(s.dataset.tagName)}else s.dataset.tagName?r.push(s.dataset.tagName):s.dataset.tag&&r.push(s.dataset.tag)}),r}function Ge(r=[]){let e=[];try{const s=localStorage.getItem(se);e=s?JSON.parse(s):[]}catch(s){console.error("Error loading posts for filtering:",s),e=[]}const t=document.getElementById("clearTagFilters");if(r.length>0?t.classList.remove("hidden"):t.classList.add("hidden"),r.length===0)re(e);else{const s=e.filter(o=>!o.tags||!Array.isArray(o.tags)||o.tags.length===0?!1:r.every(n=>{const i=typeof n=="object"&&n!==null&&n.name?n.name.toLowerCase():String(n).toLowerCase();return o.tags.some(l=>(typeof l=="object"&&l!==null&&l.name?l.name.toLowerCase():String(l).toLowerCase())===i)}));re(s)}}function _r(r,e){const t=q(),s=t.findIndex(o=>o.id===r);s!==-1&&(t[s].tags=t[s].tags.filter(o=>o!==e),ke(t),re(t),Re(K(t)))}function ts(){document.getElementById("noPostsMessage").classList.remove("hidden")}const rt="boardie_posts";function Er(){try{const r=localStorage.getItem(rt),e=r?JSON.parse(r):[];if(!e||e.length===0){alert("No posts to export");return}const t={version:"0.1.0",timestamp:new Date().toISOString(),count:e.length,posts:e},s=JSON.stringify(t,null,2),o=new Blob([s],{type:"application/json"}),n=URL.createObjectURL(o),i=document.createElement("a");return i.href=n,i.download=`boardie-export-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n),!0}catch(r){return console.error("Error exporting posts:",r),alert("Failed to export posts: "+r.message),!1}}function kr(r){return new Promise((e,t)=>{const s=new FileReader;s.onload=o=>{try{const n=JSON.parse(o.target.result);if(!n.posts||!Array.isArray(n.posts)){t(new Error("Invalid import file format"));return}const i=JSON.parse(localStorage.getItem(rt)||"[]"),l=new Set(i.map(d=>d.id)),a=n.posts.filter(d=>!l.has(d.id)),c=[...i,...a];localStorage.setItem(rt,JSON.stringify(c)),e({success:!0,totalImported:n.posts.length,newPostsAdded:a.length,duplicatesSkipped:n.posts.length-a.length})}catch(n){console.error("Error importing posts:",n),t(n)}},s.onerror=o=>{t(o)},s.readAsText(r)})}const Tr="modulepreload",xr=function(r){return"/boardie02/"+r},St={},ue=function(e,t,s){if(!t||t.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(t.map(n=>{if(n=xr(n),n in St)return;St[n]=!0;const i=n.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(!!s)for(let d=o.length-1;d>=0;d--){const u=o[d];if(u.href===n&&(!i||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${l}`))return;const c=document.createElement("link");if(c.rel=i?"stylesheet":Tr,i||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),i)return new Promise((d,u)=>{c.addEventListener("load",d),c.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n})},Sr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ue(()=>Promise.resolve().then(()=>fe),void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class mt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Cr extends mt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Pr extends mt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Lr extends mt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var nt;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(nt||(nt={}));var Ir=globalThis&&globalThis.__awaiter||function(r,e,t,s){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function l(d){try{c(s.next(d))}catch(u){i(u)}}function a(d){try{c(s.throw(d))}catch(u){i(u)}}function c(d){d.done?n(d.value):o(d.value).then(l,a)}c((s=s.apply(r,e||[])).next())})};class Ar{constructor(e,{headers:t={},customFetch:s,region:o=nt.Any}={}){this.url=e,this.headers=t,this.region=o,this.fetch=Sr(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Ir(this,void 0,void 0,function*(){try{const{headers:o,method:n,body:i}=t;let l={},{region:a}=t;a||(a=this.region),a&&a!=="any"&&(l["x-region"]=a);let c;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",c=i):typeof i=="string"?(l["Content-Type"]="text/plain",c=i):typeof FormData<"u"&&i instanceof FormData?c=i:(l["Content-Type"]="application/json",c=JSON.stringify(i)));const d=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),o),body:c}).catch(m=>{throw new Cr(m)}),u=d.headers.get("x-relay-error");if(u&&u==="true")throw new Pr(d);if(!d.ok)throw new Lr(d);let h=((s=d.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),f;return h==="application/json"?f=yield d.json():h==="application/octet-stream"?f=yield d.blob():h==="text/event-stream"?f=d:h==="multipart/form-data"?f=yield d.formData():f=yield d.text(),{data:f,error:null}}catch(o){return{data:null,error:o}}})}}var D=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Or(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var o=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:function(){return r[s]}})}),t}var U={},pt={},Ne={},Te={},Ue={},Be={},$r=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},he=$r();const jr=he.fetch,ss=he.fetch.bind(he),rs=he.Headers,Rr=he.Request,Nr=he.Response,fe=Object.freeze(Object.defineProperty({__proto__:null,Headers:rs,Request:Rr,Response:Nr,default:ss,fetch:jr},Symbol.toStringTag,{value:"Module"})),Ur=Or(fe);var De={};Object.defineProperty(De,"__esModule",{value:!0});let Br=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};De.default=Br;var ns=D&&D.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Be,"__esModule",{value:!0});const Dr=ns(Ur),Mr=ns(De);let Fr=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Dr.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let o=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var i,l,a;let c=null,d=null,u=null,h=n.status,f=n.statusText;if(n.ok){if(this.method!=="HEAD"){const P=await n.text();P===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=P:d=JSON.parse(P))}const v=(i=this.headers.Prefer)===null||i===void 0?void 0:i.match(/count=(exact|planned|estimated)/),y=(l=n.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");v&&y&&y.length>1&&(u=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(c={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,u=null,h=406,f="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const v=await n.text();try{c=JSON.parse(v),Array.isArray(c)&&n.status===404&&(d=[],c=null,h=200,f="OK")}catch{n.status===404&&v===""?(h=204,f="No Content"):c={message:v}}if(c&&this.isMaybeSingle&&(!((a=c==null?void 0:c.details)===null||a===void 0)&&a.includes("0 rows"))&&(c=null,h=200,f="OK"),c&&this.shouldThrowOnError)throw new Mr.default(c)}return{error:c,data:d,count:u,status:h,statusText:f}});return this.shouldThrowOnError||(o=o.catch(n=>{var i,l,a;return{error:{message:`${(i=n==null?void 0:n.name)!==null&&i!==void 0?i:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(l=n==null?void 0:n.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(a=n==null?void 0:n.code)!==null&&a!==void 0?a:""}`},data:null,count:null,status:0,statusText:""}})),o.then(e,t)}returns(){return this}overrideTypes(){return this}};Be.default=Fr;var qr=D&&D.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ue,"__esModule",{value:!0});const Jr=qr(Be);let Hr=class extends Jr.default{select(e){let t=!1;const s=(e??"*").split("").map(o=>/\s/.test(o)&&!t?"":(o==='"'&&(t=!t),o)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:o,referencedTable:n=o}={}){const i=n?`${n}.order`:"order",l=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(o,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:o=s}={}){const n=typeof o>"u"?"offset":`${o}.offset`,i=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:o=!1,wal:n=!1,format:i="text"}={}){var l;const a=[e?"analyze":null,t?"verbose":null,s?"settings":null,o?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${c}"; options=${a};`,i==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ue.default=Hr;var zr=D&&D.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Te,"__esModule",{value:!0});const Wr=zr(Ue);let Gr=class extends Wr.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:o}={}){let n="";o==="plain"?n="pl":o==="phrase"?n="ph":o==="websearch"&&(n="w");const i=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const o=s?`${s}.or`:"or";return this.url.searchParams.append(o,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Te.default=Gr;var Vr=D&&D.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ne,"__esModule",{value:!0});const pe=Vr(Te);let Kr=class{constructor(e,{headers:t={},schema:s,fetch:o}){this.url=e,this.headers=t,this.schema=s,this.fetch=o}select(e,{head:t=!1,count:s}={}){const o=t?"HEAD":"GET";let n=!1;const i=(e??"*").split("").map(l=>/\s/.test(l)&&!n?"":(l==='"'&&(n=!n),l)).join("");return this.url.searchParams.set("select",i),s&&(this.headers.Prefer=`count=${s}`),new pe.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const o="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),s||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const i=e.reduce((l,a)=>l.concat(Object.keys(a)),[]);if(i.length>0){const l=[...new Set(i)].map(a=>`"${a}"`);this.url.searchParams.set("columns",l.join(","))}}return new pe.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:o,defaultToNull:n=!0}={}){const i="POST",l=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),o&&l.push(`count=${o}`),n||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const a=e.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(a.length>0){const c=[...new Set(a)].map(d=>`"${d}"`);this.url.searchParams.set("columns",c.join(","))}}return new pe.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),this.headers.Prefer=o.join(","),new pe.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new pe.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Ne.default=Kr;var Me={},Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.version=void 0;Fe.version="0.0.0-automated";Object.defineProperty(Me,"__esModule",{value:!0});Me.DEFAULT_HEADERS=void 0;const Yr=Fe;Me.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Yr.version}`};var os=D&&D.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(pt,"__esModule",{value:!0});const Qr=os(Ne),Xr=os(Te),Zr=Me;let en=class is{constructor(e,{headers:t={},schema:s,fetch:o}={}){this.url=e,this.headers=Object.assign(Object.assign({},Zr.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=o}from(e){const t=new URL(`${this.url}/${e}`);return new Qr.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new is(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:o=!1,count:n}={}){let i;const l=new URL(`${this.url}/rpc/${e}`);let a;s||o?(i=s?"HEAD":"GET",Object.entries(t).filter(([d,u])=>u!==void 0).map(([d,u])=>[d,Array.isArray(u)?`{${u.join(",")}}`:`${u}`]).forEach(([d,u])=>{l.searchParams.append(d,u)})):(i="POST",a=t);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new Xr.default({method:i,url:l,headers:c,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};pt.default=en;var ge=D&&D.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(U,"__esModule",{value:!0});U.PostgrestError=U.PostgrestBuilder=U.PostgrestTransformBuilder=U.PostgrestFilterBuilder=U.PostgrestQueryBuilder=U.PostgrestClient=void 0;const as=ge(pt);U.PostgrestClient=as.default;const ls=ge(Ne);U.PostgrestQueryBuilder=ls.default;const cs=ge(Te);U.PostgrestFilterBuilder=cs.default;const ds=ge(Ue);U.PostgrestTransformBuilder=ds.default;const us=ge(Be);U.PostgrestBuilder=us.default;const hs=ge(De);U.PostgrestError=hs.default;var tn=U.default={PostgrestClient:as.default,PostgrestQueryBuilder:ls.default,PostgrestFilterBuilder:cs.default,PostgrestTransformBuilder:ds.default,PostgrestBuilder:us.default,PostgrestError:hs.default};const{PostgrestClient:sn,PostgrestQueryBuilder:Ti,PostgrestFilterBuilder:xi,PostgrestTransformBuilder:Si,PostgrestBuilder:Ci,PostgrestError:Pi}=tn,rn="2.11.2",nn={"X-Client-Info":`realtime-js/${rn}`},on="1.0.0",fs=1e4,an=1e3;var de;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(de||(de={}));var B;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(B||(B={}));var M;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(M||(M={}));var ot;(function(r){r.websocket="websocket"})(ot||(ot={}));var ee;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ee||(ee={}));class ln{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const o=t.getUint8(1),n=t.getUint8(2);let i=this.HEADER_LENGTH+2;const l=s.decode(e.slice(i,i+o));i=i+o;const a=s.decode(e.slice(i,i+n));i=i+n;const c=JSON.parse(s.decode(e.slice(i,e.byteLength)));return{ref:null,topic:l,event:a,payload:c}}}class gs{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var x;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(x||(x={}));const Ct=(r,e,t={})=>{var s;const o=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((n,i)=>(n[i]=cn(i,r,e,o),n),{})},cn=(r,e,t,s)=>{const o=e.find(l=>l.name===r),n=o==null?void 0:o.type,i=t[r];return n&&!s.includes(n)?ms(n,i):it(i)},ms=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return fn(e,t)}switch(r){case x.bool:return dn(e);case x.float4:case x.float8:case x.int2:case x.int4:case x.int8:case x.numeric:case x.oid:return un(e);case x.json:case x.jsonb:return hn(e);case x.timestamp:return gn(e);case x.abstime:case x.date:case x.daterange:case x.int4range:case x.int8range:case x.money:case x.reltime:case x.text:case x.time:case x.timestamptz:case x.timetz:case x.tsrange:case x.tstzrange:return it(e);default:return it(e)}},it=r=>r,dn=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},un=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},hn=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},fn=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const i=r.slice(1,t);try{n=JSON.parse("["+i+"]")}catch{n=i?i.split(","):[]}return n.map(l=>ms(e,l))}return r},gn=r=>typeof r=="string"?r.replace(" ","T"):r,ps=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ve{constructor(e,t,s={},o=fs){this.channel=e,this.event=t,this.payload=s,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Pt;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Pt||(Pt={}));class ye{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},o=>{const{onJoin:n,onLeave:i,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ye.syncState(this.state,o,n,i),this.pendingDiffs.forEach(a=>{this.state=ye.syncDiff(this.state,a,n,i)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},o=>{const{onJoin:n,onLeave:i,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=ye.syncDiff(this.state,o,n,i),l())}),this.onJoin((o,n,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:n,newPresences:i})}),this.onLeave((o,n,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:n,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,o){const n=this.cloneDeep(e),i=this.transformState(t),l={},a={};return this.map(n,(c,d)=>{i[c]||(a[c]=d)}),this.map(i,(c,d)=>{const u=n[c];if(u){const h=d.map(y=>y.presence_ref),f=u.map(y=>y.presence_ref),m=d.filter(y=>f.indexOf(y.presence_ref)<0),v=u.filter(y=>h.indexOf(y.presence_ref)<0);m.length>0&&(l[c]=m),v.length>0&&(a[c]=v)}else l[c]=d}),this.syncDiff(n,{joins:l,leaves:a},s,o)}static syncDiff(e,t,s,o){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),o||(o=()=>{}),this.map(n,(l,a)=>{var c;const d=(c=e[l])!==null&&c!==void 0?c:[];if(e[l]=this.cloneDeep(a),d.length>0){const u=e[l].map(f=>f.presence_ref),h=d.filter(f=>u.indexOf(f.presence_ref)<0);e[l].unshift(...h)}s(l,d,a)}),this.map(i,(l,a)=>{let c=e[l];if(!c)return;const d=a.map(u=>u.presence_ref);c=c.filter(u=>d.indexOf(u.presence_ref)<0),e[l]=c,o(l,c,a),c.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const o=e[s];return"metas"in o?t[s]=o.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=o,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Lt;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Lt||(Lt={}));var It;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(It||(It={}));var J;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(J||(J={}));class wt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=B.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ve(this,M.join,this.params,this.timeout),this.rejoinTimer=new gs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=B.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=B.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=B.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=B.errored,this.rejoinTimer.scheduleTimeout())}),this._on(M.reply,{},(o,n)=>{this._trigger(this._replyEventName(n),o)}),this.presence=new ye(this),this.broadcastEndpointURL=ps(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,o;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:i,private:l}}=this.params;this._onError(d=>e==null?void 0:e(J.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(J.CLOSED));const a={},c={broadcast:n,presence:i,postgres_changes:(o=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&o!==void 0?o:[],private:l};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var u;if(this.socket.setAuth(),d===void 0){e==null||e(J.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,f=(u=h==null?void 0:h.length)!==null&&u!==void 0?u:0,m=[];for(let v=0;v<f;v++){const y=h[v],{filter:{event:P,schema:R,table:$,filter:L}}=y,O=d&&d[v];if(O&&O.event===P&&O.schema===R&&O.table===$&&O.filter===L)m.push(Object.assign(Object.assign({},y),{id:O.id}));else{this.unsubscribe(),e==null||e(J.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,e&&e(J.SUBSCRIBED);return}}).receive("error",d=>{e==null||e(J.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(J.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,o;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:i}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var i,l,a;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((a=(l=(i=this.params)===null||i===void 0?void 0:i.config)===null||l===void 0?void 0:l.broadcast)===null||a===void 0)&&a.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("error",()=>n("error")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=B.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(M.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const o=new Ve(this,M.leave,{},e);o.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),o.send(),this._canPush()||o.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const o=new AbortController,n=setTimeout(()=>o.abort(),s),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:o.signal}));return clearTimeout(n),i}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Ve(this,e,t,s);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var o,n;const i=e.toLocaleLowerCase(),{close:l,error:a,leave:c,join:d}=M;if(s&&[l,a,c,d].indexOf(i)>=0&&s!==this._joinRef())return;let h=this._onMessage(i,t,s);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(f=>{var m,v,y;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((y=(v=f.filter)===null||v===void 0?void 0:v.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===i}).map(f=>f.callback(h,s)):(n=this.bindings[i])===null||n===void 0||n.filter(f=>{var m,v,y,P,R,$;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in f){const L=f.id,O=(m=f.filter)===null||m===void 0?void 0:m.event;return L&&((v=t.ids)===null||v===void 0?void 0:v.includes(L))&&(O==="*"||(O==null?void 0:O.toLocaleLowerCase())===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const L=(R=(P=f==null?void 0:f.filter)===null||P===void 0?void 0:P.event)===null||R===void 0?void 0:R.toLocaleLowerCase();return L==="*"||L===(($=t==null?void 0:t.event)===null||$===void 0?void 0:$.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===i}).map(f=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:v,table:y,commit_timestamp:P,type:R,errors:$}=m;h=Object.assign(Object.assign({},{schema:v,table:y,commit_timestamp:P,eventType:R,new:{},old:{},errors:$}),this._getPayloadRecords(m))}f.callback(h,s)})}_isClosed(){return this.state===B.closed}_isJoined(){return this.state===B.joined}_isJoining(){return this.state===B.joining}_isLeaving(){return this.state===B.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const o=e.toLocaleLowerCase(),n={type:o,filter:t,callback:s};return this.bindings[o]?this.bindings[o].push(n):this.bindings[o]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(o=>{var n;return!(((n=o.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&wt.isEqual(o.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(M.close,{},e)}_onError(e){this._on(M.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=B.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ct(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ct(e.columns,e.old_record)),t}}const mn=()=>{},pn=typeof WebSocket<"u",wn=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class yn{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=nn,this.params={},this.timeout=fs,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=mn,this.conn=null,this.sendBuffer=[],this.serializer=new ln,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let i;return n?i=n:typeof fetch>"u"?i=(...l)=>ue(()=>Promise.resolve().then(()=>fe),void 0).then(({default:a})=>a(...l)):i=fetch,(...l)=>i(...l)},this.endPoint=`${e}/${ot.websocket}`,this.httpEndpoint=ps(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const o=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,i)=>i(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new gs(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(pn){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new vn(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),ue(()=>import("./browser-da55b139.js").then(e=>e.b),[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:on}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case de.connecting:return ee.Connecting;case de.open:return ee.Open;case de.closing:return ee.Closing;default:return ee.Closed}}isConnected(){return this.connectionState()===ee.Open}channel(e,t={config:{}}){const s=new wt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:o,ref:n}=e,i=()=>{this.encode(e,l=>{var a;(a=this.conn)===null||a===void 0||a.send(l)})};this.log("push",`${t} ${s} (${n})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(o=>{t&&o.updateJoinPayload({access_token:t}),o.joinedOnce&&o._isJoined()&&o._push(M.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(an,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:o,payload:n,ref:i}=t;i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${s} ${o} ${i&&"("+i+")"||""}`,n),this.channels.filter(l=>l._isMember(s)).forEach(l=>l._trigger(o,n,i)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(M.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",o=new URLSearchParams(t);return`${e}${s}${o}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([wn],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class vn{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=de.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class yt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function A(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class bn extends yt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class at extends yt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var _n=globalThis&&globalThis.__awaiter||function(r,e,t,s){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function l(d){try{c(s.next(d))}catch(u){i(u)}}function a(d){try{c(s.throw(d))}catch(u){i(u)}}function c(d){d.done?n(d.value):o(d.value).then(l,a)}c((s=s.apply(r,e||[])).next())})};const ws=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ue(()=>Promise.resolve().then(()=>fe),void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},En=()=>_n(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ue(()=>Promise.resolve().then(()=>fe),void 0)).Response:Response}),lt=r=>{if(Array.isArray(r))return r.map(t=>lt(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const o=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[o]=lt(s)}),e};var oe=globalThis&&globalThis.__awaiter||function(r,e,t,s){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function l(d){try{c(s.next(d))}catch(u){i(u)}}function a(d){try{c(s.throw(d))}catch(u){i(u)}}function c(d){d.done?n(d.value):o(d.value).then(l,a)}c((s=s.apply(r,e||[])).next())})};const Ke=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),kn=(r,e,t)=>oe(void 0,void 0,void 0,function*(){const s=yield En();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(o=>{e(new bn(Ke(o),r.status||500))}).catch(o=>{e(new at(Ke(o),o))}):e(new at(Ke(r),r))}),Tn=(r,e,t,s)=>{const o={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(o.body=JSON.stringify(s)),Object.assign(Object.assign({},o),t))};function xe(r,e,t,s,o,n){return oe(this,void 0,void 0,function*(){return new Promise((i,l)=>{r(t,Tn(e,s,o,n)).then(a=>{if(!a.ok)throw a;return s!=null&&s.noResolveJson?a:a.json()}).then(a=>i(a)).catch(a=>kn(a,l,s))})})}function $e(r,e,t,s){return oe(this,void 0,void 0,function*(){return xe(r,"GET",e,t,s)})}function G(r,e,t,s,o){return oe(this,void 0,void 0,function*(){return xe(r,"POST",e,s,o,t)})}function xn(r,e,t,s,o){return oe(this,void 0,void 0,function*(){return xe(r,"PUT",e,s,o,t)})}function Sn(r,e,t,s){return oe(this,void 0,void 0,function*(){return xe(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function ys(r,e,t,s,o){return oe(this,void 0,void 0,function*(){return xe(r,"DELETE",e,s,o,t)})}var N=globalThis&&globalThis.__awaiter||function(r,e,t,s){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function l(d){try{c(s.next(d))}catch(u){i(u)}}function a(d){try{c(s.throw(d))}catch(u){i(u)}}function c(d){d.done?n(d.value):o(d.value).then(l,a)}c((s=s.apply(r,e||[])).next())})};const Cn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},At={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Pn{constructor(e,t={},s,o){this.url=e,this.headers=t,this.bucketId=s,this.fetch=ws(o)}uploadOrUpdate(e,t,s,o){return N(this,void 0,void 0,function*(){try{let n;const i=Object.assign(Object.assign({},At),o);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const a=i.metadata;typeof Blob<"u"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",s)):typeof FormData<"u"&&s instanceof FormData?(n=s,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=s,l["cache-control"]=`max-age=${i.cacheControl}`,l["content-type"]=i.contentType,a&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),o!=null&&o.headers&&(l=Object.assign(Object.assign({},l),o.headers));const c=this._removeEmptyFolders(t),d=this._getFinalPath(c),u=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:n,headers:l},i!=null&&i.duplex?{duplex:i.duplex}:{})),h=yield u.json();return u.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(n){if(A(n))return{data:null,error:n};throw n}})}upload(e,t,s){return N(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,o){return N(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),i=this._getFinalPath(n),l=new URL(this.url+`/object/upload/sign/${i}`);l.searchParams.set("token",t);try{let a;const c=Object.assign({upsert:At.upsert},o),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&s instanceof Blob?(a=new FormData,a.append("cacheControl",c.cacheControl),a.append("",s)):typeof FormData<"u"&&s instanceof FormData?(a=s,a.append("cacheControl",c.cacheControl)):(a=s,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType);const u=yield this.fetch(l.toString(),{method:"PUT",body:a,headers:d}),h=yield u.json();return u.ok?{data:{path:n,fullPath:h.Key},error:null}:{data:null,error:h}}catch(a){if(A(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return N(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const o=Object.assign({},this.headers);t!=null&&t.upsert&&(o["x-upsert"]="true");const n=yield G(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:o}),i=new URL(this.url+n.url),l=i.searchParams.get("token");if(!l)throw new yt("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:l},error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}update(e,t,s){return N(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return N(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(A(o))return{data:null,error:o};throw o}})}copy(e,t,s){return N(this,void 0,void 0,function*(){try{return{data:{path:(yield G(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(A(o))return{data:null,error:o};throw o}})}createSignedUrl(e,t,s){return N(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),n=yield G(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(o){if(A(o))return{data:null,error:o};throw o}})}createSignedUrls(e,t,s){return N(this,void 0,void 0,function*(){try{const o=yield G(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${n}`):null})),error:null}}catch(o){if(A(o))return{data:null,error:o};throw o}})}download(e,t){return N(this,void 0,void 0,function*(){const o=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),i=n?`?${n}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield $e(this.fetch,`${this.url}/${o}/${l}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(A(l))return{data:null,error:l};throw l}})}info(e){return N(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield $e(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:lt(s),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}exists(e){return N(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Sn(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(A(s)&&s instanceof at){const o=s.originalError;if([400,404].includes(o==null?void 0:o.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),o=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&o.push(n);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});a!==""&&o.push(a);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${c}`)}}}remove(e){return N(this,void 0,void 0,function*(){try{return{data:yield ys(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}list(e,t,s){return N(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},Cn),t),{prefix:e||""});return{data:yield G(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},s),error:null}}catch(o){if(A(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ln="2.7.1",In={"X-Client-Info":`storage-js/${Ln}`};var ie=globalThis&&globalThis.__awaiter||function(r,e,t,s){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function l(d){try{c(s.next(d))}catch(u){i(u)}}function a(d){try{c(s.throw(d))}catch(u){i(u)}}function c(d){d.done?n(d.value):o(d.value).then(l,a)}c((s=s.apply(r,e||[])).next())})};class An{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},In),t),this.fetch=ws(s)}listBuckets(){return ie(this,void 0,void 0,function*(){try{return{data:yield $e(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}})}getBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield $e(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ie(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ie(this,void 0,void 0,function*(){try{return{data:yield xn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ie(this,void 0,void 0,function*(){try{return{data:yield ys(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}}class On extends An{constructor(e,t={},s){super(e,t,s)}from(e){return new Pn(this.url,this.headers,e,this.fetch)}}const $n="2.49.4";let we="";typeof Deno<"u"?we="deno":typeof document<"u"?we="web":typeof navigator<"u"&&navigator.product==="ReactNative"?we="react-native":we="node";const jn={"X-Client-Info":`supabase-js-${we}/${$n}`},Rn={headers:jn},Nn={schema:"public"},Un={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Bn={};var Dn=globalThis&&globalThis.__awaiter||function(r,e,t,s){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function l(d){try{c(s.next(d))}catch(u){i(u)}}function a(d){try{c(s.throw(d))}catch(u){i(u)}}function c(d){d.done?n(d.value):o(d.value).then(l,a)}c((s=s.apply(r,e||[])).next())})};const Mn=r=>{let e;return r?e=r:typeof fetch>"u"?e=ss:e=fetch,(...t)=>e(...t)},Fn=()=>typeof Headers>"u"?rs:Headers,qn=(r,e,t)=>{const s=Mn(t),o=Fn();return(n,i)=>Dn(void 0,void 0,void 0,function*(){var l;const a=(l=yield e())!==null&&l!==void 0?l:r;let c=new o(i==null?void 0:i.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${a}`),s(n,Object.assign(Object.assign({},i),{headers:c}))})};var Jn=globalThis&&globalThis.__awaiter||function(r,e,t,s){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function l(d){try{c(s.next(d))}catch(u){i(u)}}function a(d){try{c(s.throw(d))}catch(u){i(u)}}function c(d){d.done?n(d.value):o(d.value).then(l,a)}c((s=s.apply(r,e||[])).next())})};function Hn(r){return r.replace(/\/$/,"")}function zn(r,e){const{db:t,auth:s,realtime:o,global:n}=r,{db:i,auth:l,realtime:a,global:c}=e,d={db:Object.assign(Object.assign({},i),t),auth:Object.assign(Object.assign({},l),s),realtime:Object.assign(Object.assign({},a),o),global:Object.assign(Object.assign({},c),n),accessToken:()=>Jn(this,void 0,void 0,function*(){return""})};return r.accessToken?d.accessToken=r.accessToken:delete d.accessToken,d}const vs="2.69.1",ce=30*1e3,ct=3,Ye=ct*ce,Wn="http://localhost:9999",Gn="supabase.auth.token",Vn={"X-Client-Info":`gotrue-js/${vs}`},dt="X-Supabase-Api-Version",bs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Kn=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Yn=6e5;class vt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function p(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Qn extends vt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Xn(r){return p(r)&&r.name==="AuthApiError"}class _s extends vt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Q extends vt{constructor(e,t,s,o){super(e,s,o),this.name=t,this.status=s}}class z extends Q{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Zn(r){return p(r)&&r.name==="AuthSessionMissingError"}class Qe extends Q{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Pe extends Q{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Le extends Q{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function eo(r){return p(r)&&r.name==="AuthImplicitGrantRedirectError"}class Ot extends Q{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ut extends Q{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Xe(r){return p(r)&&r.name==="AuthRetryableFetchError"}class $t extends Q{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class ve extends Q{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const jt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Rt=` 	
\r=`.split(""),to=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Rt.length;e+=1)r[Rt[e].charCodeAt(0)]=-2;for(let e=0;e<jt.length;e+=1)r[jt[e].charCodeAt(0)]=e;return r})();function Es(r,e,t){const s=to[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Nt(r){const e=[],t=i=>{e.push(String.fromCodePoint(i))},s={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},n=i=>{no(i,s,t)};for(let i=0;i<r.length;i+=1)Es(r.charCodeAt(i),o,n);return e.join("")}function so(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function ro(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const o=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|o)+65536,t+=1}so(s,e)}}function no(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function oo(r){const e=[],t={queue:0,queuedBits:0},s=o=>{e.push(o)};for(let o=0;o<r.length;o+=1)Es(r.charCodeAt(o),t,s);return new Uint8Array(e)}function io(r){const e=[];return ro(r,t=>e.push(t)),new Uint8Array(e)}function ao(r){return Math.round(Date.now()/1e3)+r}function lo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const F=()=>typeof window<"u"&&typeof document<"u",X={tested:!1,writable:!1},be=()=>{if(!F())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(X.tested)return X.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),X.tested=!0,X.writable=!0}catch{X.tested=!0,X.writable=!1}return X.writable};function co(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((o,n)=>{e[n]=o})}catch{}return t.searchParams.forEach((s,o)=>{e[o]=s}),e}const ks=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ue(()=>Promise.resolve().then(()=>fe),void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},uo=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Ts=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Ie=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ae=async(r,e)=>{await r.removeItem(e)};class qe{constructor(){this.promise=new qe.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}qe.promiseConstructor=Promise;function Ze(r){const e=r.split(".");if(e.length!==3)throw new ve("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!Kn.test(e[s]))throw new ve("JWT not in base64url format");return{header:JSON.parse(Nt(e[0])),payload:JSON.parse(Nt(e[1])),signature:oo(e[2]),raw:{header:e[0],payload:e[1]}}}async function ho(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function fo(r,e){return new Promise((s,o)=>{(async()=>{for(let n=0;n<1/0;n++)try{const i=await r(n);if(!e(n,null,i)){s(i);return}}catch(i){if(!e(n,i)){o(i);return}}})()})}function go(r){return("0"+r.toString(16)).substr(-2)}function mo(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let o="";for(let n=0;n<56;n++)o+=t.charAt(Math.floor(Math.random()*s));return o}return crypto.getRandomValues(e),Array.from(e,go).join("")}async function po(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),o=new Uint8Array(s);return Array.from(o).map(n=>String.fromCharCode(n)).join("")}async function wo(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await po(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ae(r,e,t=!1){const s=mo();let o=s;t&&(o+="/PASSWORD_RECOVERY"),await Ts(r,`${e}-code-verifier`,o);const n=await wo(s);return[n,s===n?"plain":"s256"]}const yo=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function vo(r){const e=r.headers.get(dt);if(!e||!e.match(yo))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function bo(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function _o(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var Eo=globalThis&&globalThis.__rest||function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(r);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(r,s[o])&&(t[s[o]]=r[s[o]]);return t};const Z=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),ko=[502,503,504];async function Ut(r){var e;if(!uo(r))throw new ut(Z(r),0);if(ko.includes(r.status))throw new ut(Z(r),r.status);let t;try{t=await r.json()}catch(n){throw new _s(Z(n),n)}let s;const o=vo(r);if(o&&o.getTime()>=bs["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new $t(Z(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new z}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,i)=>n&&typeof i=="string",!0))throw new $t(Z(t),r.status,t.weak_password.reasons);throw new Qn(Z(t),r.status||500,s)}const To=(r,e,t,s)=>{const o={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),o.body=JSON.stringify(s),Object.assign(Object.assign({},o),t))};async function b(r,e,t,s){var o;const n=Object.assign({},s==null?void 0:s.headers);n[dt]||(n[dt]=bs["2024-01-01"].name),s!=null&&s.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const i=(o=s==null?void 0:s.query)!==null&&o!==void 0?o:{};s!=null&&s.redirectTo&&(i.redirect_to=s.redirectTo);const l=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",a=await xo(r,e,t+l,{headers:n,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(a):{data:Object.assign({},a),error:null}}async function xo(r,e,t,s,o,n){const i=To(e,s,o,n);let l;try{l=await r(t,Object.assign({},i))}catch(a){throw console.error(a),new ut(Z(a),0)}if(l.ok||await Ut(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(a){await Ut(a)}}function W(r){var e;let t=null;Lo(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=ao(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function Bt(r){const e=W(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function V(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function So(r){return{data:r,error:null}}function Co(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:o,verification_type:n}=r,i=Eo(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:o,verification_type:n},a=Object.assign({},i);return{data:{properties:l,user:a},error:null}}function Po(r){return r}function Lo(r){return r.access_token&&r.refresh_token&&r.expires_in}var Io=globalThis&&globalThis.__rest||function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(r);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(r,s[o])&&(t[s[o]]=r[s[o]]);return t};class Ao{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=ks(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await b(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(p(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await b(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:V})}catch(s){if(p(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Io(e,["options"]),o=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(o.new_email=s==null?void 0:s.newEmail,delete o.newEmail),await b(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:Co,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(p(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await b(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:V})}catch(t){if(p(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,o,n,i,l,a;try{const c={nextPage:null,lastPage:0,total:0},d=await b(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(o=e==null?void 0:e.perPage)===null||o===void 0?void 0:o.toString())!==null&&n!==void 0?n:""},xform:Po});if(d.error)throw d.error;const u=await d.json(),h=(i=d.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(a=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&a!==void 0?a:[];return f.length>0&&(f.forEach(m=>{const v=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(m.split(";")[1].split("=")[1]);c[`${y}Page`]=v}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(p(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await b(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:V})}catch(t){if(p(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await b(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:V})}catch(s){if(p(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await b(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:V})}catch(s){if(p(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await b(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:t,error:s}}catch(t){if(p(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await b(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(p(t))return{data:null,error:t};throw t}}}const Oo={getItem:r=>be()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{be()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{be()&&globalThis.localStorage.removeItem(r)}};function Dt(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function $o(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const le={debug:!!(globalThis&&be()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class xs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class jo extends xs{}async function Ro(r,e,t){le.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),le.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async o=>{if(o){le.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,o.name);try{return await t()}finally{le.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,o.name)}}else{if(e===0)throw le.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new jo(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(le.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}$o();const No={url:Wn,storageKey:Gn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Vn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Mt(r,e,t){return await t()}class _e{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=_e.nextInstanceID,_e.nextInstanceID+=1,this.instanceID>0&&F()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},No),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Ao({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=ks(o.fetch),this.lock=o.lock||Mt,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:F()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ro:this.lock=Mt,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?o.storage?this.storage=o.storage:be()?this.storage=Oo:(this.memoryStorage={},this.storage=Dt(this.memoryStorage)):(this.memoryStorage={},this.storage=Dt(this.memoryStorage)),F()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${vs}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=co(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),F()&&this.detectSessionInUrl&&s!=="none"){const{data:o,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),eo(n)){const a=(e=n.details)===null||e===void 0?void 0:e.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:i,redirectType:l}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",l),await this._saveSession(i),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return p(t)?{error:t}:{error:new _s("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,o;try{const n=await b(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(o=e==null?void 0:e.options)===null||o===void 0?void 0:o.captchaToken}},xform:W}),{data:i,error:l}=n;if(l||!i)return{data:{user:null,session:null},error:l};const a=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(n){if(p(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,s,o;try{let n;if("email"in e){const{email:d,password:u,options:h}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await ae(this.storage,this.storageKey)),n=await b(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:u,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:m},xform:W})}else if("phone"in e){const{phone:d,password:u,options:h}=e;n=await b(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},channel:(o=h==null?void 0:h.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:W})}else throw new Pe("You must provide either an email or phone number and a password");const{data:i,error:l}=n;if(l||!i)return{data:{user:null,session:null},error:l};const a=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(n){if(p(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:i,options:l}=e;t=await b(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:i,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Bt})}else if("phone"in e){const{phone:n,password:i,options:l}=e;t=await b(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:i,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Bt})}else throw new Pe("You must provide either an email or phone number and a password");const{data:s,error:o}=t;return o?{data:{user:null,session:null},error:o}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Qe}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:o})}catch(t){if(p(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,o,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Ie(this.storage,`${this.storageKey}-code-verifier`),[s,o]=(t??"").split("/");try{const{data:n,error:i}=await b(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:W});if(await Ae(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new Qe}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:o??null}),error:i})}catch(n){if(p(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:s,token:o,access_token:n,nonce:i}=e,l=await b(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:o,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:W}),{data:a,error:c}=l;return c?{data:{user:null,session:null},error:c}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new Qe}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:c})}catch(t){if(p(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,o,n,i;try{if("email"in e){const{email:l,options:a}=e;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await ae(this.storage,this.storageKey));const{error:u}=await b(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=a==null?void 0:a.data)!==null&&t!==void 0?t:{},create_user:(s=a==null?void 0:a.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:l,options:a}=e,{data:c,error:d}=await b(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(o=a==null?void 0:a.data)!==null&&o!==void 0?o:{},create_user:(n=a==null?void 0:a.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},channel:(i=a==null?void 0:a.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d}}throw new Pe("You must provide either an email or phone number.")}catch(l){if(p(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,s;try{let o,n;"options"in e&&(o=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:i,error:l}=await b(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:o,xform:W});if(l)throw l;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,c=i.user;return a!=null&&a.access_token&&(await this._saveSession(a),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(o){if(p(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var t,s,o;try{let n=null,i=null;return this.flowType==="pkce"&&([n,i]=await ae(this.storage,this.storageKey)),await b(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((o=e==null?void 0:e.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:i}),headers:this.headers,xform:So})}catch(n){if(p(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new z;const{error:o}=await b(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(p(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:o,options:n}=e,{error:i}=await b(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:s,type:o,options:n}=e,{data:i,error:l}=await b(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:l}}throw new Pe("You must provide either an email or phone number and a type")}catch(t){if(p(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ie(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Ye:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(a,c,d)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,c,d))})}return{data:{session:e},error:null}}const{session:o,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await b(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:V}):await this._useSession(async t=>{var s,o,n;const{data:i,error:l}=t;if(l)throw l;return!(!((s=i.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new z}:await b(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&n!==void 0?n:void 0,xform:V})})}catch(t){if(p(t))return Zn(t)&&(await this._removeSession(),await Ae(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:o,error:n}=s;if(n)throw n;if(!o.session)throw new z;const i=o.session;let l=null,a=null;this.flowType==="pkce"&&e.email!=null&&([l,a]=await ae(this.storage,this.storageKey));const{data:c,error:d}=await b(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:a}),jwt:i.access_token,xform:V});if(d)throw d;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(s){if(p(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new z;const t=Date.now()/1e3;let s=t,o=!0,n=null;const{payload:i}=Ze(e.access_token);if(i.exp&&(s=i.exp,o=s<=t),o){const{session:l,error:a}=await this._callRefreshToken(e.refresh_token);if(a)return{data:{user:null,session:null},error:a};if(!l)return{data:{user:null,session:null},error:null};n=l}else{const{data:l,error:a}=await this._getUser(e.access_token);if(a)throw a;n={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(p(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:i,error:l}=t;if(l)throw l;e=(s=i.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new z;const{session:o,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(p(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!F())throw new Le("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Le(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ot("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Le("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ot("No code detected.");const{data:R,error:$}=await this._exchangeCodeForSession(e.code);if($)throw $;const L=new URL(window.location.href);return L.searchParams.delete("code"),window.history.replaceState(window.history.state,"",L.toString()),{data:{session:R.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:o,access_token:n,refresh_token:i,expires_in:l,expires_at:a,token_type:c}=e;if(!n||!l||!i||!c)throw new Le("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(l);let h=d+u;a&&(h=parseInt(a));const f=h-d;f*1e3<=ce&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const m=h-u;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,d);const{data:v,error:y}=await this._getUser(n);if(y)throw y;const P={provider_token:s,provider_refresh_token:o,access_token:n,expires_in:u,expires_at:h,refresh_token:i,token_type:c,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:P,redirectType:e.type},error:null}}catch(s){if(p(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ie(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:o,error:n}=t;if(n)return{error:n};const i=(s=o.session)===null||s===void 0?void 0:s.access_token;if(i){const{error:l}=await this.admin.signOut(i,e);if(l&&!(Xn(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Ae(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=lo(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,o;try{const{data:{session:n},error:i}=t;if(i)throw i;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,o=null;this.flowType==="pkce"&&([s,o]=await ae(this.storage,this.storageKey,!0));try{return await b(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(p(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(p(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:o}=await this._useSession(async n=>{var i,l,a,c,d;const{data:u,error:h}=n;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:!0});return await b(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(o)throw o;return F()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(p(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,o;const{data:n,error:i}=t;if(i)throw i;return await b(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0})})}catch(t){if(p(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await fo(async o=>(o>0&&await ho(200*Math.pow(2,o-1)),this._debug(t,"refreshing attempt",o),await b(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:W})),(o,n)=>{const i=200*Math.pow(2,o);return n&&Xe(n)&&Date.now()+i-s<ce})}catch(s){if(this._debug(t,"error",s),p(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),F()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Ie(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const o=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Ye;if(this._debug(t,`session has${o?"":" not"} expired with margin of ${Ye}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:n}=await this._callRefreshToken(s.refresh_token);n&&(console.error(n),Xe(n)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",n),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new z;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new qe;const{data:n,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!n.session)throw new z;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const l={session:n.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(n){if(this._debug(o,"error",n),p(n)){const i={session:null,error:n};return Xe(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(i),i}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,t,s=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],i=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(a){n.push(a)}});if(await Promise.all(i),n.length>0){for(let l=0;l<n.length;l+=1)console.error(n[l]);throw n[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ts(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ae(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&F()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ce);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((s.expires_at*1e3-e)/ce);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${ce}ms, refresh threshold is ${ct} ticks`),o<=ct&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof xs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!F()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const o=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&o.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&o.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[n,i]=await ae(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(l.toString())}if(s!=null&&s.queryParams){const n=new URLSearchParams(s.queryParams);o.push(n.toString())}return s!=null&&s.skipBrowserRedirect&&o.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:o,error:n}=t;return n?{data:null,error:n}:await b(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=o==null?void 0:o.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(p(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,o;const{data:n,error:i}=t;if(i)return{data:null,error:i};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:c}=await b(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=a==null?void 0:a.totp)===null||o===void 0)&&o.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(p(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:o,error:n}=t;if(n)return{data:null,error:n};const{data:i,error:l}=await b(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=o==null?void 0:o.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:l})})}catch(t){if(p(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:o,error:n}=t;return n?{data:null,error:n}:await b(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=o==null?void 0:o.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(p(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],o=s.filter(i=>i.factor_type==="totp"&&i.status==="verified"),n=s.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:s,totp:o,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:o},error:n}=e;if(n)return{data:null,error:n};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Ze(o.access_token);let l=null;i.aal&&(l=i.aal);let a=l;((s=(t=o.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(a="aal2");const d=i.amr||[];return{data:{currentLevel:l,nextLevel:a,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(i=>i.kid===e);if(s||(s=this.jwks.keys.find(i=>i.kid===e),s&&this.jwks_cached_at+Yn>Date.now()))return s;const{data:o,error:n}=await b(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!o.keys||o.keys.length===0)throw new ve("JWKS is empty");if(this.jwks=o,this.jwks_cached_at=Date.now(),s=o.keys.find(i=>i.kid===e),!s)throw new ve("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:f,error:m}=await this.getSession();if(m||!f.session)return{data:null,error:m};s=f.session.access_token}const{header:o,payload:n,signature:i,raw:{header:l,payload:a}}=Ze(s);if(bo(n.exp),!o.kid||o.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:n,header:o,signature:i},error:null}}const c=_o(o.alg),d=await this.fetchJwk(o.kid,t),u=await crypto.subtle.importKey("jwk",d,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,i,io(`${l}.${a}`)))throw new ve("Invalid JWT signature");return{data:{claims:n,header:o,signature:i},error:null}}catch(s){if(p(s))return{data:null,error:s};throw s}}}_e.nextInstanceID=0;const Uo=_e;class Bo extends Uo{constructor(e){super(e)}}var Do=globalThis&&globalThis.__awaiter||function(r,e,t,s){function o(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function l(d){try{c(s.next(d))}catch(u){i(u)}}function a(d){try{c(s.throw(d))}catch(u){i(u)}}function c(d){d.done?n(d.value):o(d.value).then(l,a)}c((s=s.apply(r,e||[])).next())})};class Mo{constructor(e,t,s){var o,n,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=Hn(e);this.realtimeUrl=`${l}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${l}/auth/v1`,this.storageUrl=`${l}/storage/v1`,this.functionsUrl=`${l}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:Nn,realtime:Bn,auth:Object.assign(Object.assign({},Un),{storageKey:a}),global:Rn},d=zn(s??{},c);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(n=d.global.headers)!==null&&n!==void 0?n:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(u,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=qn(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new sn(`${l}/rest/v1`,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new Ar(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new On(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Do(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:o,storageKey:n,flowType:i,lock:l,debug:a},c,d){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Bo({url:this.authUrl,headers:Object.assign(Object.assign({},u),c),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:o,flowType:i,lock:l,debug:a,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new yn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Fo=(r,e,t)=>new Mo(r,e,t),qo="https://fvbafecdoqslcvmyxqjf.supabase.co",Jo="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2YmFmZWNkb3FzbGN2bXl4cWpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5NDg3MjYsImV4cCI6MjA1OTUyNDcyNn0.TfhLP9BBhokuAPVaxFQy4dg-MvZlsJDquVFPF-OWjOM",w=Fo(qo,Jo);async function ht(){const{data:{user:r}}=await w.auth.getUser();return r}async function Ho(r,e){const{data:t,error:s}=await w.auth.signUp({email:r,password:e});if(s)throw s;return t}async function zo(r,e){const{data:t,error:s}=await w.auth.signInWithPassword({email:r,password:e});if(s)throw s;return t}async function Wo(){const{error:r}=await w.auth.signOut();if(r)throw r}function Go(r){const{data:e}=w.auth.onAuthStateChange((t,s)=>{r(t,s)});return e.subscription.unsubscribe}async function Ft(){try{console.log("Initializing database...");const{error:r}=await w.from("profiles").select("id").limit(1),{error:e}=await w.from("posts").select("id").limit(1),{error:t}=await w.from("tags").select("id").limit(1),{error:s}=await w.from("post_tags").select("post_id").limit(1);return r&&console.warn("Profiles table check:",r.message),e&&console.warn("Posts table check:",e.message),t&&console.warn("Tags table check:",t.message),s&&console.warn("Post_tags table check:",s.message),{profilesExists:!r,postsExists:!e,tagsExists:!t,postTagsExists:!s}}catch(r){throw console.error("Error initializing database:",r),r}}async function bt(){try{const{data:{user:r}}=await w.auth.getUser();if(!r)throw new Error("No user logged in");const{data:e,error:t}=await w.from("posts").select(`
        *,
        tags:post_tags(
          tag:tags(*)
        )
      `).eq("user_id",r.id).order("created_at",{ascending:!1});if(t)throw t;return e.map(s=>({...s,tags:s.tags.map(o=>o.tag)}))}catch(r){throw console.error("Error getting posts:",r),r}}async function Ss(r){try{const{data:{user:e}}=await w.auth.getUser();if(!e)throw new Error("No user logged in");console.log("Creating post with data:",r),console.log("Tags received:",JSON.stringify(r.tags));let t=[];if(r.tags&&Array.isArray(r.tags)&&r.tags.length>0){console.log("Processing tags BEFORE creating post:",r.tags.length,"tags",JSON.stringify(r.tags));try{const l=JSON.parse(JSON.stringify(r.tags)).map(a=>typeof a=="object"&&a!==null&&a.name?{name:a.name,color:a.color||"#cccccc"}:typeof a=="string"?{name:a,color:"#cccccc"}:null).filter(a=>a!==null);console.log("Tag objects to create:",l.length,JSON.stringify(l)),l.length>0&&(t=await _t(l),console.log("Created tags with IDs:",t))}catch(i){console.error("Error processing tags before post creation:",i)}}const{data:s,error:o}=await w.from("posts").insert([{user_id:e.id,url:r.url,platform:r.platform,title:r.title||null,description:r.description||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select();if(o)throw console.error("Error creating post:",o),o;if(!s||s.length===0)throw console.error("No post data returned after creation"),new Error("Failed to create post");const n=s[0];if(console.log("Post created successfully:",n.id),t.length>0){console.log("Associating tags with new post:",t);try{const i=t.map(c=>({post_id:n.id,tag_id:c}));console.log("Creating post_tags entries directly:",JSON.stringify(i));const{data:l,error:a}=await w.from("post_tags").upsert(i,{onConflict:"post_id,tag_id"}).select();a?console.error("Error creating post_tags:",a):console.log("Successfully created post_tags directly:",JSON.stringify(l))}catch(i){console.error("Error associating tags with post:",i)}}else console.log("No tags to associate with post");return n}catch(e){throw console.error("Error creating post:",e),e}}async function Cs(r){try{const{data:{user:e}}=await w.auth.getUser();if(!e)throw new Error("No user logged in");const{data:t,error:s}=await w.from("post_tags").select("*, tag:tags(*)").eq("post_id",r);if(s)throw s;return t||[]}catch(e){return console.error("Error getting post tags:",e),[]}}async function qt(){try{const{data:{user:r}}=await w.auth.getUser();if(!r)throw new Error("No user logged in");const{data:e,error:t}=await w.from("posts").select("id").eq("user_id",r.id);if(t)throw t;if(!e||e.length===0)return[];const s=e.map(i=>i.id),{data:o,error:n}=await w.from("post_tags").select("*, tag:tags(*)").in("post_id",s);if(n)throw n;return o||[]}catch(r){return console.error("Error getting all post tags:",r),[]}}async function Ps(r,e){try{const{data:{user:t}}=await w.auth.getUser();if(!t)throw new Error("No user logged in");const s=e.map(n=>({post_id:r,tag_id:n})),{error:o}=await w.from("post_tags").upsert(s,{onConflict:"post_id,tag_id"});return o?(console.error("Error adding tags to post:",o),!1):!0}catch(t){return console.error("Error adding tags to post:",t),!1}}async function Vo(r,e){try{const{data:{user:t}}=await w.auth.getUser();if(!t)throw new Error("No user logged in");const{error:s}=await w.from("post_tags").delete().eq("post_id",r).in("tag_id",e);return s?(console.error("Error removing tags from post:",s),!1):!0}catch(t){return console.error("Error removing tags from post:",t),!1}}async function Ko(r,e){try{const{data:{user:t}}=await w.auth.getUser();if(!t)throw new Error("No user logged in");const s={};e.url!==void 0&&(s.url=e.url),e.platform!==void 0&&(s.platform=e.platform),e.title!==void 0&&(s.title=e.title),e.description!==void 0&&(s.description=e.description),s.updated_at=new Date().toISOString();const{data:o,error:n}=await w.from("posts").update(s).eq("id",r).eq("user_id",t.id).select();if(n)throw n;if(e.tags)if(console.log("Updating tags for post:",r,"Tags count:",e.tags.length),Array.isArray(e.tags)&&e.tags.length>0)try{const i=[],l=[];e.tags.forEach(d=>{typeof d=="string"?l.push(d):typeof d=="object"&&(d.id?l.push(d.id):d.name&&i.push(d))}),console.log("Tag objects to create:",i.length),console.log("Existing tag IDs:",l.length);let a=[];i.length>0&&(a=await _t(i),console.log("Created new tags with IDs:",a));const c=[...l,...a].filter(d=>d!==null);c.length>0?(console.log("Associating tags with post:",c),await Yo(r,c)?console.log("Successfully updated tags for post"):console.warn("Failed to update tags for post")):console.warn("No valid tag IDs to associate with post")}catch(i){console.error("Error updating tags for post:",i)}else try{const{error:i}=await w.from("post_tags").delete().eq("post_id",r);i?console.error("Error removing all tags from post:",i):console.log("Successfully removed all tags from post")}catch(i){console.error("Error removing all tags from post:",i)}return o[0]}catch(t){throw console.error("Error updating post:",t),t}}async function Je(){try{const{data:{user:r}}=await w.auth.getUser();if(!r)throw new Error("No user logged in");const{data:e,error:t}=await w.from("tags").select("*").eq("user_id",r.id).order("name");if(t)throw t;return e}catch(r){throw console.error("Error getting tags:",r),r}}async function Ls(r){try{const{data:{user:e}}=await w.auth.getUser();if(!e)throw new Error("No user logged in");const{data:t,error:s}=await w.from("tags").insert([{user_id:e.id,name:r.name,color:r.color||null}]).select();if(s)throw s;return t[0]}catch(e){throw console.error("Error creating tag:",e),e}}async function _t(r){try{const{data:{user:e}}=await w.auth.getUser();if(!e)throw new Error("No user logged in");const t=(r||[]).filter(c=>c&&c.name);if(t.length===0)return console.log("No valid tags to create"),[];console.log("Creating tags:",t.map(c=>c.name).join(", "));const{data:s,error:o}=await w.from("tags").select("id, name").eq("user_id",e.id);if(o)throw console.error("Error fetching existing tags:",o),o;const n={};s&&s.length>0&&s.forEach(c=>{c.name&&(n[c.name.toLowerCase()]=c.id)});const i=t.filter(c=>!n[c.name.toLowerCase()]);let l=[];if(i.length>0){const c=i.map(h=>({user_id:e.id,name:h.name,color:h.color||"#cccccc"}));console.log("Inserting new tags:",c.length);const{data:d,error:u}=await w.from("tags").insert(c).select();if(u)throw console.error("Error creating tags:",u),u;d&&d.length>0&&(l=d.map(h=>h.id),console.log("Created tags with IDs:",l),d.forEach(h=>{h.name&&(n[h.name.toLowerCase()]=h.id)}))}const a=t.map(c=>{const d=n[c.name.toLowerCase()];return d||(console.warn("Could not find ID for tag:",c.name),null)}).filter(c=>c!==null);return console.log("All tag IDs:",a),a}catch(e){throw console.error("Error in createTags:",e),e}}async function Yo(r,e){try{const{data:{user:t}}=await w.auth.getUser();if(!t)throw new Error("No user logged in");const s=(e||[]).filter(d=>d&&typeof d=="string");if(!r||s.length===0)return console.log("No valid post ID or tag IDs to associate"),!1;console.log("Associating tags with post:",r,"Tag IDs:",s);const{data:o,error:n}=await w.from("posts").select("id").eq("id",r).eq("user_id",t.id).single();if(n)throw console.error("Error verifying post ownership:",n),n;if(!o)return console.error("Post not found or does not belong to user"),!1;const i=s.map(d=>({post_id:r,tag_id:d})),{error:l}=await w.from("post_tags").delete().eq("post_id",r);if(l)throw console.error("Error removing existing post_tags:",l),l;const{data:a,error:c}=await w.from("post_tags").insert(i);if(c)throw console.error("Error inserting post_tags:",c),c;return console.log("Successfully associated tags with post"),!0}catch(t){throw console.error("Error in associateTagsWithPost:",t),t}}function Et(r){return typeof r=="object"&&r!==null&&r.name?{name:r.name,color:r.color||"#cccccc"}:typeof r=="string"?{name:r,color:"#cccccc"}:null}function Is(r){if(!r||!Array.isArray(r))return[];console.log("Processing tags:",JSON.stringify(r)),console.log("Tags types:",r.map(t=>typeof t));const e=[];for(let t=0;t<r.length;t++){const s=r[t];console.log(`Processing tag ${t}:`,s,"Type:",typeof s);const o=Et(s);o&&e.push(o)}return console.log("Normalized tag objects:",e.length,JSON.stringify(e)),e}async function Qo(r){if(!r||r.length===0)return[];try{console.log("Creating tags in Supabase:",JSON.stringify(r));const e=await _t(r);return console.log("Created tags with IDs:",e),e}catch(e){return console.error("Error creating tags in Supabase:",e),[]}}async function Xo(r){try{console.log("Syncing tags to cloud, local tags count:",r.length);const e=await Je();console.log("Cloud tags count:",e.length);const t={};e.forEach(o=>{o&&o.name&&(t[o.name.toLowerCase()]=o)});const s=[];if(r.forEach(o=>{if(o&&o.name){const n=Et(o);n&&!t[n.name.toLowerCase()]&&s.push(n)}}),s.length>0){console.log("Creating missing tags in cloud:",s.length);const o=await Promise.all(s.map(async n=>{try{const i=await Ls(n);return i&&i.id?(t[n.name.toLowerCase()]=i,i):null}catch(i){return console.error("Error creating tag:",i),null}}));console.log("Created tags count:",o.filter(n=>n!==null).length)}else console.log("No new tags to create in cloud");return console.log("Tags sync to cloud completed"),t}catch(e){throw console.error("Error syncing tags to cloud:",e),e}}async function As(r,e,t){try{if(console.log("syncPostTags called for post ID:",r),!e||!Array.isArray(e)||e.length===0){console.log("No local tags to sync for post:",r);return}console.log("Local tags count:",e.length);const s=Is(e);if(s.length===0){console.log("No valid local tags to sync for post:",r);return}const o=await Cs(r);console.log("Existing post tags count:",o.length);const n=new Set(s.map(c=>c.name.toLowerCase())),i=new Set(o.map(c=>c.tag&&c.tag.name?c.tag.name.toLowerCase():null).filter(c=>c!==null));console.log("Local tag names:",Array.from(n)),console.log("Cloud tag names:",Array.from(i));const l=s.filter(c=>!i.has(c.name.toLowerCase())),a=o.filter(c=>c.tag&&c.tag.name&&!n.has(c.tag.name.toLowerCase()));if(console.log("Tags to add count:",l.length),console.log("Tags to remove count:",a.length),l.length>0){console.log("Processing tags to add:",JSON.stringify(l));const c=[];for(const u of l)if(t[u.name.toLowerCase()])console.log("Tag already exists in cloud:",u.name),c.push(t[u.name.toLowerCase()]);else try{console.log("Creating new tag in Supabase:",u.name);const h=await Ls(u);h&&h.id&&(console.log("Successfully created tag with ID:",h.id),t[u.name.toLowerCase()]=h,c.push(h))}catch(h){console.error("Error creating tag:",h)}const d=c.map(u=>u.id).filter(u=>u!==null);if(d.length>0){console.log("Adding tag IDs to post:",d);try{await Ps(r,d)?console.log("Successfully added tags to post"):console.error("Failed to add tags to post")}catch(u){console.error("Error adding tags to post:",u)}}}if(a.length>0){const c=a.map(d=>d.tag_id).filter(d=>d!==null);c.length>0&&(console.log("Removing tag IDs from post:",c),await Vo(r,c))}console.log("Post tags sync completed for post ID:",r)}catch(s){console.error("Error syncing post tags:",s)}}let te=!1,Jt=null;async function Ht(){try{console.log("Initializing sync service...");const{data:{user:r}}=await w.auth.getUser();if(!r){console.log("No user logged in, sync service not initialized");return}console.log("User logged in, sync service initialized"),await kt()}catch(r){console.error("Error initializing sync service:",r)}}async function kt(){try{if(te){console.log("Sync already in progress, skipping...");return}te=!0,console.log("Starting sync process...",new Date().toISOString());const{data:{user:r}}=await w.auth.getUser();if(!r){console.log("No user logged in, cannot sync"),te=!1;return}console.log("User ID:",r.id);const e=await gt(),t=await q();if(console.log("Local tags count:",e.length),console.log("Local posts count:",t.length),t.length>0){const s=t[0];console.log("Sample local post:",s),console.log("Sample post tags:",s.tags||[])}await Zo(),await ti(),Jt=new Date,console.log("Sync completed successfully",Jt.toISOString()),te=!1}catch(r){console.error("Error syncing data:",r),te=!1}}async function Zo(){try{console.log("Syncing local data to cloud...");const r=await q(),e=[];r.forEach(n=>{n.tags&&Array.isArray(n.tags)&&n.tags.forEach(i=>{const l=Et(i);l&&!e.some(a=>a.name.toLowerCase()===l.name.toLowerCase())&&e.push(l)})});const t=await gt(),s=[...t];e.forEach(n=>{s.some(i=>i.name.toLowerCase()===n.name.toLowerCase())||s.push(n)}),console.log("Local posts count:",r.length),console.log("Combined tags count:",s.length),console.log("Tags from posts:",e.length),console.log("Tags from storage:",t.length);const o=await Xo(s);await ei(r,o);try{console.log("Verifying post-tag associations...");const n=await qt();if(console.log("Total post_tags associations after sync:",n.length),n.length===0){console.log("No post-tag associations found, attempting to fix...");const i=await bt(),l=await Je(),a={};l.forEach(d=>{d&&d.name&&(a[d.name.toLowerCase()]=d)});for(const d of r)if(d.tags&&Array.isArray(d.tags)&&d.tags.length>0){const u=i.find(h=>h.url===d.url);u&&(console.log(`Fixing tags for post: ${u.id} (${d.url})`),await As(u.id,d.tags,a))}const c=await qt();console.log("Post-tag associations after fix:",c.length)}}catch(n){console.error("Error verifying post-tag associations:",n)}console.log("Local to cloud sync completed")}catch(r){throw console.error("Error syncing local to cloud:",r),r}}async function ei(r,e){try{console.log("Syncing posts to cloud, local posts count:",r.length);const t=await bt();console.log("Cloud posts count:",t.length);const s=await Je();console.log("Cloud tags count:",s.length);const o={};t.forEach(n=>{n&&n.url&&(o[n.url]=n)});for(const n of r)if(console.log("Processing post:",n.url),o[n.url]){const i=o[n.url];console.log("Post exists in cloud with ID:",i.id),((n.title||null)!==(i.title||null)||(n.description||null)!==(i.description||null)||(n.platform||"")!==(i.platform||""))&&(console.log("Post needs update, updating properties"),await Ko(i.id,{title:n.title,description:n.description,platform:n.platform})),n.tags&&Array.isArray(n.tags)&&n.tags.length>0?(console.log("Post has tags, syncing tags for post"),await As(i.id,n.tags,e)):console.log("Post has no tags, skipping tag sync")}else if(console.log("Post does not exist in cloud, creating new post"),n.tags&&Array.isArray(n.tags)&&n.tags.length>0){console.log("New post has tags:",n.tags.length,JSON.stringify(n.tags));const i=Is(n.tags);if(i.length>0){console.log("Processed tag objects for new post:",JSON.stringify(i));const l=await Qo(i);if(console.log("Created tags with IDs for post:",l),n&&n.url){console.log("Creating post in Supabase with tags:",n.url);try{const a={url:n.url,platform:n.platform||"",title:n.title||null,description:n.description||null,tags:i};console.log("Full post object being sent to createPost:",JSON.stringify(a));const c=await Ss(a);console.log("Successfully created post with ID:",c.id),l&&l.length>0&&(console.log("Ensuring tags are associated with post:",l),await Ps(c.id,l))}catch(a){console.error("Error creating post with tags:",a)}}}else zt(n)}else console.log("New post has no tags"),zt(n);console.log("Posts sync to cloud completed")}catch(t){throw console.error("Error syncing posts to cloud:",t),t}}async function zt(r){if(r&&r.url){console.log("Creating post in Supabase without tags:",r.url);try{const e={url:r.url,platform:r.platform||"",title:r.title||null,description:r.description||null,tags:[]};console.log("Post object without tags:",JSON.stringify(e));const t=await Ss(e);console.log("Successfully created post without tags, ID:",t.id)}catch(e){console.error("Error creating post without tags:",e)}}else console.warn("Skipping post with missing URL:",r)}async function ti(){try{console.log("Syncing cloud data to local...");const r=await bt(),e=await Je(),t=await q(),s=await gt(),o={};t.forEach(a=>{a&&a.url&&(o[a.url]=a)});const n={};s.forEach(a=>{a&&a.name&&(n[a.name.toLowerCase()]=a)});const i=[...t];r.forEach(a=>{if(!a||!a.url)return;const c=o[a.url];if(c)c.cloud_id=a.id,c.synced=!0,(c.title||null)!==(a.title||null)&&(c.title=a.title),(c.description||null)!==(a.description||null)&&(c.description=a.description),(c.platform||"")!==(a.platform||"")&&(c.platform=a.platform);else{const d={id:a.id,url:a.url,platform:a.platform||"",title:a.title||null,description:a.description||null,tags:[],dateAdded:a.created_at||new Date().toISOString(),cloud_id:a.id,synced:!0};i.push(d),o[a.url]=d}});for(const a of r){if(!a||!a.id)continue;const c=await Cs(a.id);if(c&&c.length>0){const d=o[a.url];if(d){const u=c.map(h=>h.tag?{id:h.tag.id,name:h.tag.name,color:h.tag.color||"#cccccc"}:null).filter(h=>h!==null);d.tags=u}}}const l=[...s];e.forEach(a=>{if(!a||!a.name)return;const c=n[a.name.toLowerCase()];c?(c.id=a.id,c.color!==a.color&&(c.color=a.color)):l.push({id:a.id,name:a.name,color:a.color||"#cccccc"})}),await ke(i),await mr(l),console.log("Cloud to local sync completed")}catch(r){throw console.error("Error syncing cloud to local:",r),r}}function Wt(){return te}async function Gt(){console.log("Forcing sync operation..."),te=!1,await kt(),console.log("Forced sync completed")}function Vt(r){if(!r||typeof r!="string")return!0;r=r.replace("#",""),r.length===3&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]);const e=parseInt(r.substr(0,2),16),t=parseInt(r.substr(2,2),16),s=parseInt(r.substr(4,2),16);return isNaN(e)||isNaN(t)||isNaN(s)?!0:(.299*e+.587*t+.114*s)/255>.5}function si(){const r=document.getElementById("addLinkBtn"),e=document.getElementById("addLinkModal"),t=document.getElementById("closeModalBtn"),s=document.getElementById("cancelAddLink"),o=document.getElementById("linkForm"),n=document.getElementById("editLinkModal"),i=document.getElementById("closeEditModalBtn"),l=document.getElementById("cancelEditLink"),a=document.getElementById("deletePostBtn"),c=document.getElementById("editLinkForm");document.getElementById("tagFilter");const d=document.getElementById("menuBtn"),u=document.getElementById("menuDropdown"),h=document.getElementById("exportBtn"),f=document.getElementById("importFile"),m=document.getElementById("syncDataBtn"),v=document.getElementById("emptyStateAddBtn");r.addEventListener("click",()=>{e.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),document.getElementById("linkUrl").focus();const g=q(),E=K(g),S=document.getElementById("tagSuggestions");We(E,S,_=>{const k=document.getElementById("linkTags"),C=me(k.value);if(!C.includes(_)){const I=C.length>0?", ":"";k.value+=I+_}})}),t.addEventListener("click",()=>{y()}),e.addEventListener("click",g=>{g.target===e&&y()}),s.addEventListener("click",()=>{y()});function y(){e.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),o.reset(),document.getElementById("tagSuggestions").innerHTML=""}function P(){n.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),c.reset(),document.getElementById("editTagSuggestions").innerHTML=""}function R(){const g=q(),E=K(g),S=document.getElementById("availableTagsContainer");S.innerHTML="",E.forEach(_=>{let k,C,I;typeof _=="object"&&_!==null&&_.name?(k=_.name,C=_.color||"#cccccc",I=_):(k=String(_),C="#cccccc",I={name:k,color:C});const T=document.createElement("span");T.className="tag",T.dataset.tagName=k,T.dataset.tagJson=JSON.stringify(I),T.textContent=k,T.style.backgroundColor=C+"80",T.style.borderColor=C,Vt(C)?T.style.color="#333":T.style.color="white",T.addEventListener("click",()=>{$(I)}),S.appendChild(T)})}function $(g){const E=document.getElementById("tagFilterContainer"),S=document.getElementById("availableTagsContainer");let _,k,C;if(typeof g=="object"&&g!==null&&g.name?(_=g.name,k=g.color||"#cccccc",C=g):(_=String(g),k="#cccccc",C={name:_,color:k}),E.querySelector(`.tag[data-tag-name="${_}"]`))return;const T=document.createElement("span");T.className="tag",T.dataset.tagName=_,T.dataset.tagJson=JSON.stringify(C),T.textContent=_,T.style.backgroundColor=k+"80",T.style.borderColor=k,Vt(k)?T.style.color="#333":T.style.color="white",T.addEventListener("click",()=>{L(C)}),E.appendChild(T);const Ce=S.querySelector(`.tag[data-tag-name="${_}"]`);Ce&&Ce.classList.add("hidden");const js=xt();Ge(js)}function L(g){const E=document.getElementById("tagFilterContainer"),S=document.getElementById("availableTagsContainer");let _;typeof g=="object"&&g!==null&&g.name?_=g.name:_=String(g);const k=E.querySelector(`.tag[data-tag-name="${_}"]`);k&&k.remove();const C=S.querySelector(`.tag[data-tag-name="${_}"]`);C&&C.classList.remove("hidden");const I=xt();Ge(I)}function O(){const g=document.getElementById("tagFilterContainer"),E=document.getElementById("availableTagsContainer");g.innerHTML="",E.querySelectorAll(".tag").forEach(_=>{_.classList.remove("hidden")}),Ge([])}o.addEventListener("submit",async g=>{g.preventDefault();const E=document.getElementById("linkUrl").value.trim(),S=document.getElementById("linkTags").value.trim(),_=me(S);if(E){const k=o.querySelector('button[type="submit"]'),C=k.textContent;k.innerHTML='<span class="inline-block animate-spin mr-2">↻</span> Saving...',k.disabled=!0;try{if(await pr(E,_),await ht())try{Wt()||await Gt()}catch(T){console.error("Error syncing after adding post:",T)}y()}catch(I){console.error("Error adding post:",I),alert(`Error adding post: ${I.message}`)}finally{k.innerHTML=C,k.disabled=!1}}}),R(),document.getElementById("clearTagFilters").addEventListener("click",()=>{O()}),document.addEventListener("addTagFilter",g=>{g.detail&&g.detail.tag&&$(g.detail.tag)}),document.getElementById("postsGrid").addEventListener("click",g=>{if(g.target.closest(".edit-post")){const E=g.target.closest(".post-card");E&&E.dataset.id&&$s(E.dataset.id)}});function $s(g){const E=yr(g);if(!E)return;document.getElementById("editPostId").value=E.id,document.getElementById("editLinkUrl").value=E.url,document.getElementById("editLinkTags").value=E.tags.join(", "),document.getElementById("editLinkModal").classList.remove("hidden"),document.body.classList.add("overflow-hidden"),document.getElementById("editLinkUrl").focus();const _=q(),k=K(_),C=document.getElementById("editTagSuggestions");We(k,C,I=>{const T=document.getElementById("editLinkTags"),Se=me(T.value);if(!Se.includes(I)){const Ce=Se.length>0?", ":"";T.value+=Ce+I}})}i.addEventListener("click",()=>{P()}),n.addEventListener("click",g=>{g.target===n&&P()}),l.addEventListener("click",()=>{P()}),a.addEventListener("click",()=>{const g=document.getElementById("editPostId").value;g&&confirm("Are you sure you want to delete this post?")&&(wr(g),P())}),c.addEventListener("submit",g=>{g.preventDefault();const E=document.getElementById("editPostId").value,S=document.getElementById("editLinkUrl").value.trim(),_=document.getElementById("editLinkTags").value.trim(),k=me(_);E&&S&&(vr(E,S,k),P())}),d.addEventListener("click",()=>{u.classList.toggle("hidden")}),document.addEventListener("click",g=>{!d.contains(g.target)&&!u.contains(g.target)&&u.classList.add("hidden")}),h.addEventListener("click",()=>{u.classList.add("hidden"),Er()}),f.addEventListener("change",g=>{if(g.target.files.length>0){const E=g.target.files[0];kr(E).then(S=>{alert(`Import successful! Added ${S.newPostsAdded} new posts. Skipped ${S.duplicatesSkipped} duplicates.`),window.location.reload()}).catch(S=>{alert("Import failed: "+S.message)}).finally(()=>{g.target.value=""})}}),m.addEventListener("click",async()=>{if(u.classList.add("hidden"),!await ht()){alert("You need to log in to sync your data with the cloud.");return}if(Wt()){alert("Sync is already in progress. Please wait.");return}const E=m.textContent;m.innerHTML='<span class="inline-block animate-spin mr-2">↻</span> Syncing...',m.disabled=!0;try{await Gt(),alert("Data sync completed successfully!"),window.location.reload()}catch(S){console.error("Sync error:",S),alert(`Sync failed: ${S.message}`)}finally{m.innerHTML=E,m.disabled=!1}}),v&&v.addEventListener("click",()=>{e.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),document.getElementById("linkUrl").focus();const g=q(),E=K(g),S=document.getElementById("tagSuggestions");We(E,S,_=>{const k=document.getElementById("linkTags"),C=me(k.value);if(!C.includes(_)){const I=C.length>0?", ":"";k.value+=I+_}})})}let ne=null,H=!1,Y=null,Oe=[];async function ri(){try{H=!0,j(),ne=await ht(),Go((r,e)=>{var t;switch(ne=(e==null?void 0:e.user)||null,r){case"SIGNED_IN":console.log("User signed in:",(t=e==null?void 0:e.user)==null?void 0:t.email);break;case"SIGNED_OUT":console.log("User signed out");break;case"USER_UPDATED":console.log("User updated");break;case"PASSWORD_RECOVERY":console.log("Password recovery requested");break;default:break}j()})}catch(r){console.error("Error initializing auth:",r),Y=r.message}finally{H=!1,j()}}async function ni(r,e){try{H=!0,Y=null,j();const{user:t,session:s}=await zo(r,e);return ne=t,j(),{user:t,session:s}}catch(t){throw console.error("Error signing in:",t),Y=t.message,j(),t}finally{H=!1,j()}}async function oi(r,e){try{H=!0,Y=null,j();const{user:t,session:s}=await Ho(r,e);return t&&(ne=t),j(),{user:t,session:s}}catch(t){throw console.error("Error signing up:",t),Y=t.message,j(),t}finally{H=!1,j()}}async function ii(){try{H=!0,Y=null,j(),await Wo(),ne=null,j()}catch(r){throw console.error("Error signing out:",r),Y=r.message,j(),r}finally{H=!1,j()}}function Ee(){return{user:ne,loading:H,error:Y,isAuthenticated:!!ne}}function Os(r){if(typeof r!="function")throw new Error("Auth listener must be a function");return Oe.push(r),r(Ee()),()=>{Oe=Oe.filter(e=>e!==r)}}function j(){const r=Ee();Oe.forEach(e=>{try{e(r)}catch(t){console.error("Error in auth listener:",t)}})}function ai(){const r=document.createElement("div");r.className="auth-form-container bg-white p-6 rounded-lg shadow-md max-w-md mx-auto";const e=document.createElement("form");e.className="space-y-4",e.id="loginForm";const t=document.createElement("h2");t.className="text-2xl font-bold text-center text-gray-800 mb-6",t.textContent="Log in to Boardie";const s=document.createElement("div"),o=document.createElement("label");o.htmlFor="email",o.className="block text-sm font-medium text-gray-700 mb-1",o.textContent="Email";const n=document.createElement("input");n.type="email",n.id="email",n.name="email",n.required=!0,n.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",n.placeholder="you@example.com",s.appendChild(o),s.appendChild(n);const i=document.createElement("div"),l=document.createElement("label");l.htmlFor="password",l.className="block text-sm font-medium text-gray-700 mb-1",l.textContent="Password";const a=document.createElement("input");a.type="password",a.id="password",a.name="password",a.required=!0,a.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",a.placeholder="••••••••",i.appendChild(l),i.appendChild(a);const c=document.createElement("button");c.type="submit",c.className="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200",c.textContent="Sign in";const d=document.createElement("div");d.className="text-red-600 text-sm hidden",d.id="loginError";const u=document.createElement("div");return u.className="text-center mt-4 text-sm",u.innerHTML=`Don't have an account? <a href="#" id="showRegisterForm" class="text-blue-600 hover:text-blue-800">Sign up</a>`,e.appendChild(t),e.appendChild(s),e.appendChild(i),e.appendChild(d),e.appendChild(c),e.appendChild(u),r.appendChild(e),e.addEventListener("submit",async h=>{h.preventDefault();const f=n.value,m=a.value;d.textContent="",d.classList.add("hidden"),c.disabled=!0,c.innerHTML='<span class="inline-block animate-spin mr-2">↻</span> Signing in...';try{await ni(f,m)}catch(v){d.textContent=v.message||"Failed to sign in. Please check your credentials.",d.classList.remove("hidden"),c.disabled=!1,c.textContent="Sign in"}}),r}function Kt(){const r=document.createElement("div");r.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",r.id="authModal";const e=document.createElement("div");e.className="relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4";const t=document.createElement("button");t.className="absolute top-4 right-4 text-gray-400 hover:text-gray-600",t.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  `,t.addEventListener("click",()=>{document.body.removeChild(r)});const s=ai();e.appendChild(t),e.appendChild(s),r.appendChild(e),document.body.appendChild(r),setTimeout(()=>{document.getElementById("email").focus()},100)}function li(){const r=document.createElement("div");r.className="auth-form-container bg-white p-6 rounded-lg shadow-md max-w-md mx-auto";const e=document.createElement("form");e.className="space-y-4",e.id="registerForm";const t=document.createElement("h2");t.className="text-2xl font-bold text-center text-gray-800 mb-6",t.textContent="Create your account";const s=document.createElement("div"),o=document.createElement("label");o.htmlFor="registerEmail",o.className="block text-sm font-medium text-gray-700 mb-1",o.textContent="Email";const n=document.createElement("input");n.type="email",n.id="registerEmail",n.name="email",n.required=!0,n.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",n.placeholder="you@example.com",s.appendChild(o),s.appendChild(n);const i=document.createElement("div"),l=document.createElement("label");l.htmlFor="registerPassword",l.className="block text-sm font-medium text-gray-700 mb-1",l.textContent="Password";const a=document.createElement("input");a.type="password",a.id="registerPassword",a.name="password",a.required=!0,a.minLength=8,a.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",a.placeholder="Minimum 8 characters",i.appendChild(l),i.appendChild(a);const c=document.createElement("div"),d=document.createElement("label");d.htmlFor="confirmPassword",d.className="block text-sm font-medium text-gray-700 mb-1",d.textContent="Confirm Password";const u=document.createElement("input");u.type="password",u.id="confirmPassword",u.name="confirmPassword",u.required=!0,u.className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",u.placeholder="Confirm your password",c.appendChild(d),c.appendChild(u);const h=document.createElement("button");h.type="submit",h.className="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200",h.textContent="Create Account";const f=document.createElement("div");f.className="text-red-600 text-sm hidden",f.id="registerError";const m=document.createElement("div");m.className="text-center mt-4 text-sm",m.innerHTML='Already have an account? <a href="#" id="showLoginForm" class="text-blue-600 hover:text-blue-800">Sign in</a>';const v=document.createElement("p");return v.className="text-xs text-gray-500 mt-4 text-center",v.innerHTML='By creating an account, you agree to our <a href="#" class="text-blue-600 hover:underline">Terms of Service</a> and <a href="#" class="text-blue-600 hover:underline">Privacy Policy</a>.',e.appendChild(t),e.appendChild(s),e.appendChild(i),e.appendChild(c),e.appendChild(f),e.appendChild(h),e.appendChild(m),e.appendChild(v),r.appendChild(e),e.addEventListener("submit",async y=>{y.preventDefault();const P=n.value,R=a.value,$=u.value;if(f.textContent="",f.classList.add("hidden"),R!==$){f.textContent="Passwords do not match.",f.classList.remove("hidden");return}h.disabled=!0,h.innerHTML='<span class="inline-block animate-spin mr-2">↻</span> Creating account...';try{await oi(P,R);const L=document.createElement("div");L.className="fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-md z-50 bg-green-500 text-white",L.textContent="Account created successfully!",document.body.appendChild(L);const O=document.getElementById("authModal");O&&document.body.removeChild(O),setTimeout(()=>{L.parentNode&&document.body.removeChild(L)},3e3)}catch(L){f.textContent=L.message||"Failed to create account. Please try again.",f.classList.remove("hidden"),h.disabled=!1,h.textContent="Create Account"}}),r}function Yt(){const r=document.createElement("div");r.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",r.id="authModal";const e=document.createElement("div");e.className="relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4";const t=document.createElement("button");t.className="absolute top-4 right-4 text-gray-400 hover:text-gray-600",t.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  `,t.addEventListener("click",()=>{document.body.removeChild(r)});const s=li();e.appendChild(t),e.appendChild(s),r.appendChild(e),document.body.appendChild(r),setTimeout(()=>{document.getElementById("registerEmail").focus()},100)}let je=null;function ci(){try{je=Ee().user,ft(),Os(e=>{je=e.user,ft()}),di()}catch(r){console.error("Error initializing auth UI:",r)}}function di(){document.addEventListener("click",r=>{if((r.target.id==="loginButton"||r.target.closest("#loginButton"))&&Kt(),(r.target.id==="registerButton"||r.target.closest("#registerButton"))&&Yt(),(r.target.id==="logoutButton"||r.target.closest("#logoutButton"))&&ui(),r.target.id==="userMenuButton"||r.target.closest("#userMenuButton")){const e=document.getElementById("userMenu");e&&e.classList.toggle("hidden")}if(!r.target.closest("#userMenuButton")&&!r.target.closest("#userMenu")){const e=document.getElementById("userMenu");e&&!e.classList.contains("hidden")&&e.classList.add("hidden")}if(r.target.id==="showLoginForm"){r.preventDefault();const e=document.getElementById("authModal");e&&document.body.removeChild(e),Kt()}if(r.target.id==="showRegisterForm"){r.preventDefault();const e=document.getElementById("authModal");e&&document.body.removeChild(e),Yt()}})}async function ui(){try{await ii(),Qt("You have been logged out successfully")}catch(r){console.error("Error logging out:",r),Qt("Failed to log out. Please try again.","error")}}function ft(){const r=document.getElementById("authButtons");if(!r){hi();return}je?r.innerHTML=fi(je):r.innerHTML=gi()}function hi(){const r=document.querySelector("header");if(r){const e=document.createElement("div");e.id="authButtons",e.className="ml-auto flex items-center",r.appendChild(e),ft()}}function fi(r){return`
    <div class="flex items-center">
      <span class="text-sm text-gray-700 mr-3 hidden sm:inline">
        ${r.email||"User"}
      </span>
      <div class="relative">
        <button
          id="userMenuButton"
          class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 transition-colors"
          aria-expanded="false"
        >
          <span class="sr-only">User menu</span>
          <span class="text-sm font-medium">${mi(r)}</span>
        </button>
        <div
          id="userMenu"
          class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden"
        >
          <a
            href="#profile"
            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
          >
            Your Profile
          </a>
          <a
            href="#settings"
            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
          >
            Settings
          </a>
          <button
            id="logoutButton"
            class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
          >
            Sign out
          </button>
        </div>
      </div>
    </div>
  `}function gi(){return`
    <div class="flex items-center space-x-2">
      <button
        id="loginButton"
        class="px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800"
      >
        Log in
      </button>
      <button
        id="registerButton"
        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700"
      >
        Sign up
      </button>
    </div>
  `}function mi(r){if(!r)return"?";if(r.user_metadata&&r.user_metadata.full_name){const e=r.user_metadata.full_name.split(" ");return e.length>=2?`${e[0][0]}${e[e.length-1][0]}`.toUpperCase():e[0][0].toUpperCase()}return r.email?r.email[0].toUpperCase():"?"}function Qt(r,e="success"){const t=document.createElement("div");t.className=`fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-md z-50 ${e==="error"?"bg-red-500 text-white":"bg-green-500 text-white"}`,t.textContent=r,document.body.appendChild(t),setTimeout(()=>{t.classList.add("opacity-0","transition-opacity","duration-500"),setTimeout(()=>{t.parentNode&&document.body.removeChild(t)},500)},3e3)}let et=!1;async function pi(){if(!et)try{console.log("Initializing auth module..."),await ri(),ci();const{user:r}=Ee();r&&(console.log("User is logged in, initializing database and sync"),await Ft(),await Ht()),Os(async e=>{console.log("Auth state changed:",e.isAuthenticated?"authenticated":"unauthenticated"),e.isAuthenticated&&e.user?(!et||!Ee().user)&&(console.log("User signed in"),await Ft(),await Ht(),await kt()):e.isAuthenticated||console.log("User signed out")}),et=!0,console.log("Auth module initialized")}catch(r){console.error("Error initializing auth module:",r)}}function wi(){if(window.twttr){console.log("Twitter widgets already loaded");return}window.twttr=function(r,e,t){var s,o=r.getElementsByTagName(e)[0],n=window.twttr||{};return r.getElementById(t)||(s=r.createElement(e),s.id=t,s.src="https://platform.twitter.com/widgets.js",o.parentNode.insertBefore(s,o),n._e=[],n.ready=function(i){n._e.push(i)}),n}(document,"script","twitter-wjs"),window.twttr.ready(function(){console.log("Twitter widgets loaded and ready")})}document.addEventListener("DOMContentLoaded",async()=>{console.log("Boardie application initialized"),wi();try{await pi(),console.log("Authentication initialized")}catch(e){console.error("Error initializing authentication:",e)}si(),q().length===0&&ts()});export{yi as g};
